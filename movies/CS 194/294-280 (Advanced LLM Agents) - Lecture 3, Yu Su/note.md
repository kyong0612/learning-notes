# CS 194/294-280 (Advanced LLM Agents) - Lecture 3, Yu Su

ref: <https://www.youtube.com/live/zvI4UN2_i-w?si=LZG1G6zJPyf-YD3R>

- **言語エージェントの定義と背景**
- **推論機構（明示的・暗黙的推論）の進化とそのメカニズム**
- **長期記憶の実現と非パラメトリックメモリ（RAG）の応用**
- **プランニングと行動選択の課題とその解決手法**

---

## 1. 言語エージェントの概要と定義

### 1.1. 言語エージェントの背景と重要性

- **急速な注目の背景**
  - Bill Gates、Andrew Ng、Sam Altman などの著名人が、GUI 革命に匹敵する変革や AI 進展の推進要因として言語エージェントに言及している。
  - 従来は、単なる「薄いラッパー」として捉えられがちであったが、最新の研究では大規模言語モデル（LLM）を統合することで、環境との相互作用や自己改善能力が強化されている。

- **従来のエージェントとの比較**
  - **LLMファーストの視点**：LLM を基盤にプロンプトやエンジニアリングで補強する手法。単純なラッパーに留まるという批判がある。
  - **エージェントファーストの視点**：伝統的な AI エージェントの概念に立脚し、環境知覚、内部記憶、推論、プランニングなど多層的な能力を統合する手法。

### 1.2. 言語エージェントの特徴

- **言語による推論とコミュニケーション**
  - 言語を単なる出力形式ではなく、推論や内省の媒体として活用。
  - ChatGPT の成功例から、指示遵守、文脈理解、出力形式の柔軟性などが強調される。

- **拡張された能力**
  - 環境の知覚と動的な行動選択、内部状態の反省（自己反省）や多エージェントシミュレーションなど、多様な機能が統合される。

---

## 2. 言語による推論のメカニズム

### 2.1. 推論における言語の役割

- **コミュニケーションの媒体としての言語**
  - 自然言語による指示遵守と文脈把握が、従来の形式的な論理記述よりも柔軟で表現力が高い。
  - 言語を利用することで、指示や計画の表現、さらには内省的な「チェーン・オブ・ソート（CoT）」の効果も向上。

### 2.2. 暗黙的推論とグロッキング（Grokking）

- **グロッキングの現象**
  - 初期段階では、モデルは訓練データを丸暗記（ローテ学習）するが、長時間の訓練後に突如として一般化が向上する。
  - このフェーズ転換により、内部の「一般化回路」が形成され、柔軟な推論能力が獲得される。

- **推論タイプの違い**
  - **合成推論（compositional reasoning）**：複数の情報を組み合わせ、未知の組み合わせを推論する。OOD（アウト・オブ・ディストリビューション）一般化が難しい場合がある。
  - **比較推論（comparative reasoning）**：個別の属性値の取得と比較を行うため、一般化が安定しやすい。

### 2.3. 内部状態の解釈と因果追跡

- **メカニスティック・インタープリテーション**
  - **Logit Lens**：内部状態と出力埋め込み行列の内積から、どの単語が予測されるかを解析。
  - **Causal Tracing**：各層の内部状態が最終出力に与える影響度を定量化し、どの回路が推論に寄与しているかを評価する。

---

## 3. 長期記憶と非パラメトリックメモリ（RAG）の実現

### 3.1. 人間の記憶システムとの比較

- **ヒッポキャンパル・インデクシング理論**
  - **新皮質（neocortex）**：各種感覚情報を分散して記憶。
  - **海馬（hippocampus）**：分散された記憶情報を統合し、パターン補完や分離を実現。
  - この仕組みを模倣することで、より効率的な記憶検索が可能になる。

### 3.2. HippoRAG の概要

- **基本概念**
  - LLM に対して、神経生物学に触発された長期記憶機構を提供する。
  - オフラインのインデクシングフェーズとオンラインの検索フェーズに分かれ、外部メモリとしての非パラメトリックメモリを活用する。

- **具体的手法**
  - **オフラインインデクシング**  
    - LLM を利用して、入力テキストから自動的にトリプレット（主語・述語・目的語）を抽出し、知識グラフを生成する。
    - 生成されたグラフは、ヒッポキャンパスの役割を模倣し、情報の関連付けを効率化する。
  - **オンライン検索**  
    - 名前付きエンティティ認識や密ベクトル検索、パーソナライズド PageRank を用い、クエリに最も関連性の高い情報を迅速に抽出する。

- **補足説明**
  - 単純な埋め込みベースの RAG 手法と比較して、構造化された知識グラフを利用することで、部分情報の統合や多段階推論が向上する。

---

## 4. プランニングと行動選択の課題

### 4.1. プランニングの基本定義

- **定義**
  - 「ある目標 \(g\) に対し、目標状態を達成するための一連の行動 \(a_0, a_1, \dots, a_n\) を決定する」プロセス。
  - 状態空間や観測空間、行動の前提条件などを簡略化して議論する。

### 4.2. プランニングの主要パラダイム

- **リアクティブプランニング**
  - 各ステップで環境を観察し、その時点で最適と思われる行動を選択。
  - **メリット**：高速、実装が容易  
  - **デメリット**：局所最適に陥りやすく、長期的な視点が欠如

- **ツリーサーチ（探索型プランニング）**
  - 状態空間全体を探索し、バックトラッキングが可能な手法。
  - **メリット**：体系的な探索が可能  
  - **デメリット**：現実環境の不可逆的な状態変化に対応が困難

- **モデルベースプランニング**
  - LLM による世界モデルを活用し、各行動の将来的影響をシミュレーションする手法。
  - **メリット**：安全性・効率性の向上が期待できる  
  - **デメリット**：現実環境の複雑な動態を正確に再現することが難しい

### 4.3. ウェブエージェントの具体例：WebDreamer

- **概要**
  - LLM（例：GPT-4）を利用して、ウェブ上の動的環境の状態変化をシミュレーション。
  - 各候補行動の未来状態を予測し、シミュレーション結果に基づいて最適な行動を選択する。

- **課題**
  - 自然言語で表現される目標状態が曖昧なため、目標テストの自動化が難しい。
  - 現実のウェブ環境では、不可逆な状態変化や安全性の問題が存在する。

---

## 5. 今後の研究展望と応用可能性

### 5.1. 研究の方向性

- **記憶・パーソナライゼーション・継続学習**
  - エージェントが環境との相互作用を通じて継続的に学習し、ユーザや状況に応じた適応を実現する手法の開発。
- **推論手法の高度化**
  - 暗黙的推論と明示的なチェーン・オブ・ソートの統合、強化学習（RL）を用いた推論戦略の最適化。
- **プランニングの高度化**
  - 階層的プランニングや動的再プランニング、反応的とモデルベースのハイブリッド手法の研究。
- **安全性の向上**
  - エージェントが内部・外部からのリスクに対して安全に動作するための対策の強化。

### 5.2. 応用例

- **ディープリサーチ・ワークフロー自動化**
  - 膨大な情報からの統合と科学研究の自動化、業務プロセスの効率化。
- **ウェブエージェント**
  - 自然言語での柔軟な目標指定と、動的な環境探索を実現するエージェントシステムの構築。

#### 補足・参考文献

- **参考文献例**
  - Russell, S. & Norvig, P. 『人工知能：現代的アプローチ』
  - Kahneman, D. 『Thinking, Fast and Slow』
- **関連チュートリアル**
  - 最新の EMNLP チュートリアル（Diyi、Shunyu、Tao らによる解説資料など）

---

## 結論

本稿では、言語エージェントの概念、推論機構、長期記憶の実現、プランニングの課題について、従来の AI 研究との関連を踏まえながら詳細に解説した。  

- **言語エージェント**は、単なる LLM のラッパーではなく、環境認識、推論、記憶、プランニングなど複数の機能が統合された新たな AI システムである。  
- **推論機構**では、暗黙的推論の獲得（グロッキング現象）と内部回路の形成がその鍵となる。  
- **記憶システム**では、ヒッポキャンパル・インデクシングに基づく非パラメトリックメモリ（RAG）が、従来手法の限界を補完する。  
- **プランニング**では、リアクティブ、探索型、モデルベースの各手法が存在し、実環境への応用には安全性や環境動態の把握が不可欠となる。

今後、記憶のパーソナライゼーション、継続学習、推論・プランニング手法の高度化、安全性対策など、さらなる研究開発が期待される分野である。
