# 自動記事要約システム実装タスクリスト

## Phase 1: 基盤整備

### 1.1 プロジェクトセットアップ

- [ ] 必要なパッケージのインストール
  - [ ] `@mastra/core`
  - [ ] `zod`
  - [ ] `@ai-sdk/openai`（Claude Code用）
  - [ ] 追加の必要なパッケージ
- [ ] TypeScript設定の確認・調整
- [ ] 環境変数の設定（.env）

### 1.2 ディレクトリ構造の作成

- [ ] `src/mastra/workflows`ディレクトリ作成
- [ ] `src/mastra/tools`ディレクトリ作成
- [ ] `src/mastra/config`ディレクトリ作成

## Phase 2: Tool実装

### 2.1 基本ツールの実装

- [ ] GitDiffツールの実装
  - [ ] git diffコマンドの実行
  - [ ] 新規.mdファイルのフィルタリング
  - [ ] エラーハンドリング

### 2.2 外部連携ツールの実装

- [ ] YouTube MCPツールの実装
  - [ ] YouTube URLの検証
  - [ ] MCPサーバーとの連携
  - [ ] レスポンスの整形

- [ ] WebFetchツールの実装
  - [ ] URL検証
  - [ ] コンテンツ取得
  - [ ] HTMLからMarkdownへの変換

### 2.3 Claude Codeツールの実装

- [ ] Claude Code CLIラッパーの作成
- [ ] プロンプトファイルの読み込み
- [ ] 実行結果のパース

## Phase 3: Workflow Step実装

### 3.1 基本ステップの実装

- [ ] GitDiffStepの実装
  - [ ] 入力スキーマ定義
  - [ ] 出力スキーマ定義
  - [ ] 実行ロジック

- [ ] FileParserStepの実装
  - [ ] Markdownファイルの読み込み
  - [ ] ソースURL抽出ロジック
  - [ ] メタデータパース

### 3.2 処理ステップの実装

- [ ] ToolSelectorStepの実装
  - [ ] URL判定ロジック
  - [ ] ツール選択アルゴリズム
  - [ ] デフォルトツールの設定

- [ ] SummaryStepの実装（Suspendable）
  - [ ] 要約生成ロジック
  - [ ] サスペンド機能の実装
  - [ ] レジューム機能の実装
  - [ ] 承認UIとの連携

### 3.3 最終ステップの実装

- [ ] UpdateFileStepの実装
  - [ ] ファイル更新ロジック
  - [ ] バックアップ処理
  - [ ] エラーハンドリング

## Phase 4: Workflow統合

### 4.1 ワークフロー定義

- [ ] autoSummarizeWorkflowの作成
- [ ] ステップの連結
- [ ] エラーハンドリングの実装
- [ ] リトライロジックの実装

### 4.2 Mastraインスタンスへの登録

- [ ] `src/mastra/index.ts`の更新
- [ ] ワークフローの登録
- [ ] ツールの登録

## Phase 5: ユーザーインターフェース

### 5.1 承認インターフェース

- [ ] 承認画面の設計
- [ ] Mastra Playgroundとの統合
- [ ] CLIベースの承認機能（オプション）

### 5.2 実行インターフェース

- [ ] 手動実行スクリプトの作成
- [ ] 定期実行の設定（cron/scheduler）
- [ ] 実行ログの表示

## Phase 6: テストと品質保証

### 6.1 ユニットテスト

- [ ] 各ツールのテスト作成
- [ ] 各ステップのテスト作成
- [ ] モックデータの準備

### 6.2 統合テスト

- [ ] ワークフロー全体のテスト
- [ ] エラーケースのテスト
- [ ] パフォーマンステスト

### 6.3 ドキュメント作成

- [ ] READMEの作成
- [ ] 使用方法ガイド
- [ ] トラブルシューティングガイド

## Phase 7: デプロイと運用

### 7.1 デプロイ準備

- [ ] 環境変数の管理
- [ ] ビルドスクリプトの作成
- [ ] デプロイスクリプトの作成

### 7.2 モニタリング

- [ ] ログ収集の設定
- [ ] エラー監視の設定
- [ ] 実行統計の収集

## Phase 8: 拡張機能（オプション）

### 8.1 追加機能

- [ ] 複数ディレクトリ対応
- [ ] カスタムプロンプト対応
- [ ] バッチ処理の最適化
- [ ] 差分更新機能

### 8.2 UI改善

- [ ] Webベースの管理画面
- [ ] 実行履歴の可視化
- [ ] 統計ダッシュボード

## 優先度と見積もり

### 高優先度（必須）

- Phase 1-4: 基本機能の実装（2-3週間）
- Phase 6.1-6.2: テスト（1週間）

### 中優先度（推奨）

- Phase 5: UI実装（1週間）
- Phase 6.3: ドキュメント（3日）

### 低優先度（オプション）

- Phase 7-8: デプロイと拡張（1-2週間）

## 完了基準

- [ ] 新規Markdownファイルの自動検出が可能
- [ ] 各ファイルに対して要約が生成される
- [ ] ユーザー承認フローが機能する
- [ ] ファイルが正しく更新される
- [ ] エラーハンドリングが適切に実装されている
