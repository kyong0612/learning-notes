# Prompt Engineering Guide

ref: <https://www.promptingguide.ai/jp>

指定されたウェブサイトの内容を確認するため、まずサイトをスクレイピングします。

ウェブサイトからスクレイピングした「LLMの設定」の内容を以下にまとめます：

## LLMの設定

プロンプトを使用してLLMと対話する際、いくつかのパラメータ設定によって異なる結果を得ることができます。主な設定パラメータは以下の通りです：

### Temperature（温度）

- 値が低いほど結果は決定論的になり、最も確率の高い回答が選ばれる
- 値が高いほどランダム性が増し、多様で創造的なアウトプットが可能になる
- 事実に基づくQ&Aには低い値が適切
- 詩の生成などの創造的タスクには高い値が効果的

### Top_p（核サンプリング）

- モデルが応答生成時の決定性をコントロールする手法
- 正確で事実に基づいた回答には低い値が適切
- 多様な回答を求める場合は高い値が適切
- 一般的には、TemperatureとTop_pは両方ではなくどちらか一方を調整することが推奨

### Max Length（最大長）

- モデルが生成するトークン数を管理
- 長すぎる・関連性のない回答を防止し、コストを管理できる

### Stop Sequences（停止シーケンス）

- モデルがトークン生成を停止する文字列を指定
- 回答の長さや構造を制御する方法
- 例：「11」を停止シーケンスに指定すると、10項目以上のリスト生成を防止できる

### Frequency Penalty（頻度ペナルティ）

- トークンが既に回答やプロンプトに出現した回数に比例してペナルティを適用
- 値が高いほど単語の繰り返しが少なくなる
- 頻出トークンに高いペナルティを与え、繰り返しを減らす

### Presence Penalty（存在ペナルティ）

- 繰り返されるトークンに対して同一のペナルティを適用
- 出現回数に関わらず（2回でも10回でも）同じペナルティが課される
- 多様性や創造性を求める場合は高く設定
- 特定フレーズへの集中が許容される場合は低く設定
- 一般的には、Frequency PenaltyとPresence Penaltyは両方ではなくどちらか一方を調整することが推奨

なお、使用するLLMのバージョンによって結果が異なる可能性があります。

## プロンプトの設計に関する一般的なヒント（実例付き）

### 1. 簡単に始める

- プロンプト設計は反復的なプロセスであり、最適な結果を得るには多くの実験が必要
- OpenAIやCohereのようなシンプルなプレイグラウンドから始めるのが良い
- シンプルなプロンプトから始め、徐々に要素や文脈を追加していく
- プロンプトのバージョン管理が重要
- 複雑なタスクはシンプルなサブタスクに分解して徐々に構築する

### 2. 指示の与え方

- 「書く」「分類する」「要約する」「翻訳する」などの明確なコマンドを使用

**実例：**

```
### 指示 ###
以下のテキストをスペイン語に翻訳してください。

Text: "hello!"
```

**出力：**

```
¡Hola!
```

- 指示はプロンプトの最初に配置し、「###」などの明確な区切り記号で指示と文脈を区切る

### 3. 特異性（具体性）を持たせる

- モデルへの指示やタスクについて非常に具体的に説明する
- プロンプトが詳細で具体的であるほど、結果は良くなる
- 例を提供することで特定のフォーマットの出力を得やすくなる

**実例：**

```
以下のテキストから場所の名前を抽出してください。

望ましいフォーマット：
Place: <comma_separated_list_of_places>

入力：「これらの進展は研究者にとって励みになっていますが、まだ多くのことが謎のままです。リスボンのシャンパリマウド・センター・フォー・ジ・アンノウンの神経免疫学者であるヘンリーク・ヴェイガ・フェルナンデスは、「脳と周辺部で見られる効果の間にはしばしばブラックボックスがあります」「治療的な文脈で使用したい場合、実際には作用機序を理解する必要があります。」」
```

**出力：**

```
Place: リスボンのシャンパリマウド・センター・フォー・ジ・アンノウン
```

### 4. 不正確さを避ける

- プロンプトは具体的で直接的であるべき
- 曖昧な表現や不正確な説明を避ける

**不適切な例：**

```
プロンプトエンジニアリングの概念を説明してください。説明は短く、数文で、あまり詳しくしないでください。
```

（どのように文を数え、スタイルを指定するかが明確でない）

**改善された例：**

```
高校生に対して、プロンプトエンジニアリングの概念を2〜3文で説明してください。
```

（対象者、文の数、トピックが明確に指定されている）

### 5. するかしないか？（Do vs. Don't）

- 「しないこと」ではなく「すること」を指示する方が効果的

**不適切な例：**

```
以下は、顧客に映画を推薦するエージェントです。興味を尋ねないで、個人情報を尋ねないでください。

顧客：私の興味に基づいて映画をお勧めください。
エージェント：
```

**出力：**

```
はい、あなたの興味に基づいて映画をお勧めできます。アクション、コメディ、ロマンス、それともその他の何か、どのような映画がお好きですか？
```

（禁止事項を守れていない）

**改善された例：**

```
以下は、顧客に映画を推薦するエージェントです。エージェントは、上位のグローバルトレンド映画から映画をお勧めする責任があります。ユーザーの好みを尋ねることを避け、個人情報を尋ねることを避ける必要があります。エージェントがおすすめ映画を持っていない場合は、「申し訳ありませんが、今日お勧めする映画が見つかりませんでした。」と返答する必要があります。

顧客：私の興味に基づいて映画をお勧めください。
エージェント：
```

**出力：**

```
申し訳ありませんが、あなたの興味に関する情報はありません。しかし、ここに今一番トレンディーな映画のリストがあります：[リストの映画]。お好きなものが見つかることを願っています！
```

（何をすべきかを具体的に指示され、期待通りに対応）

これらの実例からわかるように、プロンプトの具体性、指示の明確さ、フォーマットの指定がAIの回答の品質に大きく影響します。何をしないかではなく何をすべきかを伝え、可能な限り具体的に指示することで、より望ましい結果を得ることができます。

## プロンプトの例

## 概要

- 前のセクションでのLLMへのプロンプト提供方法の基本を踏まえ、より具体的なタスク例を紹介
- 例を通じて、プロンプトエンジニアリングの重要な概念を学ぶことができる
- 上手く作成されたプロンプトが様々なタイプのタスクをどのように実行できるかを示している

### 各タスクの詳細な例と要点

#### 1. テキスト要約

- **例1: 抗生物質の説明を求めるプロンプト**

  ```
  抗生物質について説明してください。
  A:
  ```

  - 出力: 抗生物質についての基本的な説明（細菌感染治療、作用機序、投与方法、限界など）
  - "A:"は質問応答フォーマットとして使用され、モデルに情報が必要であることを伝えている

- **例2: 1文での要約指示**

  ```
  抗生物質は、細菌感染を治療するために使用される薬剤の一種です。[...]
  上記を1文で説明してください。
  ```

  - 出力: 「抗生物質は、細菌感染を治療するために使用される薬剤であり、細菌を殺すか再生を防止し、ウイルスには効果がなく、過剰摂取によって抗生物質耐性を引き起こす可能性があります。」
  - 具体的な指示により、要約の形式を制御できることを示している

#### 2. 情報抽出

- **例: 段落からの情報抽出**

  ```
  研究論文の著者貢献声明や謝辞には、筆者が ChatGPT のようなAIテクノロジーを原稿および分析の準備に使用したかどうか、およびどの LLMs を使用したかが明確かつ具体的に記載されている必要があります。[...]
  上記の段落において言及されている大規模言語モデルベースの製品を述べてください。
  ```

  - 出力: 「上記の段落において言及されている大規模言語モデルベースの製品は ChatGPT です。」
  - 単純な指示でも効果的な情報抽出ができることを示している
  - AI製品開発者が既に活用している強力な能力

#### 3. 質問応答

- **例: 構造化されたQ&Aプロンプト**

  ```
  以下の文脈に基づいて質問に答えてください。回答を短く簡潔に保ちます。回答が不明な場合は、「回答不明」と回答してください。
  
  文脈：Teplizumabは、Ortho Pharmaceuticalと呼ばれるニュージャージー州の薬剤会社に由来します。[...]
  
  質問：OKT3はもともとどこから採取されたものですか？
  
  回答：
  ```

  - 出力: 「マウス。」
  - プロンプトの要素（指示、文脈、入力、出力インジケーター）を組み合わせることで改善された結果が得られる
  - 具体的な指示が良い結果をもたらすことを示している

#### 4. テキスト分類

- **例1: 基本的な感情分析指示**

  ```
  テキストをneutral、negative、またはpositiveに分類してください。
  
  テキスト：この食べ物はまずまずでした。
  所感:
  ```

  - 出力: 「Neutral」
  - 基本的な分類タスクは単純な指示で実行可能

- **例2: 例示を含む分類指示**

  ```
  テキストをneutral、negative、またはpositiveに分類してください。
  
  テキスト：先日の休暇はまずまずでした。
  所感: neutral
  
  テキスト：この食べ物はまずまずでした。
  所感:
  ```

  - 出力: 「neutral」（小文字表記）
  - プロンプト内に例を提供することで、出力形式を制御できることを示す
  - 「特定性」の重要性を強調している

- **例3: スペルミスを含む指示**

  ```
  テキストをnutral、negative、またはpositiveに分類してください。
  
  テキスト：先日の休暇はまずまずでした。
  所感:
  ```

  - 出力: 「Neutral」（大文字で始まる）
  - プロンプト内のスペルミス（「nutral」）があると、モデルは正しい綴りを推測し大文字表記になる
  - この例は特定性の重要性と注意深いプロンプト設計の必要性を示している

#### 5. 会話

- **例1: 技術的・科学的トーンの会話**

  ```
  以下はAI研究アシスタントとの会話です。アシスタントのトーンは技術的で科学的です。
  
  人: こんにちは、あなたは誰ですか？
  AI: やあ！私はAI研究アシスタントです。今日は何をお手伝いできますか？
  人: ブラックホールの生成について教えてもらえますか？
  AI:
  ```

  - 出力: 技術的で詳細なブラックホールの説明（特異点や時空の概念を含む）
  - 役割プロンプティング（role prompting）の例を示している

- **例2: 小学生向けの会話**

  ```
  以下はAI研究アシスタントとの会話です。アシスタントの回答は小学生でも理解できるようになっています。
  
  人: こんにちは、あなたは誰ですか？
  AI: やあ！私はAI研究アシスタントです。今日は何をお手伝いできますか？
  人: ブラックホールの生成について教えてもらえますか？
  AI:
  ```

  - 出力: 簡素化されたブラックホールの説明
  - 指示によって同じ質問に対する応答のトーンや複雑さが変化することを示している

#### 6. コード生成

- **例1: シンプルなJavaScriptプログラム**

  ```
  /*
  ユーザーに名前を聞いて、「こんにちは」と言ってください。
  */
  ```

  - 出力:

  ```
  let name = prompt("あなたの名前は何ですか？");
  console.log(`こんにちは、${name}さん！`);
  ```

  - 言語指定がなくても適切なコードを生成できる

- **例2: データベースクエリ生成**

  ```
  """
  テーブル名 departments、カラム=[DepartmentId、DepartmentName]
  テーブル名 students、カラム=[DepartmentId、StudentId、StudentName]
  コンピュータサイエンス学科のすべての学生のためのMySQLクエリを作成してください。
  """
  ```

  - 出力:

  ```
  SELECT StudentId、StudentName
  FROM students
  WHERE DepartmentId IN (SELECT DepartmentId FROM departments WHERE DepartmentName = 'Computer Science');
  ```

  - データベーススキーマに関する情報から適切なSQLクエリを生成
  - 特定のドメイン（データベース）知識を活用したコード生成の例

#### 7. 推論

- **例1: 基本的な算術計算**

  ```
  9,000 * 9,000は何ですか？
  ```

  - 出力: 「81,000,000」
  - 簡単な算術計算は問題なく処理できる

- **例2: 奇数合計の問題（最初の試み）**

  ```
  このグループの奇数の数値を合計すると偶数になります: 15, 32, 5, 13, 82, 7, 1。
  
  A:
  ```

  - 出力: 「いいえ、このグループの奇数の数値を合計すると奇数になります: 119。」
  - この回答は誤り（正しい計算をしているが、問題の意図を把握できていない）

- **例3: 改善された奇数合計の問題**

  ```
  このグループの奇数の数値を合計すると偶数になります: 15, 32, 5, 13, 82, 7, 1。
  
  問題をステップごとに解決してください。まず、奇数の数値を特定し、それらを合計して結果が奇数か偶数かを示してください。
  ```

  - 出力:

  ```
  奇数: 15, 5, 13, 7, 1
  合計: 41
  41は奇数です。
  ```

  - 「ステップごとに解決」という指示を追加することで精度が向上
  - 複雑な推論タスクでは高度なプロンプト技術が必要であることを示している

### 主要な洞察

1. **プロンプト設計の重要性**:
   - 指示、文脈、入力、出力インジケーターを組み合わせることでより良い結果が得られる
   - 特定性が高いほど、期待通りの出力が得られやすい

2. **例示の効果**:
   - プロンプト内に例を含めることで、出力の形式や内容を制御できる
   - 正しい動作を示す例は特に効果的

3. **役割設定の有効性**:
   - LLMの振る舞い、トーン、専門レベルを役割設定で制御できる
   - カスタマーサービスチャットボットなどの会話システムに特に有用

4. **複雑なタスクへの対応**:
   - 「ステップごとに解決」などの指示で推論タスクの精度を向上できる
   - 難しいタスクでは複数の例や詳細な指示が必要になる場合がある

5. **コード生成の可能性**:
   - LLMはコメントやスキーマ情報から複雑なコードを生成できる
   - 言語指定なしでも文脈から適切なプログラミング言語を判断できる

## Zero-Shotプロンプティング

大量のデータでトレーニングされ、指示に従うように調整されたLLMは、ゼロショットでタスクを実行することができます。前のセクションでいくつかのゼロショットの例を試しました。以下は、使用した例の1つです。

**プロンプト：**

```
テキストを中立、否定的、または肯定的に分類してください。

テキスト: 休暇はまずまずでした。
所感:
```

**出力：**

```
中立
```

上記のプロンプトでは、モデルに任意の例を提供していないことに注意してください。これがゼロショットの機能です。

指示のチューニングは、ゼロショット学習の改善を示しています [Wei et al. (2022)](https://arxiv.org/pdf/2109.01652.pdf)。指示の説明に従って説明されたデータセットでモデルを微調整することが、指示のチューニングの本質です。さらに、[RLHF](https://arxiv.org/abs/1706.03741)（人間のフィードバックからの強化学習）が指示のチューニングの拡大に採用されており、モデルが人間の好みにより適合するように調整されています。この最近の開発により、ChatGPTのようなモデルが強化されています。これらのアプローチと方法については、次のセクションで説明します。

ゼロショットが機能しない場合は、プロンプトにデモンストレーションや例を提供することをお勧めし、フューショットプロンプティングに移行します。次のセクションでは、フューショットプロンプティングをデモンストレーションします。

## Chain-of-Thoughtプロンプティング

### Chain-of-Thought (CoT) プロンプティング

Chain-of-thought (CoT)プロンプティングは、Wei et al. (2022)によって紹介された手法で、中間的な推論ステップを通じて複雑な推論能力を可能にします。few-shot promptingと組み合わせることで、推論が必要なより複雑なタスクでより良い結果を得ることができます。

例：

```
このグループの奇数を合計すると偶数になります。: 4、8、9、15、12、2、1。
A: 奇数を全て加えると(9, 15, 1)25になります。答えはFalseです。

このグループの奇数を合計すると偶数になります。: 17、10、19、4、8、12、24。
A: 奇数を全て加えると(17, 19)36になります。答えはTrueです。

このグループの奇数を合計すると偶数になります。: 16、11、14、4、8、13、24。
A: 奇数を全て加えると(11, 13)24になります。答えはTrueです。

このグループの奇数を合計すると偶数になります。: 17、9、10、12、13、4、2。
A: 奇数を全て加えると(17, 9, 13)39になります。答えはFalseです。

このグループの奇数を合計すると偶数になります。: 15、32、5、13、82、7、1。
A:
```

出力:

```
奇数を全て加えると(15, 5, 13, 7, 1)41になります。答えはFalseです。
```

興味深いことに、より少ない例（1つだけ）でもこのタスクは解決できます。著者たちはこれが十分に大きな言語モデルで生じる新興能力であると主張しています。

### Zero-shot COT Prompting

Zero-shot CoT（Kojima et al. 2022）は、元のプロンプトに「ステップバイステップで考えてみましょう」という文言を追加するだけの手法です。例えば：

プロンプト:

```
私は市場に行って10個のリンゴを買いました。隣人に2つ、修理工に2つ渡しました。それから5つのリンゴを買って1つ食べました。残りは何個ですか？
```

出力:

```
11個のリンゴ
```

（これは誤った答えです）

「ステップバイステップで考えてみましょう」と追加した場合:

```
私は市場に行って10個のリンゴを買いました。隣人に2つ、修理工に2つ渡しました。それから5つのリンゴを買って1つ食べました。残りは何個ですか？

ステップバイステップで考えてみましょう。
```

出力:

```
最初に、10個のリンゴから始めました。
隣人と修理工に合わせて、リンゴを2つずつ渡し、残りは6個になりました。
次に、5つのリンゴを買い、11個になりました。
最後に、1つのリンゴを食べたため、残りは10個になります。
```

この単純なプロンプト追加が効果的なのは驚くべきことで、特に例をあまり用意できない場合に有用です。
