---
title: "Makefileを便利コマンドメモとして使うことに対する違和感"
source: "https://www.takeokunn.org/posts/permanent/20250711132607-why_not_command_memo_makefile/"
author:
  - "takeokunn"
published: 2025-07-11
created: 2025-07-13
description: |
  yasunori氏がZennで発表した「職場のプロジェクトに必ず配置しちゃうMakefileの話」が広く受け入れられている状況に対し、筆者がMakefileをコマンドメモとして使用する手法に感じる違和感を言語化する記事。このアプローチの前提を整理し、代替案としてREADMEの充実などを提案する。
tags:
  - "Makefile"
  - "開発手法"
  - "チーム開発"
  - "README"
  - "ドキュメンテーション"
---

## 概要

本記事は、[yasunori氏のZenn記事「職場のプロジェクトに必ず配置しちゃうMakefileの話」](https://zenn.dev/loglass/articles/0016-make-makefile)で提案された、`Makefile`をコマンドメモとして活用する手法に対し、筆者が感じる違和感を整理し、代替案を提示するものです。この手法の有効性を認めつつも、特に長期的な保守性やチーム開発の観点から異なる視点を提供します。

補足記事として、yasunori氏による[APPENDIX: Makefileを便利コマンドメモとして使うことに対する違和感の記事を読んで](https://blog.yasunori0418.dev/p/appendix-makefile/)も公開されています。

## 前提整理：なぜMakefileを使うのか

筆者はまず、`Makefile`をコマンドメモとして導入する際の前提を以下の3つの観点から整理しています。

### 1. 想定される利用者

`Makefile`を利用する可能性のあるペルソナを4種類定義しています。

1. **非エンジニア寄りのデザイナー**: GUI操作を好み、環境構築に不慣れ。軽微な修正の確認が目的。
2. **プロジェクトに不慣れなプログラマ**: 新規参加者や外部協力者。迅速な環境立ち上げが目的。
3. **プロジェクトに精通したプログラマ**: リードエンジニアなど。開発フローの最適化や保守が目的。
4. **AI Coding Agent**: 明示的で構造化された手順を必要とする。

### 2. 想定されるプロジェクト規模

プロジェクトの規模を3段階に分類し、それぞれで`Makefile`の役割がどう変わるかを示唆しています。

| プロジェクト規模 | コード行数 | 特徴                                                               |
| :--------------- | :--------- | :----------------------------------------------------------------- |
| **小規模**       | 1万行程度  | 単一言語、依存ツールが少ない小規模なWebアプリケーション。            |
| **中規模**       | 10万行程度 | 複数機能、複数言語、開発用コマンドが比較的多いWebアプリケーション。  |
| **大規模**       | 100万行程度| 複雑な機能、複数言語、多数の開発用コマンドを持つ大規模アプリケーション。 |

### 3. Makefileで実行されるコマンド

コマンドを以下の3種類に大別しています。

* **マシン環境依存**: `brew install`, `npm install -g` など
* **プロジェクト環境依存**: `npm install`, `composer install` など
* **開発時利用**: `vendor/bin/phpstan`, `./gradlew build` など

元記事は主に「中〜大規模プロジェクト」で「プロジェクトに不慣れなプログラマ」を対象に、これらすべてのコマンドを管理するケースを想定していると分析しています。

## 個人的見解：Makefile利用への違和感

筆者は、利用者が満足しているならそれが最善であると前置きしつつ、環境構築の観点から以下の8つの違和感を挙げています。

### 1. 本来はREADMEを充実させるべき

最も重要な点として、**ドキュメントの充実**を挙げています。`Makefile`は文書として可読性が低く、コマンドの意図や背景が伝わりにくいためです。`README.md`に依存関係や実行コマンドを明文化することで、チームの技術的共通認識が形成され、属人化を防ぎ、長期的な保守性が向上すると主張します。また、`Makefile`と`README`での二重管理も問題点として指摘しています。

### 2. 非エンジニア向けには限定的に有効

ターミナル操作に不慣れなデザイナー向けに、`make up`のような単純なコマンドで済むようにするのは、限定的ながら有効な使い方だと認めています。これは、`docker compose up --build`のような複雑なコマンド入力を省き、作業のハードルを下げるためです。ただし、その場合でも提供するターゲットは最小限にすべきだとしています。

### 3. 熟練プログラマはMakefileを使わない

プロジェクトに精通した開発者は、抽象化されたコマンドよりも、意図した具体的なコマンドを直接実行する傾向があります。`Makefile`は不要な抽象化レイヤーとなり、かえって開発の足枷になる可能性があると指摘しています。また、メンテナンスがおざなりになりがちで、動作が保証されなくなるリスクも懸念しています。

### 4. マシン環境依存コマンドの管理への違和感

`brew install`のようなマシン全体に影響するコマンドはプロジェクト固有のツールではないため、`Makefile`で管理するのは不適切だと主張します。ワンショットで実行されるこれらのコマンドは`README`に記載し、ミドルウェアはDockerに寄せるべきだと考えています。

### 5. Targetが多すぎる問題

`Makefile`のターゲットが肥大化している状況は、プロジェクトの構造やワークフロー自体に根本的な歪みがある兆候かもしれないと警鐘を鳴らしています。これは「人が覚えきれないからMakefileに記述する」のではなく、「本来複雑であるべきでなかった設計を`Makefile`で補っているだけ」の状態に陥っている危険性を示唆しています。

### 6. 各言語のスクリプト機能に寄せるべき

`npm script`や`composer script`など、パッケージマネージャが標準で提供するスクリプト機能の利用を推奨しています。これにより、`package.json`などにスクリプト定義が統合され、エコシステムとの親和性が高まります。また、`npm run`でスクリプト一覧を確認できるため、学習コストが下がり、AIや新規参加者にも認識しやすくなるというメリットがあります。

### 7. 正規表現のメンテナンス性の低さ

`Makefile`内で多用されがちなShell Scriptや正規表現は、「書くのは速いが、読むのは苦痛」なものだと指摘。解読が困難で、長期的なメンテナンス性に欠けるため、構造化されたタスクランナーの標準に乗るべきだと主張しています。

### 8. AI Coding Agentフレンドリーではない

AIエージェントは構造化された明示的な規約やドキュメントに依存するため、DSLであり文脈が不透明になりがちな`Makefile`は解析が困難です。AIによる推論や補完を容易にするためにも、`package.json`のようなより規約に基づいた手法が合理的だと述べています。

## その他の論点

* **org-mode**: READMEの充実が本質であり、特定のエディタ機能に依存するのは望ましくない。
* **Shell Script**: テストが難しくメンテナンス性に課題があるため、複雑な処理はフレームワークのコマンド機能など、より堅牢な方法に寄せるべき。

## まとめ

結論として、`Makefile`をコマンドメモとして使うアプローチには一定の利便性があるものの、**「本来はREADMEを充実させるべき」**というのが筆者の中心的な主張です。新規開発者やAIエージェントを含むすべての関係者にとって、ドキュメントを正しくメンテナンスし続けることが、長期的には最も健全で効果的なアプローチであると締めくくっています。
