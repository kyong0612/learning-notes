---
title: "サービスにコンテナのヘルスチェックを構成する  |  Cloud Run"
source: "https://docs.cloud.google.com/run/docs/configuring/healthchecks?hl=ja"
author: Google Cloud Documentation
published: 2025-10-19
created: 2025-11-05
description: Cloud Runサービスでコンテナのヘルスチェックを構成する方法について説明するドキュメント。スタートアッププローブとlivenessプローブを使用して、コンテナが正しく実行され、トラフィックを受信する準備ができているかを確認する方法を解説。
tags:
  - Cloud Run
  - Google Cloud
  - Health Check
  - Container
  - DevOps
  - Kubernetes
---

## 概要

このドキュメントは、Cloud Runサービスにおけるコンテナのヘルスチェック構成について解説しています。スタートアッププローブとlivenessプローブを使用して、コンテナの正常な実行とトラフィック受信の準備状態を確認する方法を説明しています。

最終更新日: 2025年10月19日 UTC

## 主要概念

### スタートアッププローブ（Startup Probes）

- コンテナがトラフィックを受信する準備ができているかを判断
- 起動時にlivenessチェックが干渉するのを防ぐ
- 起動が遅いコンテナに特に有効

### livenessプローブ（Liveness Probes）

- コンテナの健全性を監視し、必要に応じて再起動をトリガー
- デッドロックなど、サービスは実行されているが進行しない状況に対処

## サポートされているプローブタイプ

1. **TCPソケットプローブ** - 指定されたポートへのTCP接続を確立
2. **HTTPプローブ** - ヘルスエンドポイントへHTTP GETリクエストを送信（HTTP/1が必要、HTTP/2は不可）
3. **gRPCプローブ** - gRPCヘルスチェックプロトコルを実装

## 設定方法

以下の方法で構成可能：

- Google Cloud ConsoleのUI
- `gcloud`コマンドラインインターフェース
- YAML設定ファイル
- Terraform（Infrastructure as Code）

## 重要な設定パラメータ

| パラメータ | 範囲 | デフォルト値 |
|-----------|-------|-------------|
| Initial Delay（初期遅延） | 0-240秒 | 0 |
| Period（期間） | 1-240秒（startup）、1-3600秒（liveness） | 10 |
| Failure Threshold（失敗しきい値） | 整数 | 3 |
| Timeout（タイムアウト） | 1-240秒（startup）、1-3600秒（liveness） | 1 |

## 重要な制約事項

- **HTTP/1の要件**: HTTPプローバーはHTTP/1の使用が必要。Cloud Runはデフォルトでこの設定を使用
- **再起動制限**: Cloud Runはクラッシュループを防ぐために再起動試行を自動的に制限
- **デフォルトタイムアウト**: デフォルトのTCPスタートアッププローブは240秒のタイムアウトを使用
- **リソース消費**: すべてのプローブ実行はCPUリソースを消費し、課金対象となる

## HTTPエンドポイントの要件

サービスは、設定されたパス（例: `/ready`, `/health`）に一致するヘルスチェックエンドポイントを実装する必要があります。これらのエンドポイントは、成功を示すために2XX-3XXのHTTPステータスコードで応答する必要があります。

## リソースへの影響

プローブは実行中にCPU割り当てを消費しますが、リクエストベースの料金は発生しません。CPUとメモリの使用量に対してのみ課金されます。

## まとめ

Cloud Runのヘルスチェックは、コンテナの健全性を確保し、トラフィックを受信する準備ができているかを判断するための重要な機能です。適切に設定することで、サービスの信頼性と可用性を向上させることができます。
