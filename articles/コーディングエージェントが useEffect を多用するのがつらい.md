---
title: "コーディングエージェントが useEffect を多用するのがつらい"
source: "https://zenn.dev/coji/scraps/c890994e6d42b4"
author:
  - "Coji Mizoguchi"
published: 2025-11-06
created: 2025-11-07
description: |
  コーディングエージェント（AI）が React の useEffect を多用する問題に対する解決策として、
  AGENTS.md に useEffect ポリシーを定義。useEffect は外部システムとの同期にのみ使用すべきで、
  アンチパターンと適切な使用原則を明示したガイドライン。
tags:
  - "React"
  - "useEffect"
  - "coding-agent"
  - "AI"
  - "best-practices"
  - "アンチパターン"
---

## 概要

コーディングエージェント（AI）は React コードを生成する際に `useEffect` を過剰に使用する傾向があります。この問題に対処するため、AGENTS.md に明確な useEffect ポリシーを定義することで、AI エージェントに適切な使用方法を指示します。

## useEffect ポリシー

### 基本原則

**useEffect は外部世界との同期にのみ使用すること**

具体的には以下の用途に限定：

- API 呼び出し
- WebSocket 接続
- ブラウザ API
- 外部ストアのサブスクリプション
- タイマー

**それ以外のケースでは使用してはいけません。**

## アンチパターン

以下の使い方は避けるべきです：

1. **Props や派生値をローカルステートにコピーする**
   - 不要な state の複製を作らない

2. **フラグの変更に応じてロジックを実行する**
   - 条件分岐はレンダリング時に行う

3. **イベントハンドラーの代わりに Effect 内でユーザーアクションを処理する**
   - ユーザーの操作は onClick などのイベントハンドラーで処理

4. **Effect 内で派生状態やバリデーション状態を更新する**
   - 計算可能な値は state ではなく、レンダリング中に計算

5. **空の依存配列で一度だけの初期化を実行する**
   - この用途には `useMemo` を使用

## 適切な使用原則

1. **レンダリング中に計算する**
   - props や state から派生できる値は、レンダリング中に計算する

2. **イベントハンドラーでユーザーアクションを処理**
   - Effect ではなく、イベントハンドラーでユーザーの操作に対応する

3. **Effect は本当の副作用のみに使用**
   - 外部システムに触れる実際の副作用に限定する

4. **コメントを追加する**
   - useEffect を書くときは必ず、どの外部リソースと同期しているかを説明する短いコメントを追加する

## 実践的な影響

このポリシーを AGENTS.md に追加することで：

- コーディングエージェントが生成するコードの品質が向上
- 不要な再レンダリングやバグの削減
- より保守しやすく、パフォーマンスの高い React コードの生成
- AI が React のベストプラクティスに沿ったコードを生成できるようになる

## まとめ

コーディングエージェントに適切な制約を与えることで、React の useEffect の誤用を防ぎ、より質の高いコードを生成させることができます。このアプローチは、AI とのペアプログラミングにおいて、明示的なガイドラインの重要性を示しています。
