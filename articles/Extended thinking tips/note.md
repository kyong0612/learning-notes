# Extended thinking tips

ref: <https://docs.anthropic.com/en/docs/build-with-claude/prompt-engineering/extended-thinking-tips>

## はじめに

このガイドはClaudeの拡張思考機能を最大限に活用するための高度な戦略とテクニックを提供します。拡張思考機能では、Claudeが複雑な問題をステップバイステップで解決する能力が向上し、最終回答の前に推論プロセスを確認できるため、結論に至った過程が透明化されます。

## 始める前に

このガイドは、すでに拡張思考モードを使用することを決定し、[拡張思考を始める方法](https://docs.anthropic.com/en/docs/about-claude/models/extended-thinking-models#getting-started-with-claude-3-7-sonnet)と[拡張思考実装ガイド](https://docs.anthropic.com/en/docs/build-with-claude/extended-thinking)の基本的なステップを確認したユーザーを対象としています。

## 拡張思考の技術的考慮事項

- **思考トークンの最小予算は1024トークン**です。ニーズとタスクの複雑さに応じて調整するため、最小思考予算から始めて徐々に増やすことをお勧めします。
- 最適な思考予算が32Kを超えるワークロードでは、ネットワークの問題を避けるために[バッチ処理](https://docs.anthropic.com/en/docs/build-with-claude/batch-processing)を推奨します。モデルが32Kトークンを超えて考えるようにプッシュするリクエストは、システムタイムアウトやオープン接続制限に対して長時間実行リクエストになる可能性があります。
- 拡張思考は**英語で最も効果を発揮**しますが、最終出力は[Claudeがサポートするあらゆる言語](https://docs.anthropic.com/en/docs/build-with-claude/multilingual-support)で可能です。
- 最小予算以下の思考が必要な場合は、標準モードで思考をオフにし、XMLタグ（`<thinking>`など）を使用した従来の思考連鎖プロンプティングを推奨します。詳細は[思考連鎖プロンプティング](https://docs.anthropic.com/en/docs/build-with-claude/prompt-engineering/chain-of-thought)を参照してください。

## 拡張思考のためのプロンプト技術

### 一般的な指示から始め、より詳細な指示でトラブルシューティングする

Claudeは詳細なステップバイステップの指示よりも、高レベルの指示で深く考えるように促すと効果的なことが多いです。モデルの問題解決アプローチの創造性は、人間が最適な思考プロセスを指示する能力を超えることがあります。

ただし、必要に応じて複雑な構造化実行ステップに効果的に従うこともできます。モデルは以前のバージョンよりも長いリストや複雑な指示にも対応できます。一般的な指示から始め、Claudeの思考出力を読んでから、より具体的な指示を提供して思考を導くことをお勧めします。

### 拡張思考でのマルチショットプロンプティング

[マルチショットプロンプティング](https://docs.anthropic.com/en/docs/build-with-claude/prompt-engineering/multishot-prompting)（複数例を示す手法）は拡張思考でも効果的です。Claudeに問題を考える方法の例を提供すると、拡張思考ブロック内で同様の推論パターンに従います。

`<thinking>`や`<scratchpad>`などのXMLタグを使用して、例での拡張思考の標準的なパターンを示すことができます。Claudeは正式な拡張思考プロセスにそのパターンを一般化しますが、最適な考え方をClaudeに任せた方が良い結果が得られる可能性もあります。

### 拡張思考での指示遵守の最大化

拡張思考が有効な場合、Claudeは指示の遵守が大幅に向上します。モデルは通常：

1. 拡張思考ブロック内で指示について推論します
2. 応答でそれらの指示を実行します

指示遵守を最大化するには：

- 要望を明確かつ具体的に伝えます
- 複雑な指示は、Claudeが計画的に取り組むべき番号付きステップに分割することを検討します
- Claudeに指示を十分に処理するための予算を与えます

### Claudeの動作をデバッグおよび操作するために拡張思考を使用する

Claudeの思考出力を使用してロジックをデバッグできますが、この方法は常に完全に信頼できるわけではありません。

この方法を最大限に活用するために、以下のヒントを推奨します：

- Claudeの拡張思考をユーザーテキストブロックに戻して渡すことは推奨されません。パフォーマンスが向上せず、結果が低下する可能性があります。
- 拡張思考の事前入力は明示的に許可されておらず、思考ブロック後のモデルの出力テキストを手動で変更すると、モデルの混乱により結果が低下する可能性があります。

拡張思考がオフの場合、標準の`assistant`応答テキストの[事前入力](https://docs.anthropic.com/en/docs/build-with-claude/prompt-engineering/prefill-claudes-response)は引き続き許可されます。

Claudeが拡張思考をアシスタント出力テキストで繰り返すことがあります。クリーンな応答が必要な場合は、拡張思考を繰り返さず、回答のみを出力するようClaudeに指示してください。

### 長い出力と長文思考を最大限に活用する

拡張思考が有効で[拡張出力機能（ベータ版）](https://docs.anthropic.com/en/docs/about-claude/models/extended-thinking-models#extended-output-capabilities-beta)を備えたClaudeは、大量のデータと長文テキストの生成に優れています。

データセット生成のユースケースでは、「非常に詳細な〜の表を作成してください」などのプロンプトを試して、包括的なデータセットを生成できます。

詳細なコンテンツ生成などのユースケースでは、以下のヒントを試してください：

- 最大拡張思考の長さを増やし、明示的に長い出力を求める
- 非常に長い出力（20,000語以上）の場合、段落レベルまでの単語数を含む詳細な概要を要求し、その後Claudeに概要に従って段落にインデックスを付け、指定された単語数を維持するよう依頼する

トークン数を単に増やすためにClaudeを利用することはお勧めしません。小さな思考予算から始め、ユースケースに最適な設定を見つけるために必要に応じて増やすことをお勧めします。

Claudeが長い拡張思考により優れた成果を発揮するユースケース例：

**複雑なSTEM問題**  
複雑なSTEM問題では、Claudeが精神モデルを構築し、専門知識を適用し、順次論理的ステップを実行する必要があり、これらのプロセスは長い推論時間から恩恵を受けます。

**制約最適化問題**  
制約最適化は、Claudeに複数の競合する要件を同時に満たすことを要求し、モデルが各制約を計画的に対処できるよう長い拡張思考時間を許可すると最も効果的です。

**思考フレームワーク**  
構造化された思考フレームワークはClaudeに明示的な方法論を提供し、各ステップに従うための長い拡張思考空間が与えられると最も効果的に機能します。

### 一貫性とエラー処理の向上のためにClaudeに作業の確認と反省を促す

単純な自然言語プロンプティングを使用して一貫性を向上させ、エラーを減らすことができます：

1. タスクを完了したと宣言する前に、簡単なテストで作業を検証するようClaudeに依頼する
2. 前のステップが期待された結果を達成したかどうかを分析するようモデルに指示する
3. コーディングタスクの場合、拡張思考でテストケースを実行するようClaudeに依頼する

## 次のステップ

- [**拡張思考クックブック**](https://github.com/anthropics/anthropic-cookbook/tree/main/extended_thinking) - クックブックで拡張思考の実践的な例を探索できます。
- [**拡張思考ガイド**](https://docs.anthropic.com/en/docs/build-with-claude/extended-thinking) - 拡張思考を実装するための完全な技術文書を参照できます。
