---
title: "スキーマと型で拓く Full-Stack TypeScript - Sohei Takeno / TSKaigi2025"
source: "https://www.youtube.com/watch?v=gitq8VvuslU"
author:
  - "Sohei Takeno"
published: 
created: 2025-07-03
description: |
  TSKaigi 2025について2024年に産声をあげ、大盛況のうちに幕を閉じた TSKaigi を今年も開催します！私たちは、誰かの発表を聞くだけでなく、他の誰かに向けて発表することもまた学びの一つだと考えています。 参加者、登壇者、スタッフ、スポンサーをはじめ、TSKaigi に関わるすべての人たちが互いに学...
tags:
  - "TypeScript"
  - "GraphQL"
  - "スキーマ駆動開発"
  - "フルスタック"
  - "アーキテクチャ"
---

本稿は、Sohei Takeno氏によるTSKaigi 2025での発表「スキーマと型で拓く Full-Stack TypeScript」の要約です。

## TL;DR

* **アーキテクチャ**: フロントエンドとバックエンドをGraphQLスキーマで明確に分離することで、開発の柔軟性と持続的な成長を両立させる。
* **開発体験**: スキーマ駆動開発により、APIの仕様（スキーマ）が単一の信頼できる情報源となり、フロントとバックエンド双方で型安全な開発を高速に実現できる。
* **価値**: スキーマと型は、単なる型安全性以上の価値をもたらす。AIコーディングとの親和性も高く、変更に強いアジャイルな開発を可能にする。

---

## 1. はじめに：フルスタックTypeScriptの理想形

発表者であるSohei Takeno氏（株式会社Sanu所属）が、フルスタックTypeScript開発において「どのような形が良いのか」という問いに対し、**GraphQLを用いたスキーマ駆動開発**という一つのスタイルを提案します。本セッションの目的は、このアプローチがもたらす価値と具体的な開発体験を共有し、参加者が自身のプロジェクトに活かすためのヒントを提供することです。

## 2. 発表の背景：ノーコードからの大規模リプレイス

本発表の知見は、Takeno氏が所属するSanu社での実践に基づいています。

* **初期フェーズ**: サービス（SANU 2nd Home）は、エンジニア不在の状態でノーコードツールを駆使して立ち上げられ、100以上の画面と1000以上のカラムを持つ規模にまで成長しました。
* **課題**: 事業拡大に伴い、ノーコードツールでは拡張性に限界が生じました。
* **解決策**: フルスタックTypeScriptによる全面的なリプレイスを実施。事業を止めずに新旧システムを並行開発するという高難易度のプロジェクトでした。

この経験を通じて、**変化が激しく、迅速な開発が求められる環境において、スキーマ駆動のアプローチが極めて有効であった**ことが、本提案の強力な裏付けとなっています。

## 3. アーキテクチャレベルの探求：スピードと持続的成長の両立

### 目指す姿

**「スピードを犠牲にせずに、持続的に成長するソフトウェアを作ること」**

この目標を達成するため、以下のアーキテクチャが採用されました。

### 設計思想：フロントエンドとバックエンドの明確な分離

* **責務の違い**:
  * **フロントエンド**: ユーザー体験を創造し、使いやすさ（対人性）を重視する。
  * **バックエンド**: データベースと連携し、ビジネスルールを扱い、システムの汎用性・信頼性を重視する。
* **分離の選択**: 両者の関心事が異なるため、明確に分離することを選択。これにより、各領域の専門性を高めつつ、システム全体の進化を容易にします。

### 分離技術としてのGraphQL

フロントエンドとバックエンドのインターフェースとして**GraphQL**を採用。

* **スキーマ定義**: まず、ソフトウェアのインターフェースをGraphQLスキーマとして定義します。
* **実装の依存**: フロントエンドとバックエンド双方が、このスキーマに依存して実装を進めます。
  * **バックエンド**: スキーマで定義された振る舞いを実装する。
  * **フロントエンド**: スキーマを元に必要なデータを問い合わせるクエリを発行する。
* **疎結合の実現**: スキーマという契約を介すことで、両者の結合度が下がり、独立した開発と進化が可能になります。

![Architecture Diagram](https://i.gyazo.com/d00b86a3d105c3165b4c483a8b41982b.png)

### アーキテクチャの進化可能性

この分離されたアーキテクチャは、将来的なシステムの進化に柔軟に対応できます。

1. **フロントエンドの多様化**:
    * ユーザー向けアプリだけでなく、運営者向けの管理画面など、ユースケースに応じて多様なフロントエンドが必要になる場合があります。
    * GraphQLスキーマがあれば、バックエンドを変更することなく、Retoolのようなローコードツールで管理画面を迅速に構築するなど、最適な技術を柔軟に選択できます。

2. **バックエンドの進化**:
    * 決済やスマートキー連携などの外部システム連携や、複雑なロジックを切り出したマイクロサービス化など、バックエンドの構造が複雑化しても対応可能です。
    * GraphQLは、これらの異なるデータソースを統合するゲートウェイとしての役割も果たせます。

### 短期的な開発スピードの担保

分離アーキテクチャの複雑さを感じさせず、開発スピードを維持するための工夫も凝らされています。

* **開発環境**: 1つのNext.jsサーバー内にバックエンドの処理も同居させることで、`1コマンド`で開発環境を起動・終了できる。
* **運用**: モノレポ構成とVercel連携により、インフラのセットアップを簡素化。
* **実行時最適化**: サーバーサイド（例: React Server Components）からGraphQLを呼び出す際に、HTTP通信を介さず、インプロセスの関数呼び出しに切り替えることで、レイテンシとコストを削減。

## 4. コードレベルの探求：スキーマと型がもたらす開発体験

### 例1：部屋一覧の表示

1. **スキーマ定義から始める**:
    * いきなりコードを書くのではなく、まずGraphQLスキーマでデータ構造（Area, Site, Roomなど）と関係性を定義します。
    * このプロセスは、UIの要素に名前をつけ、チーム内の**ユビキタス言語**を形成する助けとなります。

2. **バックエンド実装**:
    * スキーマを定義後、コード生成コマンドを実行すると、実装すべきリゾルバ（例: `rooms`を返す関数）の型定義が自動生成されます。
    * 開発者は、その型定義に従って数行のビジネスロジック（例: PrismaによるDBアクセス）を記述するだけで、APIを実装できます。

3. **フロントエンド実装 (Fragment Colocation)**:
    * コンポーネントが必要とするデータは、GraphQLフラグメントとして同じファイル内に記述します。
    * **変更が容易**: 例えば、「部屋にサウナ情報を追加したい」場合、該当コンポーネントのフラグメントに`sauna`フィールドを追加するだけで、データ取得からUI表示までの更新が完結します。変更がコンポーネント単位に閉じ込められ、修正が非常に容易になります。

![Component with Fragment](https://i.gyazo.com/0014e3049b4220b331000b1a0e194a28.png)

### 例2：新しいサービスプランの追加

1. **Union型によるモデリング**:
    * 複数のサービスプランを、GraphQLの`union`型として`ServiceProvider`を定義します。

2. **変更への対応**:
    * 新しいプランが追加された場合、この`union`型に新しい型を一行追加します。
    * その後、コード生成を行うと、**このUnion型を扱っているすべての箇所（ビジネスルール、UIコンポーネントなど）で型エラーが発生**します。
    * 開発者は、この型エラーを解消していくことで、**修正が必要な箇所を網羅的に把握し、実装漏れを防ぐ**ことができます。

このアプローチにより、ソフトウェアプロダクト全体の俊敏性（アジリティ）が大幅に向上します。

## 5. スキーマ駆動開発の価値

* **柔軟なフロントエンドと高精度なバックエンド**: フロントエンドはスキーマを元に柔軟に開発でき、バックエンドはスキーマという明確な入出力の規定により、精度の高い実装が可能になる。
* **開発時と実行時の両方での型安全性**: TypeScriptによる開発時の静的チェックに加え、GraphQLとデータベースのスキーマによる実行時の検証が加わることで、非常に堅牢なシステムが構築できる。
* **AIコーディングとの高い親和性**: スキーマは、人間だけでなくAIにとっても理解しやすい「共通言語」として機能する。スキーマをAIに与えることで、基本的なコードを自動生成させることができ、開発効率が向上する。

> スキーマ駆動開発は、単なる**型安全性を超える価値**を持つ。

## 6. 結論：2020年代のソフトウェア開発への提案

2010年代の技術的制約があった時代とは異なり、現代ではスキーマと型という強力なツールが成熟しています。

これらを軸としたフルスタックTypeScriptは、目先の開発効率だけでなく、ソフトウェアの構造を自分たちで制御し、**より持続可能な形で価値あるソフトウェアを創造していくための、本質的なアプローチの一つ**であると結論付けられました。
