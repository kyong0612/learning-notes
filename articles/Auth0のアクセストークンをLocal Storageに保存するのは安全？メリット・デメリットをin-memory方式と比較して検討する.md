---
title: "Auth0のアクセストークンをLocal Storageに保存するのは安全？メリット・デメリットをin-memory方式と比較して検討する"
source: "https://blog.flatt.tech/entry/auth0_access_token"
author:
  - "@okazu-dm"
  - "GMO Flatt Security"
published: 2022-08-02
created: 2026-01-14
description: "Auth0のSPA SDKにおけるアクセストークンのキャッシュ方法（in-memory方式 vs localStorage方式）について、セキュリティの観点から両者のメリット・デメリットを比較検討した技術記事。XSS攻撃に対する耐性の違いと、実際の選択指針を解説。"
tags:
  - Auth0
  - IDaaS
  - アクセストークン
  - localStorage
  - in-memory
  - XSS
  - セキュリティ
  - SPA
  - OpenID Connect
---

## 概要

この記事では、Auth0のSPA SDKでアクセストークンのキャッシュを有効化する際の考慮ポイントについて紹介し、アクセストークンの保存場所に関して**in-memory方式**と**localStorage方式**の2つについて解説している。

## Auth0について

- Auth0はAuth0社によって開発された**IDaaS**（Identity as a Service）
- **Open ID Connect**プロバイダとしての利用が可能
- 機能：ID管理、ロールベースのアクセス制御、MFA（多要素認証）など
- 様々な言語・フレームワーク向けのSDKを提供

## アクセストークンの保存方法

### 2つの選択肢

| 方式 | 説明 | デフォルト |
|------|------|-----------|
| **in-memory方式** | アクセストークンをブラウザのメモリ空間上にのみ保存（永続化しない） | ✅ |
| **localStorage方式** | localStorageにアクセストークンを永続化 | ❌ |

### localStorage方式の有効化

クライアント初期化時に`cacheLocation`プロパティを`localstorage`に指定することで有効化：

```javascript
// Auth0Client初期化時のオプション設定
{
  cacheLocation: 'localstorage'
}
```

### 共通のセキュリティ対策

どちらの方式でも以下の対策が重要：
- アクセストークンの**利用期限を短くする**
- アクセストークン自体の**権限を必要最低限にする**

## in-memory方式の特徴

### 動作
- アクセストークンが永続化されない（cookieやlocalStorageにデータを保存しない）
- アクセストークンを取得したタブ（またはウィンドウ）でのみ、そのトークンが使用可能

### デメリット
- **タブを開く度にアクセストークンの取得処理が走る**

## localStorage方式を選択するインセンティブ

開発者がlocalStorage方式を採用する動機：

1. **Rate Limit回避**
   - Auth0側へのリクエスト数を減らしたい
   - 無償利用テナント：1分あたり300リクエストの制限あり（記事執筆時点）

2. **ユーザー体験の改善**
   - 新しいタブを開いた際にアクセストークン取得処理をスキップ
   - コンテンツの読み込み完了までの時間を短縮

## セキュリティ観点での比較

### Auth0公式ドキュメントの見解

Auth0はin-memory方式を「**most secure option**」として推奨。

localStorageについては：
> トークン(アクセストークン)をlocalStorageに保存する手法は、ページの更新や別のタブを開いてもトークンを永続化することを可能にするが、**XSSが可能な場合は、攻撃者がlocalStorage内のトークンを取得可能**になる。XSSを可能にする脆弱性は、SPAのソースコード、またサードパーティのJavascriptコードのいずれかの中に存在する可能性がある

### 筆者の見解

in-memory方式の安全性について検討した結果：

- 攻撃者がXSSで任意のコードを実行可能な場合、**SPAがアクセストークンを取得する前後の処理も上書き可能**
- 結論：**「少なくともXSSからトークンを保護することはできない」**

### 攻撃難易度の違い

- localStorage：機械的にlocalStorageの内容を抜き出すことが可能
- in-memory：アプリケーションの仕組みに応じた攻撃が必要
- → **攻撃の難易度は多少の差がある**程度

## 重要な結論

> **どちらの方法においてもフロントエンドでアクセストークンを直接扱う以上、アクセストークンを完全に保護することは難しく、利便性とサービス側のユースケースに応じてどちらを採用しても良い程度の差**

**この2つの方法を比較した際に、セキュリティ的な側面からの実質的な差はない**と言える。

## 関連情報

徳丸浩氏のスライドからの引用：
> 「CookieとlocalStorageはどちらが安全とは言えず一長一短」「適材適所で使えば良い」

同様に、Auth0のアクセストークンの扱いも**挙動の差を把握し、サービスに適した方法を選択すること**が重要。

## 選択の指針

| 観点 | in-memory方式 | localStorage方式 |
|------|--------------|-----------------|
| XSS耐性 | 攻撃難易度やや高い | 機械的に抜き出し可能 |
| 実質的な安全性 | **差はない** | **差はない** |
| Rate Limit対策 | ❌ | ✅ |
| UX（タブ間共有） | ❌ | ✅ |
| Auth0推奨 | ✅ | ❌ |

## 補足

本記事の続編として、in-memory方式からアクセストークンを奪取するPoC（Proof of Concept）が別記事で公開されている。
