# How Does Vector Search Work in Qdrant?

ref: <https://qdrant.tech/documentation/overview/vector-search/>

## イントロダクション

Qdrantはベクトル検索技術を活用したデータベース・検索エンジンです。このドキュメントでは、ベクトル検索の仕組み、Qdrantのエコシステムにおける位置づけ、既存プロジェクトへの活用方法について説明しています。初心者向けに5-15分で検索エンジンを構築できる[完全初心者向けチュートリアル](https://qdrant.tech/documentation/tutorials/search-beginners/)も提供されています。

## 検索の簡単な歴史

人間の記憶は信頼性が低いため、書かれた「知識」を何度も読み返すことなく関連コンテンツを検索する方法が必要でした。そこで導入されたのが「転置インデックス」です。最も単純な形では、本の巻末にある重要な用語とそれが出現するページへのリンクのリストです。

![転置インデックスの簡略版](https://qdrant.tech/docs/gettingstarted/inverted-index.png)

時間が経過し、テキストデータの収集が加速するにつれて、転置インデックスを中心としたプロセスが発展しました。ユーザーが複数の単語を入力できるようにし、単語を分割したり、語幹に変換したり、ストップワードを削除するなどの処理が追加されました。

![トークン化プロセス](https://qdrant.tech/docs/gettingstarted/tokenization.png)

技術的には、ドキュメントとクエリは「スパースベクトル」にエンコードされます。スパースベクトルは辞書内の全単語に対応する位置を持ち、テキストに特定の単語が含まれていれば、その位置にゼロ以外の値が設定されます。ほとんどのテキストは多くても数百の異なる単語しか含まないため、ベクトルの大部分はゼロになります。

![クエリのスパースベクトル形式](https://qdrant.tech/docs/gettingstarted/query.png)

## バベルの塔

転置インデックスの問題点が発見されるたびに、新しいヒューリスティクスが導入されてきました。例えば、人々が同じ概念を異なる言葉で表現する可能性があることが分かると、クエリを正規化された形式に変換するための同義語リストが作成されました。しかし、これは予見できないケースには対応できません。また、言語は時間とともに変化するため、辞書を手動で維持する必要があります。多言語シナリオではさらに複雑な問題が生じます。

![バベルの塔、ピーテル・ブリューゲル](https://qdrant.tech/docs/gettingstarted/babel.jpg)

## 表現革命

NLPにおける最新の機械学習研究は、深層言語モデルのトレーニングに重点を置いています。このプロセスでは、ニューラルネットワークが大量のテキストを入力として受け取り、単語をベクトル形式で数学的に表現します。これらのベクトルは、類似した意味や文脈で使用される単語が一緒にグループ化され、類似したベクトルで表現されるように作成されます。

![ディープニューラル](https://qdrant.tech/docs/gettingstarted/deep-neural.png)

ニューラルネットワークによって生成されたこれらの「密ベクトル」は、異なるデータ表現として使用できます。スパースベクトルとは対照的に、密ベクトルの次元は比較的低く（数百から数千）、特定の単語の存在を表す次元ではなくなります。

密ベクトルは単語ではなく「意味」を捉えることができ、大規模言語モデルは自動的に同義語を処理できます。また、多言語コーパスでトレーニングされたニューラルネットワークは、異なる言語で書かれた同じ文を類似したベクトル表現（埋め込み）に変換できます。

![入力クエリの変換](https://qdrant.tech/docs/gettingstarted/input.png)

**ベクトル検索**は、埋め込みの類似性に基づいて類似オブジェクトを見つけるプロセスです。独自のニューラルネットワークを設計・トレーニングする必要はなく、HuggingFaceや[SentenceTransformers](https://www.sbert.net/)などのライブラリで多くの事前トレーニング済みモデルが利用可能です。または、[co.embed API](https://docs.cohere.com/reference/embed)などのSaaSツールを使用して埋め込みを作成することもできます。

## なぜQdrantなのか

ベクトル検索の課題は、大規模なオブジェクトセットから類似ドキュメントを見つける必要がある場合に発生します。最も近い例を見つけるために、単純なアプローチではすべてのドキュメントとの距離を計算する必要がありますが、これは数十や数百の例ではうまく機能しても、それ以上になるとボトルネックになる可能性があります。

Qdrantは完全なベクトルデータベースであり、グラフのような構造を使用して準線形時間で最も近いオブジェクトを見つけることで、検索プロセスを高速化します。つまり、データベース内のすべてのオブジェクトではなく、一部の候補とのみ距離を計算します。

![Qdrantによるベクトル検索](https://qdrant.tech/docs/gettingstarted/vector-search.png)

大規模なセマンティック検索を行う場合、効率的に実行するにはQdrantのような専門ツールが必要です。

## 次のステップ

ベクトル検索はスパース方式に代わる魅力的な選択肢です。手動でヒューリスティクスを維持する必要なく、キーワードベースの検索の問題を解決します。テキストをベクトルに変換するためのニューラルエンコーダーが必要です。

### チュートリアル

1. [**Qdrant完全初心者向けチュートリアル**](https://qdrant.tech/documentation/tutorials/search-beginners/)
   複雑な背景にもかかわらず、ベクトル検索の設定は非常に簡単です。Qdrantを使えば、5分で検索エンジンを稼働させることができます。

2. [**質問回答システム**](https://qdrant.tech/articles/qa-with-cohere-and-qdrant/)
   SaaSツールを選択してモデルの構築を避けることもできます。QdrantクラウドとCohere co.embed APIを使用したベクトル検索プロジェクトの設定は、このチュートリアルに従えば比較的簡単です。

ベクトル検索の魅力的な点は、データタイプをベクトル化するニューラルネットワークがあれば、あらゆる種類のデータを検索できることです。画像の逆検索も、ベクトル埋め込みで可能です。
