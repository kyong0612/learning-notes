---
title: "AIと協働し、イベントソーシングとアクターモデルで作る後悔しないアーキテクチャ Regret-Free Architecture with AI, Event Sourcing, and Actors"
source: "https://speakerdeck.com/tomohisa/regret-free-architecture-with-ai-event-sourcing-and-actors"
author:
  - "高丘 知央 (Tomohisa Takaoka)"
published: 2025-11-20
created: 2026-01-13
description: |
  AIを「コードを書いてくれる道具」としてではなく、開発者の設計能力を増幅する存在として捉え、イベントソーシングとアクターモデルを組み合わせて「後悔しないアーキテクチャ」を目指す考え方を紹介。複雑性（本質的 vs 偶有的）やスケールアウト、Always Valid Domain Model、CQRS、Dynamic Consistency Boundaryといったトピックについて解説。アーキテクチャConference 2025での発表資料。
tags:
  - "イベントソーシング"
  - "アクターモデル"
  - "CQRS"
  - "DDD"
  - "AI協働"
  - "アーキテクチャ"
  - "Sekiban"
---

## 概要

本セッションは「アーキテクチャConference 2025」で発表されたもので、AIを能力の増幅器として捉え、イベントソーシングとアクターモデルを組み合わせることで「後悔しない」アーキテクチャを実現する方法を提案しています。

**発表者**: 高丘 知央（株式会社ジェイテックジャパン CTO）

---

## 1. オープニング：変化の時代における開発者の選択

### 2025年、AIが当たり前の時代の問題

- 「AIがコードを書く」だけでは不十分
- 生成されたコードが積み重なり、**複雑性が爆発**する
- 動くが、将来の修正で破綻するコード
- **技術的負債を抱えたまま大量生産**される

### AIは道具であり、アーキテクチャは未来への羅針盤

- **AIは能力の増幅器**だが、ガードレールが必要
- アーキテクチャが「羅針盤」となり、方向性を示す
- イベントソーシングとアクターモデルで複雑性と戦う

### AIが加速させる本質的な課題：認知負荷

- コード量は10倍。しかし理解できる範囲は変わらない
- 「動くコード」と「保守できるコード」の差が拡大

---

## 2. AIとアーキテクチャ：能力の増幅器としてのAI

### AIの本質的な3つの力

1. **幅広い知識の補完**
   - 私たちが知らないことを知っている
   - 経験の差を一気に埋める
   - 技術選択、設計パターン、理論の根拠を引き出す

2. **文章・コード・情報の整理（要約力）**
   - 複雑な議論をかみ砕いて整理する
   - 大量のコードやログを一瞬で読み解く
   - 全体像を作ることが得意

3. **面倒なことをやってくれる作業力**
   - すぐに試せるプロトタイプを作る
   - 同じ処理を繰り返す

### Kent Beckの洞察

> "90% of my skills went to $0, but the other 10% went up 1000×."
> 「私のスキルの90%は価値ゼロになったが、残りの10%は1000倍になった」

- AIは「賢い計算機」であって、「責任を持つアーキテクト」ではない
- AIは知識を教えられるが、導き・対話・信頼関係は人間の役割

### AIは知識の代替ではなく、能力の増幅器

- 自分の能力を増幅する → 自身の設計能力向上が不可欠
- アーキテクトの能力を活かして、AIにガードレールを作り、正しく動作しやすい環境を作る
- **AIを能力向上のために使う**（和田 卓人 @t_wada さん）
  - Outputを出すためだけでなく、自分の能力を上げるために
  - 設計のバディとして使う
  - 批判的レビュアーとして使う
  - 根負けしない議論相手として使う

### AIとセキュリティ負債（Ory Segal, Palo Alto Networks）

> "An AI assistant's main value is speed, but that velocity often comes at the cost of code quality."
> 「AIアシスタントの主な価値はスピードですが、その速度はしばしばコード品質を犠牲にします。」

### アーキテクチャが「羅針盤」になる

> "Architecture is a compass, not a blueprint" - David Robertson (2008), Uwe Friedrichsen

**羅針盤と地図の違い**:
- 完全な地図は描けない - 環境は複雑で変化する
- 羅針盤は常に有用 - 方向を示し続ける
- アーキテクチャは動的 - ゴールではなく、旅の一部

### AI時代のアーキテクトの4つの役割

1. 遠くから観察する
2. チームを導く
3. 対話を続ける
4. 信頼関係を築く

---

## 3. 複雑性との戦い：本質的 vs 偶有的

### Fred Brooksの教え - 複雑性の2つの種類

| 種類 | 説明 |
|------|------|
| **本質的複雑性（Essential Complexity）** | ドメインに固有、除去不可能。ビジネスロジックの複雑さ |
| **偶有的複雑性（Accidental Complexity）** | 技術的制約、フレームワークで削減可能。実装の都合による複雑さ |

**問題**: 偶有的複雑性がドメインコードを侵食 - 技術的な制約が、ビジネスロジックを複雑にしてしまう

### テーブル駆動でドメインコード設計は困難（Eric Evans）

> "It can be done. I did it some... But it's very hard, maybe too hard."
> 「（ORマッパーと併用してテーブル駆動でドメイン設計を行うのは）できることはできる。私も何度かやった…でも、とても難しい。おそらく難しすぎる。」

### Eric Evans: 大容量メモリと新しい設計アイデア

> 「膨大な量のメモリを利用できるようになったため、本当に複雑な部分については、データを取り込んで、メモリ内に存在させる構造に変換できる。これが大きな制約を取り除いてくれます。」

### 「後悔しない」ための設計判断：偶有的複雑性の前払い

**アーキテクチャの羅針盤が示す方向：永続化手法からの分離**

- **テーブル駆動ではなく、ドメイン駆動** - RDBスキーマに引きずられない設計
- **将来のスケーラビリティを考慮** - 後でリニアにスケールできる構造
- **認知負荷の軽減** - 開発者が理解できる範囲を保つ
- **本質的複雑性に集中するための「前払い」** - ドメインのコア部分を純粋に設計

---

## 4. イベントソーシング：変更の意図を記録する

### イベントソーシングの本質

| 方式 | 説明 |
|------|------|
| **ステートソーシング** | データの現在の状態だけを保存、必要に応じて履歴も保存 |
| **イベントソーシング** | すべての変更を記録 |

**利点**:
- 何が起きたかの履歴が完全に残る
- 時間を遡ったデバッグが可能
- 監査ログとして機能
- **Append Data by Default** - イベントは貯蓄、後で分析する上で、ただのログより価値が高い

### CQRSとの組み合わせ（Command Query Responsibility Segregation）

- **コマンドモデル**: 変更の意図を処理
- **クエリモデル**: 読み取りに最適化

### トレードオフと判断基準

| 得られるもの | 失うもの/払うコスト |
|-------------|-------------------|
| 完全な監査ログ | 学習コスト（CRUD思考からの転換） |
| 時間を遡ったデバッグ | 初期実装コスト（イベントストア等） |
| 柔軟なクエリモデルの再構築 | 結果整合性（即座に見えない場合） |

**採用判断**:
- ✅ 適する: 監査要件、データ損失リスク大、長期運用、学習時間あり
- ❌ 適さない: 小規模短期、単純CRUD、習熟不足

### 集約ベース vs 動的一貫性境界（DCB）

- **集約ベースのイベントソーシング**: 集約を超えたイベントは登録できない。同じ意味のイベントを複数の集約、パーティションを分けたデータ領域に登録する
- **動的一貫性境界(DCB)のイベントソーシング**: イベントに動的にタグを紐づけ、より柔軟な設計が可能

### イベントソーシングとAIとの親和性

**「後悔しない」選択：データを消さない設計**

- **イベント = 貯蓄**: 削除せず保存 → 将来の分析・AIへの高品質な入力
- **AIの要約力**: イベント履歴から意図を抽出、パターンを発見
- **安全性**: データを消さない設計 - AIコーディング向き、データ削除のバグも追跡・復旧可能
- **GIGO原則の適用**: Garbage in, Garbage out（ゴミを入れればゴミが出る）

---

## 5. アクターモデル：責務を分離し、スケールする

### アクターモデルの基本

- **アクター**: 独立した処理単位
- **メッセージパッシング**: 非同期通信
- **状態のカプセル化**: 外部から直接アクセスしない

### DDDの集約とアクターモデルの融合

**同じ概念**:
- **集約ルート（Aggregate Root）**: Eric Evansの言ったように、メモリにオブジェクトを展開して、インメモリのオブジェクトで集約を管理するのが効率的
- **アクター**: 集約ごとにオブジェクト展開されて、インメモリのオブジェクトに対してメソッドを実行することができる
- **共通点**: メモリに置くことにより、DBに確認せずに処理を実行

### アクターモデルの実践方法（DDIA本より）

> 「アクターモデルではメッセージが単一プロセス内でさえ失われうることを前提としているため、RPCよりも場所の透過性がうまく働きます。...アクターモデルを用いるとローカルとリモートのコミュニケーションの基本的なミスマッチは少なくなります」

→ 分散システムの現実を受け入れた設計 → スケーラビリティと保守性

### トレードオフと判断基準

| 得られるもの | 失うもの/払うコスト |
|-------------|-------------------|
| 高いスケーラビリティ（水平分散が容易） | トランザクション制約: 複数集約にまたがる即座の整合性は困難 |
| 明確な責務分離 | 学習曲線: 非同期思考、メッセージパッシングへの慣れ |
| 並行処理の簡素化（ロック不要） | デバッグの複雑性: 分散システム特有の課題 |
| | インフラ要件: Orleans、Dapr等のフレームワーク |

### 「後悔しない」アーキテクチャ：最初からスケールアウト設計

- **将来の後悔を避ける**: 小規模時からスケールアウト可能な設計
- **リアーキテクチャのコスト回避**: 後から作り直すより、最初から正しい方向へ
- **段階的な成長に対応**: 小さく始めて、必要に応じてスケール
- **現実的なコストで始められる**: Sekiban等のフレームワークで月額5千円程度から

---

## 6. 後悔しないアーキテクチャへの道筋

### 後悔しないための4つの設計原則

1. **インメモリでAlways Valid Domain Model**
   - 永続化から分離: RDBスキーマに引きずられない純粋なドメインモデル
   - 常に正しい状態: イミュータブルモデル + 関数渡しで不変条件を保証
   - 後悔しないポイント: データベース変更でドメインロジックを書き直す必要がない

2. **Append Data by Default - データを消さない**
   - イベントは貯蓄、後で分析可能
   - 後悔しないポイント: 「あのデータ保存しておけば…」という後悔がない

3. **スケールアウト前提の設計**
   - 集約 = アクター: 最初から水平分散可能な境界設計
   - 段階的成長: 小さく始めて、必要に応じてスケール
   - 後悔しないポイント: システムが大きくなってからリアーキテクチャする必要がない

4. **CQRSで読み書きを分離**
   - それぞれを最適化: コマンドモデルとクエリモデルの独立進化
   - 柔軟な対応: 要件変更に強い構造
   - 後悔しないポイント: 読み取りの最適化が書き込みに影響しない

### 結合のバランス：モジュラーシステムへの道（Vlad Khononov）

> 「システムのコンポーネント間の相互作用を設計する際のゴールは、結合の強度を最小化することではない。ゴールは、実装や進化、メンテナンスが容易なモジュラーシステムを設計することだ。これは、結合の3つの次元すべてを考慮することでのみ達成できる」

### AIと協働しAIを能力の増幅器として活用

**アーキテクチャがAIのガードレールになる**:
1. **明確な境界**: 集約・アクターが責務を明確化 → AIへの指示が明確
2. **常に正しい状態**: Always Valid → AIが生成したコードも検証しやすい
3. **完全な履歴**: イベントソーシング → AIが過去の判断から学習

**開発者の役割は羅針盤を持つ航海士** - アーキテクチャの方針を決定（AIは方針に従う）

### 試して、小さく始めて、育てていく

**Phase 1: 小規模スタート**
- インメモリのドメインモデルを設計
- 基本的なイベントストア（シンプルなもので良い）
- 単一インスタンスでも動作

**Phase 2: 成長に合わせて**
- アクターモデルのフレームワーク導入（Orleans、Dapr等）
- クエリモデルの最適化
- 水平スケールアウト

→ Sekiban等のフレームワーク活用で、最初から「後悔しない」設計を低コストで始められる

### トレードオフの正直な評価

**前払いするコスト**:
- 学習投資: イベントソーシング、アクターモデルの理解
- 初期設計: ドメインモデルの純粋性を保つ設計思考
- フレームワーク選定: 適切なツールの選択

**避けられる後悔**:
- 「あのデータ保存しておけば…」
- 「スケールアウト設計にしておけば…」
- 「永続化から分離しておけば…」
- 「リアーキテクチャに数ヶ月かかる…」

**判断基準**: 将来のリアーキテクチャコスト >> 最初の設計投資

---

## 7. クロージング：未来を切り拓く

### 本日のキーメッセージ

**「後悔しない」アーキテクチャの4つの柱**:
1. **インメモリでAlways Valid**: 永続化から分離された純粋なドメインモデル
2. **データを消さない**: イベントは貯蓄。完全な履歴が未来の資産
3. **最初からスケールアウト設計**: 小さく始めて、大きく育てる
4. **読み書きを分離**: それぞれの進化を独立させる

**AI時代における開発者の役割**:
- AIは能力の増幅器: 真価は要約力にある
- アーキテクチャは羅針盤: 方向を示し続ける

### それでも設計、実装は簡単ではない

**これらは「銀の弾丸」ではない**:
- 学習コスト: イベントソーシング、アクターモデルの理解が必要
- 初期投資: ドメインモデル設計の時間
- チーム育成: 新しいパターンの習得

**しかし、後悔しないための投資**:
- 「あの時こうしておけば…」という後悔を避ける
- 将来のリアーキテクチャコスト >> 最初の設計投資
- よくできたフレームワークを使用することにより、「設計の高速道路」に乗れる

### まとめ

**「後悔しない」とは**:
- **「完璧」ではなく「選択に納得できる」こと**
- データを消さない → 保存しておけば良かったという後悔をしない
- 永続化から分離 → RDB変更でドメインロジックを書き直す後悔をしない
- スケールアウト設計 → システムが大きくなってから作り直す後悔をしない

**変化を恐れず、未来を切り拓く**:
- AIという増幅器を通じて、持続可能な品質向上へ
- アーキテクチャという羅針盤を手に、航海を続ける

---

## 参考文献・リソース

### 書籍・論文・ブログ
- David Robertson "Architecture is a compass, not a blueprint" (2008) - Enterprise Architecture Conference in London
- Uwe Friedrichsen - Blog post on Architecture as Compass (2011)
- Fred Brooks "No Silver Bullet"
- Eric Evans - DDD EU 2016
- Vlad Khononov『ソフトウェア設計の結合バランス』
- Martin Kleppmann『データ指向アプリケーションデザイン』

### 関連リンク
- **株式会社ジェイテックジャパン**: https://www.jtechs.com/japan/
- **Sekiban（イベントソーシング・CQRSフレームワーク）**: https://github.com/j-tech-japan/sekiban
- **Zenn - ジェイテックジャパンブログ**: https://zenn.dev/p/jtechjapan_pub

### 発表者情報
- 高丘 知央 (Tomohisa Takaoka)
- X: @tomohisa
- GitHub: @tomohisa
