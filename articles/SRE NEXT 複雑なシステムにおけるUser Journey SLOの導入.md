---
title: "[SRE NEXT] 複雑なシステムにおけるUser Journey SLOの導入"
source: "https://speakerdeck.com/yakenji/sre-next-fu-za-nasisutemuniokeruuser-journey-slonodao-ru"
author:
  - "yakenji"
published: 2025-07-14
created: 2025-08-13
description: |
  メルカリのSREチームが、複雑なマイクロサービスアーキテクチャにおいて、顧客体験に焦点を当てたUser Journey SLOをいかにして導入したかを解説する資料。従来のサービス単位のSLOから、複数のサービスを横断する顧客の主要な操作（Critical User Journey）に基づいたSLOへの移行の背景、動機、具体的な導入プロセス、そしてその効果について詳述されています。
tags:
  - "SRE"
  - "SLO"
  - "UserJourney"
  - "Microservices"
  - "Monitoring"
---

## 概要

本資料は、メルカリのSRE、土屋健司氏によるSRE NEXT 2025での発表内容です。複雑なマイクロサービス環境において、従来のサービス単位のSLO監視では顧客影響の全体像を把握しにくいという課題に対し、顧客の重要な操作（Critical User Journey, CUJ）に基づいたSLO（User Journey SLO）を導入した取り組みについて解説しています。

---

## 発表者

* **土屋健司 (@yakenji)**
  * SIerで大規模システムの性能問題解決を経験後、2024年にメルカリ入社。
  * Platform SREとして、新規サービス立ち上げ支援やメルカリ全体のモニタリングを担当。
  * 現在はPlatform Networkチームに所属。

---

## 背景と動機

### 従来の障害対応の課題

* **サービスごとの分断された対応**: メルカリでは各開発チームが自身のサービスのSLO設定、モニタリング、オンコール対応を実施。
* **影響範囲の不明確さ**: 1つのサービスの障害が、どのユーザージャーニーにどれだけの影響を与えるのかを即座に把握することが困難でした。
  * 例: 発送機能はShipping, Item, User, Transactionなど複数のサービスに依存。
* **顧客視点の欠如**: 各サービスのSLOを達成していても、顧客が特定の操作を完了できないという事態が発生しうる。障害発生時に「顧客が何ができなくなったのか」が不明確でした。

これらの課題から、**ユーザージャーニーに沿った顧客目線のSLO**の必要性が高まりました。

---

## User Journey SLOの導入

### 1. 基本方針

* **1 User Journey, 1 single SLO**: 1つのユーザージャーニーに対しては、シンプルに1つのSLOを設定。多少の誤差は許容し、複雑化を避ける。

### 2. SLIの設定

* **計測可能なメトリクスから定義**:
  * **Availability**: クリティカルなAPI群のAvailabilityの最低値 (`min(AA, AB)`) を採用。
  * **Latency**: クリティカルなAPI群のLatencyの掛け算 (`SA × SB`) を採用。
  * ここでいうクリティカルAPIとは、そのAPIの障害が直接ユーザージャーニーの失敗につながるものを指します。
* **トライ＆エラーの重視**: SLI定義はコード化し、後からチューニング可能にすることが重要。

### 3. Critical User Journey (CUJ) の定義

* **40のCUJを定義**:
  * 画面操作と画面遷移の組み合わせで定義。
  * 「Availableな状態」を明確にする。
  * 商品検索、出品、購入、発送などのコア機能にフォーカス。

### 4. クリティカルなAPIの探索

* **障害注入による探索**: 各CUJで利用されるAPIをリストアップし、1つずつ擬似的に障害を発生させ、アプリの挙動（Availableかどうか）を判定。
* **自動化**: アプリは日々変化するため、既存のテストフレームワークを流用してこの探索プロセスを自動化し、クリティカルAPIのリストを常に最新の状態に保つ。

---

## 導入後の成果

* **影響範囲の即時特定**:
  * 障害発生時に、影響を受けるCUJを特定したアラートがSlackに通知される。
  * Slack botにより、影響範囲（何ができて、何ができないか）が一覧化される。
* **原因調査の迅速化**:
  * LookerでクリティカルAPIのリストを可視化。
  * TerraformでAPM（Datadogなど）のモニタリング設定に半自動で反映。
  * CUJごとのダッシュボードでクリティカルAPIのメトリクスを可視化し、障害の一次情報源として活用。原因となっているサービスへのコンタクトポイントも明記。

---

## 今後の取り組みと課題

* **テストシナリオのメンテナンス**:
  * 自動化は進めたが、UIの大幅な変更など、テストシナビオ自体のメンテナンスは依然として必要。
* **AI Agentによるテスト保守の自動化**:
  * `Cursor`や`Claude Code`などのLLMを活用し、テストコードのメンテナンスを自動化する試みを進行中。
  * 将来的にはQAサイクルへの組み込みを目指す。

---

## まとめ

* **顧客視点の品質可視化**: User Journey SLOの導入により、顧客が実際に感じるサービス品質を数値化し、障害発生時に「何ができて何ができないのか」を即座に把握できるようになった。
* **陳腐化しない仕組み**: アプリの変化に追従できるよう、SLO定義やクリティカルAPIの特定を自動化。SLOと現実が乖離しないように、継続的なアップデートが重要。
* **メンテナンスとの闘い**: システムが進化し続ける限り、SLOやその計測方法のメンテナンスは継続的な課題である。

---

**採用情報**: メルカリではクラウドネットワークエンジニアを募集中です。
[https://apply.workable.com/mercari/j/08F0B7531B/](https://apply.workable.com/mercari/j/08F0B7531B/)
