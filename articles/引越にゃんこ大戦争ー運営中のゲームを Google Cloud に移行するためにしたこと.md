---
title: "引越にゃんこ大戦争ー運営中のゲームを Google Cloud に移行するためにしたこと"
source: "https://www.youtube.com/watch?v=2TsoGJdFu4I"
author:
  - "ポノス株式会社 門脇 幹宏"
  - "ポノス株式会社 白井 亨"
published: 2024-10-15
created: 2025-07-29
description: "にゃんこ大戦争のバックエンドをGoogle Cloudに移行したプロセスを紹介。運営中のゲームを無停止で移行するための工夫、移行前後の構成、期待効果を詳述。"
tags:
  - "Google Cloud"
  - "クラウド移行"
  - "Spanner"
  - "Cloud Run"
  - "ゲーム開発"
  - "clippings"
---

![](https://img.youtube.com/vi/2TsoGJdFu4I/0.jpg)

## 導入と会社紹介

ポノス株式会社はスマートフォンゲームをグローバルに展開。企業スローガン「Go Far Beyond - 斜め上を行け」を掲げ、京都本社と東京オフィスで運営。スピーカー: 門脇幹宏氏（プロジェクトマネージャー）、白井亨氏（サーバーエンジニアチームリーダー）。

## ゲームの歴史と移行背景

にゃんこ大戦争は2012年日本版リリース、12周年を迎える。累計9,400万ダウンロード、9言語対応。サーバーアプリの更新後、インフラ更新を検討。ユーザー影響をゼロに抑え、作業工数を最小化。Google Cloudのマネージドサービスを選択。Tech Acceleration Program (TAP)でサポートを受け、移行アイデアを具体化。

## 移行プロセスと期待効果

2023年夏に初回TAP実施、移行計画立案。移行作業残す状態。期待効果: (1) メンテナンス時のユーザー影響低減、(2) 作業工数低減、(3) 運用費用15%削減（データベース見直し含む）、(4) 移行ノウハウ蓄積で将来の柔軟性向上。

## 移行前の構成と課題

バックエンド: Elastic Beanstalk管理のEC2インスタンス、Auroraクラスター。ログ: Aurora/S3分散、Athena/BigQuery使用。課題: Auroraメンテナンスの影響（数秒のダウンタイム、調整作業）、ログ検索の分散（オーロラ、S3、BigQuery）、サービス複雑化（役割重複）。

## 移行後の構成

- データベース: Aurora MySQLからSpannerへ (メンテナンスレス、1インスタンスで複数DB。スキーマ/コード変更必要だが、基本クエリ対応。連番/アップサート最近サポート)。
- ログ: BigQueryに一元化（オーロラ/S3からの統合）。
- 実行環境: Cloud Run (マルチコンテナ、Nginx + PHP-FPM。サービス統合でスリム化)。TAPで動作原理理解。

![](https://img.youtube.com/vi/2TsoGJdFu4I/1.jpg)  // 移行後構成図のイメージ

## 無停止移行のための引っ越しサービス

運営中ゲームのため、メンテナンスなし（ポリシーによる）。古いクライアント対応。引っ越しサービス: Cloud VPNでAWS-GCP接続、アクセス時AuroraからSpannerへデータ移行（シンプルクエリ）。非アクティブデータは後日一括移行。アクティブユーザー影響ゼロ。

![](https://img.youtube.com/vi/2TsoGJdFu4I/2.jpg)  // 引っ越しサービス図のイメージ

## 移行プロセス詳細

- 2023夏: TAPでプロトタイピング。
- 2024頭: GCP環境構築、引っ越しサービス実装。
- 社内承認: 課題説明、メリット提示、無停止移行約束、説明会。
- 負荷テスト: GKE Autopilot + Locust使用。Cloud Traceで分析 (OpenTelemetry活用、バッチプロセッサー設定でクォータ回避)。パフォーマンス問題解決 (PHPチューニング)。
- 移行準備: DNS切替懸念のためAWSをリバースプロキシ化（新ドメイン使用）。移行当日リハーサル、切り戻し手順確認、事故対応訓練。社内ツール整備 (環境意識不要、UI変更最小限)。

## まとめと結論

インフラ改善で運用負荷低減、無停止移行実現。ポノス株式会社、サーバーエンジニア募集中。

**重要な結論**: 独自引っ越しサービスと事前検証でユーザー影響ゼロを目指す。長期運用資産としてノウハウ蓄積。

**制限事項**: 移行作業未完了 (発表時点)。MySQLからSpanner移行でスキーマ/コード変更必要。Cloud Traceクォータ注意。
