---
title: "【Claude Code】サブエージェントを並列で実行して処理時間を短縮&コンテキスト圧縮を避ける方法"
source: "https://light11.hatenadiary.com/entry/2025/07/29/193020"
author:
  - "Haruma:K (id:halya_11)"
published: 2025-07-29
created: 2025-07-31
description: |
  Claude Codeでサブエージェントを並列で実行して処理時間を短縮し、コンテキスト圧縮を避ける方法について解説します。この記事では、サブエージェントの概要、手動でのカスタムエージェント作成方法、動作確認、そして複数のサブエージェントを並列実行する具体的な手順を紹介しています。
tags:
  - "clippings"
  - "Claude Code"
  - "AI Agent"
  - "performance"
  - "sub-agent"
---

## 概要

本記事では、Claude Codeの「サブエージェント」機能を活用し、複数のタスクを並列実行することで処理時間を短縮し、コンテキストウィンドウの消費を抑える方法を解説します。

## 1. サブエージェントとは？

Claude Codeでは、特定の役割を持つ「カスタムエージェント」を作成し、メインのエージェントから「サブエージェント」として呼び出すことができます。

### 主なメリット

* **コンテキストの節約**: エージェントごとにコンテキストが分離しているため、独立したタスクを委譲することで、メインのコンテキストを圧迫しません。
* **処理の高速化**: 複数のサブエージェントを並列で実行できるため、タスク全体の処理時間を短縮できます。
* **再利用性**: 一度作成したエージェントは、様々な場面で再利用可能です。

詳細は[公式ドキュメント](https://docs.anthropic.com/en/docs/claude-code/sub-agents)を参照してください。

## 2. カスタムエージェントの作成方法

`/agent` コマンドによる対話形式での作成も可能ですが、本記事ではより細かい制御が可能な手動での作成方法を紹介します。

### 例：命名規則チェックエージェント

以下のようなMarkdownファイルを作成し、`.claude/agents/naming-checker.md` として保存します。

```markdown
---
name: naming-checker
description: コードの命名規則をチェックするエージェント
color: green
---

# 命名規則チェック用の指示
あなたはコードの命名規則をチェックする専門エージェントです。
以下の観点から命名をレビューしてください。

- 変数名、関数名の命名が適切か
- キャメルケース、スネークケースなどの記法が統一されているか
- 意味のある名前が付けられているか
- 省略形の使用が適切か

レビュー結果は具体的な改善提案とともに報告してください。
```

* `name`: エージェントの呼び出し名
* `description`: エージェントの説明
* `color`: UI上での識別に使う色（`green`, `purple`など）

## 3. 動作確認

作成したエージェントは、Claude Codeを再起動後、`@`マークで呼び出せます。

```
@naming-checker 最新のコミットをレビューして
```

これにより、指定したエージェントがサブプロセスとして起動し、指示されたタスクを実行します。エージェント名には指定した色が背景色として表示され、視覚的に区別しやすくなります。

*(画像: エージェントの候補一覧と、サブエージェントが起動した際のUIのスクリーンショットがここにありました。)*

## 4. 複数のサブエージェントを並列実行

同様の手順で、別の機能を持つエージェント（例：パフォーマンス分析エージェント）を作成します。

**performance-analyzer.md:**

```markdown
---
name: performance-analyzer
description: コードのパフォーマンスを分析するエージェント
color: purple
---

# パフォーマンス分析用の指示
あなたはコードのパフォーマンスを分析する専門エージェントです。
以下の観点からパフォーマンスをレビューしてください。

- アルゴリズムの時間計算量・空間計算量
- ループの効率性とネストの深さ
- データ構造の適切性
- ...など
```

複数のエージェントを同時に呼び出すことで、並列処理が可能です。

```markdown
@naming-checker と @performance-analyzer を同時に起動して、最新のコミットをレビューして
```

これにより、2つのサブエージェントが同時に起動し、それぞれのタスクを並列で実行します。結果はメインのエージェントが集約して報告します。

*(画像: 2つのサブエージェントが並列で実行されているUIのスクリーンショットがここにありました。)*

### 注意点

並列実行がうまくいかない場合は、プロンプトの表現を工夫することで解決する場合があります。

## 結論

Claude Codeのサブエージェント機能は、タスクをモジュール化し、並列実行することで開発効率を大幅に向上させる強力なツールです。コンテキストを節約しながら複数の専門的な分析を同時に行えるため、複雑なワークフローの自動化に非常に有効です。

## 参考

* [Claude Code Sub-Agents Documentation](https://docs.anthropic.com/en/docs/claude-code/sub-agents)
