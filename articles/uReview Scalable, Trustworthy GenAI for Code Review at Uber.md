---
title: "uReview: Uberにおけるスケーラブルで信頼性の高いGenAIコードレビュー"
source: "https://www.uber.com/en-IN/blog/ureview/"
author:
  - "[[Sonal Mahajan]]"
published: 2025-08-12
created: 2025-08-15
description: |
  コードレビューはソフトウェア開発の中核であり、信頼性、一貫性、安全性を確保する上で重要です。しかし、サービスの複雑化に伴い、従来のピアレビューは新たな課題に直面しています。Uberではこれらの課題に対処するため、AIコードレビュープラットフォーム「uReview」を開発しました。
tags:
  - "clippings"
  - "GenAI"
  - "CodeReview"
  - "Uber"
---

# uReview: Uberにおけるスケーラブルで信頼性の高いGenAIコードレビュー

## 導入

- コードレビューは、ソフトウェア開発においてコードベースの信頼性、一貫性、安全性を確保するための中心的な要素です。
- サービスが複雑化するにつれ、従来のピアレビューは以下のような課題に直面しています。
  - AI支援によるコード開発でコード量が増加し、レビュー担当者の負担が増している。
  - 微妙なバグやセキュリティ問題、ベストプラクティスの徹底を見抜く時間が限られている。
- これらの課題は、エラーの見逃し、フィードバックの遅延、本番環境でのインシデント、リソースの無駄遣い、リリースサイクルの遅延につながる可能性があります。
- これらの問題を大規模に解決するため、UberはAIコードレビュープラットフォーム **uReview** を開発しました。

### uReviewの概要

- uReviewは、AIレビュアーを追加することでコードレビュープロセスを強化します。
- 中核システム **Commenter** は、機能的なバグ、エラーハンドリングの問題、セキュリティ脆弱性、社内コーディング標準の遵守などを特定します。
- **Fixer** は、人間またはAIからのコメントに応じて実際のコード変更を提案します。
- uReviewは、Uberで毎週約65,000件の差分（プルリクエストに相当）の90%以上を分析しています。
- エンジニアはuReviewのコメントの75%を「有用」と評価し、投稿されたコメントの65%以上が対処されています。

## uReviewの仕組み

uReviewは、モジュール式の多段階GenAIシステムであり、コードレビューのタスクを4つのサブタスクに分解しています。

![uReview pipeline](https://blog.uber-cdn.com/cdn-cgi/image/width=2160,quality=80,onerror=redirect,format=auto/wp-content/uploads/2025/08/figure2-llm-17549522932245-1024x417.png)

### 1. 取り込みと前処理 (Ingestion and Preprocessing)

- 開発者がコード変更を送信すると、uReviewはまず自動レビュー対象のファイルを決定します。
- 設定ファイル、生成されたコード、実験的なディレクトリなど、シグナルの少ないターゲットは除外されます。
- 対象ファイルに対して、関数、クラス定義、インポート文などの周辺コードコンテキストを含む構造化されたプロンプトを構築します。

### 2. 特化されたアシスタントによるコメント生成 (Comment Generation by Specialized Assistants)

- uReviewは、特定の問題クラスに焦点を当てたプラグイン可能なアシスタントフレームワークを使用しています。
- 各アシスタントは独立して開発・評価でき、カスタマイズされたプロンプトとコンテキストを使用します。
- 現在3つのアシスタントが稼働中で、さらに拡大予定です。

### 3. 後処理と品質フィルタリング (Post-Processing and Quality Filtering)

- GenAIコードレビューの主な課題は、誤検出（False Positive）です。
- uReviewは、堅牢な後処理と品質フィルタリングでこの課題に対処します。
    1. **品質評価**: 副次的なプロンプトが各コメントの品質を評価し、信頼度スコアを割り当てます。
    2. **意味的類似性フィルタ**: 重複する提案を統合します。
    3. **カテゴリ分類**: 各コメントにタグを付け（例: `correctness:null-check`）、開発者にとって価値が低いと判断されたカテゴリを抑制します。
- これらのフィルターにより、高品質で実用的なフィードバックのみが提供されます。

### 4. 評価と継続的改善 (Evaluation and Continuous Improvement)

- uReviewは自動および手動の方法でパフォーマンスを評価します。
  - **自動評価**: 最終コミットに対してuReviewを5回再実行し、コメントが対処されたかを評価します。
  - **手動評価**: 既知の問題を含むコミットのベンチマークセットを使用し、精度（Precision）、再現率（Recall）、F1スコアを評価します。
- 両方のフィードバックが、信頼度閾値、プロンプト、フィルタリングロジックの調整に役立てられます。

## 影響と評価

### 高い有用性

- uReviewは、すべてのジェネレーターで75%以上の持続的な有用率を維持しています。
- 投稿されたコメントの平均65%が同じ変更セット内で対処されています。
- これは、人間によるレビュー（バグとして認識され対処されるのは51%）を大幅に上回ります。

### 開発者の時間節約

- uReviewは毎週10,000以上のコミットを処理します。
- uReviewが特定する種類の問題を人間がレビューするには、コミットあたり10分かかると見積もられています。
- これにより、毎週約1,500時間、年間で約39人年の開発者時間を節約している計算になります。

### モデルの経験的評価

- 最適なLLM構成を特定するため、ベンチマークテストを実施しました。
- 最も効果的だったのは、**Anthropic Claude-4-Sonnet** をプライマリコメントジェネレーター、**OpenAI o4-mini-high** をレビューグレーダーとして組み合わせた構成でした。
- この組み合わせは、テストされたすべてのセットアップの中で最高のF1スコアを達成しました。

### サードパーティツールとの比較

Uberが社内ツールを構築する理由は3つあります。

1. **インフラの制約**: UberはGitHubではなくPhabricatorを主要なコードレビュープラットフォームとして使用しており、多くのサードパーティツールはGitHubと密結合しています。
2. **品質の問題**: サードパーティツールは、誤検出が多く、価値の低い真陽性が多く、Uberの内部システムと連携できない問題がありました。
3. **コスト**: Uberの規模（月65,000差分）では、uReviewのAI関連コストは、一般的なサードパーティツールの料金よりも桁違いに低いです。

## 学んだ教訓 (Lessons Learned)

- **量より質**: 開発者の信頼を得るには、質の高いコメントが不可欠です。ノイズを減らし、重要な洞察のみを提供することに焦点を当てました。
- **フィードバックの重要性**: リアルタイムの開発者フィードバックがシステムのチューニングに不可欠でした。各コメントに評価リンクを埋め込み、大規模にフィードバックを収集しました。
- **ガードレールの重要性**: 高性能モデルであっても、単一のプロンプトだけでは不十分でした。コメント生成、評価、フィルタリングという多段階のパイプラインアプローチが信頼性を向上させました。
- **開発者が好まないコメントカテゴリ**: 可読性に関する指摘や軽微な最適化など、特定のカテゴリは評価が低い傾向にありました。一方、正確性のバグやエラーハンドリングの欠如に関する指摘は高く評価されました。
- **システム設計よりもバグ発見が得意**: 現在のuReviewはコードのみにアクセスするため、システム全体の設計評価よりも、ソースコードから明らかなバグを発見することに長けています。
- **段階的な展開による信頼構築**: チームやアシスタントごとに段階的に導入し、データに基づいた迅速な改善を繰り返すことで、信頼性を構築し、自信を持ってスケールさせることができました。
- **IDE vs CIでのAIレビュー**: 開発者がローカルでAIレビュー機能を使わない可能性もあるため、CI/CDパイプラインでのAIレビューは依然として重要です。
- **Linter vs GenAI**: 単純な構文パターンはLinterが適していますが、意味的なコード理解が必要なベストプラクティス（例：特定のライブラリの使用推奨）の強制にはLLMがはるかに優れています。

## 次のステップ (What’s Next)

- 今後は、よりリッチなコンテキストのサポート、パフォーマンスやテストカバレッジなどのレビューカテゴリの拡大、コード理解を助けるレビュー担当者向けツールの開発などを計画しています。

## 結論

- uReviewは、Uberのコード品質へのアプローチにおける大きな転換点です。
- 自動化を人間の洞察の代替ではなく、エンジニアリングの生産性を向上させるスケーラブルなパートナーとして位置づけています。
- LLMと慎重に設計されたシステムを組み合わせることで、高品質で実用的なレビューコメントを大規模に提供しています。
- uReviewは、エンジニアが反復的なチェックに費やす時間を減らし、システム設計などのより高次のタスクに集中できるようにします。
