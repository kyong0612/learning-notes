---
title: "独自のAIデータアナリストを構築する（パート2）"
source: "https://devin.ai/ai-data-analyst-2#before-you-begin"
author:
  - "Cognition Team"
published: 2025-08-01
created: 2025-09-09
description: |
  この記事は、DevinとMCPを使用してAIデータアナリストを構築する方法についての2部構成シリーズの第2部です。パート2では、クイックスタートガイド、PostgreSQLのMCP設定例、ナレッジ設定例、トラブルシューティングのヘルプなど、独自のAIデータアナリストを構築した詳細について説明します。
tags:
  - "clippings"
  - "AI"
  - "Data Analyst"
  - "Devin"
  - "MCP"
  - "PostgreSQL"
---

* [始める前に](#before-you-begin)
* [クイックスタートガイド](#quick-start-guide)
* [MCP設定例とヒント](#step-1-find-the-database-relevant-to-you-in-the-mcp-marketplace)
* [ナレッジ設定例とヒント](#knowledge-configuration-example-tips)
* [ヘルプが必要な場合](#need-help)

Cognitionチーム 2025年8月 5分で読めます

# 独自のAIデータアナリストを構築する（パート2）

この記事は、DevinとMCPを使用してAIデータアナリストを構築する方法についての2部構成シリーズの第2部です。Devinを独自のAIデータアナリストに変えた理由やその使用方法については、[パート1](/ai-data-analyst-1)で詳しく読むことができます。

パート2では、Devinを独自のAIデータアナリストとして構築した詳細について説明します。内容は以下の通りです。

* AIデータアナリストを作成するためのクイックスタートガイド
* 一般的なデータベース（PostgreSQL）のMCP設定例
* AIがデータを理解するのに役立つナレッジ設定例
* 行き詰まった場合のトラブルシューティングヘルプ

### 始める前に

詳細に入る前に、DevinをAIデータアナリストとして使用するには、読みやすく構造化されたデータ設定が強く推奨されることを述べておきます。データが解析しやすく理解しやすい形で構造化されていない場合、AIはもちろん、誰にとってもデータを理解することは不可能です。私たちの場合、DBTを使用しており、これによりインフラをコードとして表現し、データモデルとパイプラインをバージョン管理することができます。

#### データのマッピング

データモデルとパイプラインをまだコードとして表現していない場合は、始める前に、一般的なアーキテクチャ、データフロー、使用しているデータベースを数分かけて書き留めることをお勧めします。

これにより、以下のことが可能になります。

* データへのアクセスに必要なMCPのインストールなど、データをよりよく理解する
* Devinが効果的であるために必要なナレッジを提供する

### クイックスタートガイド

1. [MCPマーケットプレイス](https://app.devin.ai/settings/mcp-marketplace)をチェックし、特定のデータベースやリソース用の統合をインストールするか、必要なものがない場合は「独自に追加」を選択します
2. DBの認証情報を設定します
3. 「MCPを使用」をクリックして最初のセッションを開始します。デフォルトのプロンプトを使用するか、ユースケースに関連するものを尋ねることができます
4. Devinがデータ分析を行う際に使用すべき[ナレッジ](https://app.devin.ai/knowledge)を追加します。プロンプトで便利にナレッジを呼び出せるように、ナレッジにマクロ（例：!analytics）を添付することを忘れないでください

Devinを会社のデータに簡単に接続できるようにしました。Devinは[Googleのデータベース用MCPツールボックス](https://cloud.google.com/blog/products/ai-machine-learning/mcp-toolbox-for-databases-now-supports-model-context-protocol)でセットアップされており、PostgreSQL、BigQuery、Firestore、Looker、SQL Serverを含むすべての主要なデータベースを標準で完全にサポートしています。数日中にその他の多くのデータベースにも完全対応する予定ですが、それまでの間、適切な認証情報ファイルをDevinのマシンに追加する必要があるかもしれません。

さらに、私たちは[Metabase用のMCPサーバー](https://www.npmjs.com/package/%40cognitionai/metabase-mcp-server)を構築し、オープンソース化しました。コードは[こちら](https://github.com/CognitionAI/metabase-mcp-server)で確認できます。これには、一般的なデータベース探索や、ダッシュボード、カード、クエリなどのMetabase内のオブジェクトに関する質問を見つけ、作成し、回答するための80以上のツールが利用可能です。

以下では、SupabaseでホストされているPostgreSQLデータベースを設定する手順を段階的に説明します。

### ステップ1：MCPマーケットプレイスで関連するデータベースを見つける

1. [設定 > MCPマーケットプレイス](https://app.devin.ai/settings/mcp-marketplace)に移動します
2. 「データベース」ピルをクリックして、データベースMCPのみにフィルタリングします

   ![データベースのフィルタリング](/ai-data-analyst-2/images/2_3_1.webp)
3. 関連するデータベースをクリックします。この例では、PostgreSQL MCPを設定します

   ![関連データベースのクリック](/ai-data-analyst-2/images/2_3_2.webp)

### ステップ2：データベース接続の詳細を見つける

このステップは、特定のセットアップによって異なります。

注：本番データベースへのアクセスは、読み取り専用ユーザーの認証情報に制限することをお勧めします。

この例では、Supabase PostgreSQLデータベースを設定しています。

1. 関連するSupabaseプロジェクトに移動します
2. 画面上部の「接続」をクリックします
3. 接続詳細をコピーします。PostgreSQLで必要なものは次のとおりです。
   * **POSTGRES_HOST** (例：db.xyz.supabase.co)
   * **POSTGRES_DATABASE** (例：postgres)
   * **POSTGRES_USER** (例：postgres)
   * **POSTGRES_PASSWORD**
   * **POSTGRES_PORT** (例：5432)

   ![接続詳細](/ai-data-analyst-2/images/2_3_3.webp)

### ステップ3：MCPを設定して有効にする

1. DevinのMCPサーバーページで関連する接続詳細を入力します

   ![環境変数](/ai-data-analyst-2/images/2_3_4.webp)
2. ページ下部の「有効にする」をクリックします

### ステップ4：接続をテストする

1. 「ツールのリスト表示をテスト」をクリックして、ツールのリスト表示が成功するかをテストします。成功した場合、UIに利用可能なツールのリストが表示されます。

   ![ツールのリスト表示をテスト](/ai-data-analyst-2/images/2_3_5.webp)
2. 「MCPを使用」をクリックして最初のセッションを開始します。

   ![MCPを使用](/ai-data-analyst-2/images/2_3_6.webp)

一般的なエラーとヒント：

* `network is unreachable`：ホストとポートの設定を確認してください
* `connection refused`：正しいプーラータイプとポートを使用していることを確認してください

MCPを有効にすると、すぐに使用を開始できます。デフォルトのプロンプトを使用するか、ユースケースに関連するものを尋ねてください！

### ナレッジ設定例とヒント

コードベース全体をコンテキストに含めることは役立ちますが、関連する知識の多くはコードの外に存在します。それはNotionやConfluence、あるいはドメインエキスパートの頭の中にあるかもしれません。Devinは、データ分析に必要なコンテキストを提供するために追加できるプログラム可能な[ナレッジ](https://app.devin.ai/knowledge)を提供します。

[設定 > ナレッジ](https://app.devin.ai/knowledge)でナレッジを追加します。ヒント：チームがメッセージにマクロを含めることで迅速に呼び出せるように、ナレッジにマクロ（例：`!analytics`）を添付します（強く推奨）。マクロが呼び出されると、Devinは自動的に完全なナレッジコンテンツを受け取ります。

マクロを追加するオプションは、ナレッジ作成ページの最下部にあります。

![マクロの追加](/ai-data-analyst-2/images/2_4_1.webp)

Cognitionでのデータに関する質問のほとんどは、`!analytics`マクロを呼び出すことから始まります。

![!analyticsマクロ付きのSlackメッセージ](/ai-data-analyst-2/images/2_4_2.webp)

このナレッジは、Devinを関連する情報源やドキュメントに誘導したり、推奨されるベストプラクティスを概説したり、結果のフォーマットを指定したりするだけかもしれません。

私たちの場合、Devinを分析リポジトリのReadme.mdファイルに誘導し、構造の包括的な概要を提供します。また、データインサイトと共に視覚化プラットフォーム（Metabase）への直接リンクを含めるように指示します。これにより、ユーザーは基礎となるデータをすぐに探索し、SQLクエリを調整し、Devinの作業を検証できます。以下に例を示します。

```
## 目的：
**Redshiftデータウェアハウスのクエリ実行：**
Redshiftデータウェアハウスにクエリを実行してデータ関連の質問に答えたり、分析を取得したりする必要がある場合は、`mcp-cli`ツールを使用する必要があります。

## このナレッジを使用する際のガイドライン：
- `database://structure`リソースを使用して、利用可能なテーブルと列を確認するために完全なDBスキーマを取得します
- 分析リポジトリのREADME.mdドキュメント、特にキーモデルやその他の有用なモデルのセクションを読んで、分析スキーマで最も重要なテーブルが何かを学びます。
- すべてのdocs.ymlファイルを読んで、分析スキーマについて学びます。
- 疑わしい場合は、分析リポジトリのコードを読んで、各列がどのように計算され、データがどこから来ているかを学びます
- `int_`や`stg_`プレフィックスのないマートモデル（マートフォルダ内で定義）を`int_`や`stg_`モデルよりも強く優先して使用します
- `devin`や`billing`スキーマ（生テーブル）のような他のスキーマの前に、分析スキーマ下のテーブルをクエリすることを強く優先します
- 不明な場合は、ユーザーに確認します。使用するテーブルの提案を提供します
- 必要に応じて、純粋なSQLの代わりにPythonを使用してデータ分析を行うことがあります。Pythonスクリプトを使用してRedshiftに接続し、pandas、numpy、seabornなどのライブラリを視覚化に使用します

## 出力形式
- Redshiftに対してクエリを実行し、ユーザーに最終的な回答を提供する際は、常に結果を生成した最終的なクエリと結果自体を一緒に表示し、ユーザーがクエリが理にかなっていることを検証できるようにします。
- ユーザーに見せる必要のある最終的なクエリに到達したら、`get_metabase_playground_link`を使用して、ユーザーが自分でクエリを実行できるプレイグラウンドリンクを生成します。SlackのMarkdown形式を使用して、「metabase playground link」というラベルをリンクテキストとしてリンク形式にします。これは必須です
- 必要に応じて、Markdownとしてフォーマットされたチャートやテーブルを含めます
- 最終結果が単一の数値である場合は、ユーザーが非常に見やすいように、これを際立たせて表示してください

### 使用する適切な列の特定とデータのフィルタリング方法
カテゴリカルな列の場合、特定の列の個別値を選択して、可能なオプションとデータのフィルタリング方法を確認することができます
dbtフォルダのモデル定義を読んで、その列がどのように計算され、どのような値を持つ可能性があるかを確認します

```

ヒント：

* 必須ではありませんが、リポジトリを介してSQL/dbtコンテキストを設定することをお勧めします。これにより、Devinが必要なコンテキストをより迅速に取得できるようになります。
* ユーザーがDevinのクエリを自分で迅速に実行できるプレイグラウンドへのリンクを含めるようにDevinを設定します。これにより、Devinの作業を検証し、その上に構築することがはるかに簡単になります。数日中に、[Metabase MCP](https://www.npmjs.com/package/%40cognitionai/metabase-mcp-server)に、SQLクエリが事前入力されたMetabaseプレイグラウンドへのリンクをDevinが簡単に返せるようにするツールを追加する予定です。

### サポートが必要な場合

行き詰まったり質問がある場合は、Devinの組織名とこのブログ投稿へのリンクを添えて、<support@cognition.ai> までメールでお問い合わせください。

<support@cognition.ai>
