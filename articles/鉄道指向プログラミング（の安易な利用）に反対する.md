---
title: "鉄道指向プログラミング（の安易な利用）に反対する"
source: "https://matarillo.com/dmmf/against-railway-oriented-programming/"
author:
  - "Scott Wlaschin"
published: 2019-12-20
created: 2025-06-17
description: |
  F#の著名な専門家Scott Wlaschinが、自身が提唱した「鉄道指向プログラミング」の安易な使用に対して警鐘を鳴らす記事。Result型を使用すべきでない8つの状況を詳しく解説し、適切な使用場面を明確化している。
tags:
  - "functional-programming"
  - "error-handling"
  - "fsharp"
  - "result-type"
  - "railway-oriented-programming"
  - "domain-modeling"
---

## 概要

この記事は、「鉄道指向プログラミング（Railway-Oriented Programming, ROP）」を提唱したScott Wlaschin自身による、この手法の過度で不適切な使用に対する批判的考察です。2019年のF#アドベントカレンダーの一部として公開され、`Result`型の適切な使用方法について詳細に論じています。

### 背景

- 2013年に著者がRailway-Oriented Programmingという概念を提唱
- エラーを生成する関数を連結するための`Result`/`Either`の使用方法を説明する手段として考案
- 多くのプログラミング言語（Ruby、Java、JavaScript、Kotlin、Pythonなど）でライブラリや記事が作成されるほど広まった
- しかし、新しい手法として安易に使われがちになったことへの懸念

## Result型を使用すべきでない8つの理由

### 1. 診断が必要な場合

- **問題**: エラーの場所やスタックトレースが重要な場合
- **理由**: `Result`は追加情報付きのブール値として扱うべき
- **推奨**: 予期される制御フローにのみ使用し、例外の代替として使わない

### 2. 例外の再発明

- **問題**: あらゆるエラー処理に`Result`を使用する
- **理由**: 既存のtry-catch機能を再発明することになる
- **注意**: 例外を完全に隠そうとしても、一部は必ず漏れ出してしまう

### 3. 迅速な失敗が必要な場合

- **問題**: 続行不可能な状況でも`Result`を返す
- **推奨**: 例外を発生させるか、アプリケーションを即座に終了する

### 4. 誰も見ない場合（内部処理）

- **例**: ツリートラバーサル、マイクロサービス内部処理
- **理由**: 複雑な制御フローが外部から隠されている場合
- **推奨**: ローカル例外の使用がより明確な場合が多い

### 5. エラーケースを誰も気にしない場合

- **例**: ファイル読み込みで詳細なエラー情報が不要な場合
- **推奨**: `string option`のような単純な型の使用
- **原則**: `Result`はドメインモデリングのツールであり、ドメインが必要としない場合は使用しない

### 6. I/Oエラーの取り扱い

- **注意点**: すべての可能なI/Oエラーを`Result`でモデル化しようとしない
- **推奨**: ドメインに必要な最小限のみをモデル化
- **ベストプラクティス**: I/Oと純粋なビジネスロジックの分離

### 7. パフォーマンス重視の場合

- **注意**: パフォーマンス重要な箇所での使用は慎重に
- **推奨**: 事前推測ではなく、測定によるホットスポットの特定

### 8. 相互運用性重視の場合

- **問題**: 多くのOO言語は`Result`や判別共用体を理解しない
- **推奨**: 呼び出し元により慣用的なアプローチの使用

## Result型を使用すべき場合

### エラーの3つの分類

#### 1. ドメインエラー

- **定義**: ビジネスプロセスの一部として予期されるエラー
- **例**: 請求拒否された注文、無効な製品コード
- **処理**: ドメインモデリングの一部として組み込み、型システムで文書化

#### 2. パニック

- **定義**: システムを未知の状態にするエラー
- **例**: メモリ不足、ゼロ除算、null参照
- **処理**: ワークフローを放棄し、最高レベルで例外をキャッチ・ログ記録

#### 3. インフラストラクチャエラー

- **定義**: アーキテクチャの一部として予期されるがドメイン外のエラー
- **例**: ネットワークタイムアウト、認証失敗
- **処理**: ケースに応じてドメインの一部またはパニックとして扱う

### 適切な使用指針

- **主目的**: ドメインモデリングプロセスの一部として予期される戻り値を文書化
- **コンパイル時保証**: すべての予期されるエラーケースの処理を確保
- **ライブラリ**: マイクロドメインでの使用も適切

## 重要な結論

1. **限定的な使用**: `Result`型とRROPの使用場面は考えているより限定的
2. **目的の明確化**: クールで面白いからという理由だけで使用すべきではない
3. **ドメイン中心**: ドメインモデリングの文脈でのみ真価を発揮
4. **バランス**: 関数型イディオムと実用性のバランスが重要

この記事は、強力なツールであっても適切な場面で使用することの重要性を示しており、関数型プログラミングのベストプラクティスについての重要な洞察を提供しています。
