---
title: "How we built our multi-agent research system"
source: "https://www.anthropic.com/engineering/built-multi-agent-research-system"
author:
  - "Jeremy Hadfield"
  - "Barry Zhang"
  - "Kenneth Lien"
  - "Florian Scholz"
  - "Jeremy Fox"
  - "Daniel Ford"
published: 2025-06-13
created: 2025-06-16
description: "AnthropicがClaude Research機能に実装したマルチエージェントシステムの構築プロセス、技術的課題、学習した教訓について詳述。エージェント協調、評価、信頼性に焦点を当てた実践的ガイド。"
tags:
  - "multi-agent-systems"
  - "ai-research"
  - "claude"
  - "prompt-engineering"
  - "agent-coordination"
  - "production-systems"
  - "engineering"
---

## 概要

Anthropic社がClaude Research機能で実装したマルチエージェントシステムの構築について、エンジニアリングの観点から詳細に解説した記事。複数のLLMエージェントが協調して動作する複雑なシステムの開発における技術的課題と解決策を共有している。

## マルチエージェントシステムのメリット

### 研究タスクに適した理由

- **オープンエンドな問題**: 事前に必要なステップを予測困難で、動的かつ経路依存的
- **柔軟性の必要性**: 調査の進行に応じて方向転換や接線的なつながりを探索
- **自律的な多ターン動作**: 中間結果に基づいた意思決定が必要
- **線形パイプラインの限界**: 一回限りの処理では対応不可能

### パフォーマンス向上の実証データ

- **90.2%の性能向上**: Claude Opus 4のリードエージェント＋Claude Sonnet 4サブエージェントの組み合わせが、単一エージェントのClaude Opus 4を上回る
- **トークン使用量の影響**: BrowseComp評価において、パフォーマンス分散の80%をトークン使用量が説明
- **コスト構造**: エージェントは通常のチャットの4倍、マルチエージェントシステムは15倍のトークンを消費

## システムアーキテクチャ

### オーケストレーター・ワーカーパターン

1. **リードエージェント**: 全体の調整を担当し、サブエージェントに作業を委譲
2. **サブエージェント**: 並列で動作し、特定の検索タスクを実行
3. **引用エージェント**: 最終的な文書処理と引用の正確性を確保

![マルチエージェントアーキテクチャの動作](https://www.anthropic.com/_next/image?url=https%3A%2F%2Fwww-cdn.anthropic.com%2Fimages%2F4zrzovbb%2Fwebsite%2F1198befc0b33726c45692ac40f764022f4de1bf2-4584x2579.png&w=3840&q=75)

*マルチエージェントアーキテクチャの動作：ユーザークエリがリードエージェントを通じて流れ、並列で動作する専門サブエージェントが異なる側面を検索する様子*

### 従来RAGとの違い

- **静的検索 vs 動的検索**: RAGは類似チャンクの静的取得、マルチエージェントシステムは適応的な多段階検索
- **コンテキスト管理**: 200,000トークン超過時のメモリ保持機能
- **並列処理**: 複数の情報源を同時に探索

![完全なワークフロー図](https://www.anthropic.com/_next/image?url=https%3A%2F%2Fwww-cdn.anthropic.com%2Fimages%2F4zrzovbb%2Fwebsite%2F3bde53c9578d74f6e05c3e515e20b910c5a8c20a-4584x4584.png&w=3840&q=75)

*マルチエージェントResearchシステムの完全なワークフロー：ユーザークエリの提出から最終結果の返却まで。LeadResearcherエージェントが反復的研究プロセスに入り、専門Subagentsを作成し、CitationAgentで引用を処理する全工程を示している*

## プロンプトエンジニアリングの原則

### 8つの重要原則

1. **エージェントの思考を理解**: Consoleを使用したシミュレーションで挙動を観察
2. **オーケストレーターの委譲指導**: 明確な目標、出力形式、ツール指針、タスク境界の設定
3. **クエリ複雑性に応じた努力のスケーリング**:
   - 単純な事実確認: 1エージェント、3-10ツール呼び出し
   - 直接比較: 2-4サブエージェント、各10-15呼び出し
   - 複雑研究: 10+サブエージェント、明確な責任分担
4. **ツール設計と選択の重要性**: MCPサーバーとの連携、明確なツール記述
5. **エージェントの自己改善**: Claude 4モデルによるプロンプトエンジニアリング、40%のタスク完了時間短縮
6. **広く開始、絞り込み**: 短く広範なクエリから開始し、段階的に焦点を絞る
7. **思考プロセスのガイド**: Extended thinking modeとinterleaved thinkingの活用
8. **並列ツール呼び出し**: 90%の研究時間短縮を実現

## エージェント評価の効果的方法

### 評価の課題

- **非決定性**: 同一入力でも異なる有効な経路を取る可能性
- **プロセス vs 結果**: 事前定義されたステップより最終成果の評価が重要

### 評価手法

1. **小規模サンプルでの即座評価**: 約20クエリで劇的な変化を検出
2. **LLM-as-judge評価**:
   - 事実精度、引用精度、完全性、情報源品質、ツール効率の5基準
   - 0.0-1.0スコア＋合格/不合格判定
3. **人間評価**: 自動化では見逃すエッジケースの検出

## プロダクション信頼性とエンジニアリング課題

### 技術的課題

1. **状態管理とエラー複合**: 長時間実行されるエージェントの状態保持、エラー時の復旧機能
2. **デバッグの新アプローチ**: 動的意思決定と非決定性への対応、フル本番トレーシング
3. **デプロイメント調整**: Rainbow deploymentsによる段階的移行
4. **同期実行のボトルネック**: 非同期実行への移行の必要性

### 運用上の考慮事項

- **メモリ管理**: 外部メモリへの重要情報保存
- **コンテキスト制限**: サブエージェントの生成による継続性維持
- **ファイルシステムアーティファクト**: 情報損失防止のための直接出力

## 実用的な活用例

### 上位使用ケース（Clioエンベディング分析結果）

1. 専門分野でのソフトウェアシステム開発（10%）
2. 専門技術コンテンツの開発・最適化（8%）
3. ビジネス成長・収益生成戦略の開発（8%）
4. 学術研究・教育資料開発の支援（7%）
5. 人物・場所・組織に関する情報研究・検証（5%）

![Clioエンベディング分析結果](https://www.anthropic.com/_next/image?url=https%3A%2F%2Fwww-cdn.anthropic.com%2Fimages%2F4zrzovbb%2Fwebsite%2F09a90e0aca54859553e93c18683e7fd33ff16d4c-2654x2148.png&w=3840&q=75)

*Clioエンベディング分析による現在のResearch機能の最も一般的な使用方法。専門分野でのソフトウェアシステム開発（10%）、専門技術コンテンツの開発・最適化（8%）、ビジネス成長・収益生成戦略の開発（8%）、学術研究・教育資料開発の支援（7%）、人物・場所・組織の情報研究・検証（5%）が上位カテゴリ*

### ユーザー価値

- 未考慮のビジネス機会の発見
- 複雑な医療選択肢のナビゲーション
- 技術的バグの解決
- 数日分の作業を短縮する研究接続の発見

## 将来への示唆

マルチエージェントシステムは、適切なエンジニアリング、包括的テスト、詳細なプロンプト・ツール設計、堅牢な運用実践により、スケールでの信頼性のある動作が可能。研究、製品、エンジニアリングチーム間の緊密な協力により、複雑な問題解決の変革を実現している。

## 付録：追加のベストプラクティス

1. **多ターン状態変更エージェントの終状態評価**: プロセスより最終状態に焦点
2. **長期会話管理**: 外部メモリとサブエージェント生成による継続性確保
3. **伝言ゲーム最小化**: ファイルシステムを通じた直接出力による情報保持
