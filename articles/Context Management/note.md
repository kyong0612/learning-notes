# Context Management

ref: <https://docs.cline.bot/getting-started/understanding-context-management>

## クイックリファレンス

- **コンテキスト** = Clineがプロジェクトについて知っている情報
- **コンテキストウィンドウ** = Clineが一度に保持できる情報量
- コンテキストファイルを使ってプロジェクトの知識を維持
- コンテキストウィンドウが満杯になったらリセット

## コンテキストとコンテキストウィンドウの理解

無限のコンテキストの世界において、コンテキストウィンドウはClineが現在利用可能な情報です。Clineとの協業は、徹底的で積極的なチームメイトとの協力に似ています。

### コンテキストの構築方法

Clineは2つの方法で積極的にコンテキストを構築します：

#### 自動コンテキスト収集（Cline主導）

- 関連ファイルを積極的に読み込む
- プロジェクト構造を探索する
- パターンと関係性を分析する
- 依存関係とインポートをマッピングする
- 明確化のための質問をする

**例**: Clineがプロジェクトを探索する際、自動的に関連ファイルを見つけ、「このファイルはAPIのエンドポイントを定義しているようですが、認証処理はどこで行われていますか？」のような質問をします。

#### ユーザーガイド型コンテキスト

- 特定のファイルを共有する
- ドキュメントを提供する
- Clineの質問に答える
- 焦点領域を案内する
- 設計思想と要件を共有する

**例**: 「auth.js」ファイルを共有し、「これは我々の認証システムの中心ファイルで、JWTを使用しています。このシステムを拡張して多要素認証を追加したいと考えています」と説明します。

> 💡 **重要ポイント**: Clineは受動的ではなく、プロジェクトを理解するために積極的に行動します。特にPlanモードでは、Clineに探索させるか、焦点を絞るかを選べます。

### コンテキストとコンテキストウィンドウ

コンテキストは、あなたとClineが共有するホワイトボードのようなものです：

**コンテキスト**は利用可能なすべての情報：

- Clineが発見したこと
- あなたが共有したもの
- 会話履歴
- プロジェクト要件
- 以前の決定事項

**例**: あなたのプロジェクト全体の知識（「このアプリはReactとExpressを使用しており、認証にはJWTを使っています。データベースはMongoDBです」など）。

**コンテキストウィンドウ**はホワイトボード自体のサイズ：

- トークンで測定（1トークン ≈ 英語の単語の3/4）
- 各モデルは固定サイズを持つ：
  - Claude 3.5 Sonnet: 200,000トークン
  - DeepSeek: 64,000トークン

**例**: 大規模なプロジェクトで、フロントエンドのコード、バックエンドのコード、およびデータベーススキーマを含む複数のファイルをClineに共有した場合、それらはすべてコンテキストウィンドウ内に収まる必要があります。

ホワイトボードが満杯になると、さらに書き込むためには消去（コンテキストのクリア）が必要です。

> ⚠️ **重要**: Claude's 200kトークンのような大きなコンテキストウィンドウを持っていても、それを完全に埋めるべきではありません。散らかったホワイトボードと同様に、情報が多すぎると重要なことに集中するのが難しくなります。

## コンテキストウィンドウプログレスバーの理解

Clineはプログレスバーを通じてコンテキストウィンドウの使用状況を視覚的に監視する方法を提供しています。

### バーの読み方

- ↑は入力トークン（LLMに送信したもの）を示す
- ↓は出力トークン（LLMが生成したもの）を示す
- プログレスバーはコンテキストウィンドウの使用量を視覚化
- 合計はモデルの最大容量を示す（例：Claude 3.5-Sonnetの場合は200k）

**例**: プログレスバーが「120k/200k」と表示されている場合、コンテキストウィンドウの60%が使用されています。

### バーを確認すべきタイミング

- 長時間のコーディングセッション中
- 複数のファイルを扱う時
- 複雑なタスクを始める前
- Clineがコンテキストを失っているように見える時

**例**: 大規模なリファクタリングに取り組む前にコンテキストウィンドウをチェックし、十分な余裕があるかを確認します。使用率が既に80%に達している場合は、新しいセッションを開始することを検討します。

> 💡 **ヒント**: 最適なパフォーマンスを維持するために、使用率が70-80%に達したら新しいセッションを開始することを検討してください。

## コンテキストファイルの活用

コンテキストファイルはセッション間の理解を維持するのに役立ちます。これらはAIアシスタントがプロジェクトを理解するのを助けるために特別に設計されたドキュメントです。

### コンテキストファイルのアプローチ

#### 常緑プロジェクトコンテキスト（Memory Bank）

- プロジェクトと共に進化する生きたドキュメント
- アーキテクチャとパターンが現れるにつれて更新
- 例：Memory Bankパターンは`techContext.md`や`systemPatterns.md`のようなファイルを維持
- 長期プロジェクトやチームに有用

**例**:

```markdown
// techContext.md
# プロジェクト技術スタック
- フロントエンド: React 18 + TypeScript
- バックエンド: Node.js + Express
- データベース: MongoDB + Mongoose
- 認証: JWT + bcrypt
- テスト: Jest + React Testing Library
```

#### タスク固有コンテキスト（構造化アプローチ）

- 特定の実装タスク用に作成
- 要件、制約、決定事項を文書化
- 例：

```markdown
// auth-system-implementation.md
要件
- OAuth2の実装
- GoogleとGitHubのサポート
- 認証エンドポイントのレート制限

技術的決定
- プロバイダー統合にPassport.jsを使用
- セッション管理にJWT
- レート制限にRedis
```

#### 知識移転ドキュメント

1. Planモードに切り替えて、これまでの成果と残りのステップをマークダウンファイルに文書化するようClineに依頼
2. マークダウンファイルの内容をコピー
3. その内容をコンテキストとして新しいタスクを開始

**例**:

```markdown
// project-status.md
# プロジェクト状況レポート

## 完了した作業
- ユーザー認証システムの実装（JWT + Passport）
- 基本的なCRUD操作のAPIエンドポイント
- フロントエンドの認証フローとナビゲーション

## 現在の課題
- ユーザープロフィール編集機能の不具合
- パスワードリセットのメール送信が信頼性に欠ける

## 次のステップ
1. プロフィール編集の修正
2. メール送信システムの改善
3. 管理者ダッシュボードの実装
```

### コンテキストファイルを効果的に使用する

#### 構造とフォーマット

- 明確で一貫した構成を使用
- 関連する例を含める
- 関連する概念をリンクする
- 情報を焦点に保つ

**例**: セクション、見出し、箇条書きを使って情報を整理し、コードスニペットやダイアグラムを含めて概念を明確にします。

#### メンテナンス

- 重要な変更後に更新
- コンテキストファイルをバージョン管理
- 古い情報を削除
- 重要な決定を文書化

**例**: GitHubでプルリクエストがマージされた後、関連するコンテキストファイルを更新し、変更点とその理由を記録します。

## 実践的なヒント

### 新しいプロジェクトの開始

- Clineにコードベースを探索させる
- 構造とパターンに関する質問に答える
- 基本的なコンテキストファイルのセットアップを検討
- 重要な設計上の決定を文書化

**例**: 「Cline、このプロジェクトを探索して、全体的な構造を理解してください。質問があれば、お聞きください。」と依頼します。Clineが「このプロジェクトはモノレポ構造を使用していますか？」と尋ねた場合、「はい、フロントエンドとバックエンドの両方のコードが含まれています。lerna.jsonファイルを見れば、その設定が確認できます」と回答します。

### 継続的な開発

- 重要な変更でコンテキストファイルを更新
- 関連するドキュメントを共有
- 複雑な議論にはPlanモードを使用
- 必要に応じて新しいセッションを開始

**例**: 新しい認証方法を追加した後、`auth-system-implementation.md`を更新して新しい変更点を反映させます。

### チームプロジェクト

- 共通のコンテキストファイルを共有（プロジェクトルートに`.clinerules`ファイルを使用することを検討）
- アーキテクチャの決定を文書化
- 一貫したパターンを維持
- ドキュメントを最新に保つ

**例**: チーム全体で使用する`.clinerules`ファイルを作成し、プロジェクトの命名規則、コード構造、重要なアーキテクチャパターンを記述します。新しいチームメンバーがClineを使用する際に、このファイルが自動的に読み込まれるようにします。

**覚えておくこと**: 目標は、Clineがセッション間でプロジェクトの一貫した理解を維持できるようにすることです。

---

このページは5時間前に更新されました。
