# Google 検索によるグラウンディング

ref: <https://ai.google.dev/gemini-api/docs/grounding?hl=ja>

- **Google検索によるグラウンディングの概要**
  - Gemini API や AI Studio を用いて、モデルの回答に事実性と新しさを付与する仕組み
  - 回答とともにグラウンディングソース（インラインリンク）や検索候補を返す

- **モデルの構成方法**
  - **ツールの設定**
    - Python のコード例で、`tools` 引数に `GoogleSearchRetrieval` を渡すことで Google 検索を利用可能にする
  - **動的しきい値の設定**
    - `dynamic_threshold` を用いて、回答がグラウンディングされるタイミングを予測スコアに基づき制御
    - しきい値の値により、グラウンディングの頻度が変わる（0なら常に、1なら全く使用しない）

- **グラウンディングのメリット**
  - モデルの回答が最新の事実に基づき、正確性と信頼性が向上
  - ハルシネーション（事実に基づかない出力）の低減
  - ユーザーがクリックして参照できるソースリンクが提供される

- **動的取得（Dynamic Retrieval）の仕組み**
  - プロンプトに対してモデルが予測スコアを付与し、しきい値以上ならグラウンディングを実施
  - 各プロンプト例と予測スコアの説明（例：「前回の F1 グランプリで優勝したのは誰？」は0.97と高いスコア）

- **検索ツールとしてのGoogle検索**
  - Gemini 2.0以降、Google検索をツールとして使用でき、マルチターン検索や複数ツールの組み合わせが可能
  - 専門的なタスクや地域固有の情報、技術的なトラブルシューティングにも応用可能

- **グラウンディングされた回答の構造**
  - 回答に `groundingMetadata` が含まれ、利用したWebソースのURIやメタデータが提供される
  - 回答とともに、実際に参照したGoogle検索結果の詳細情報が含まれる

- **利用上の注意点と料金**
  - テキストプロンプトの場合、すべての利用可能な言語で動作する
  - Gemini Developer API の有料階層では、1日あたり1,500件のグラウンディングクエリが無料、以降は追加料金が発生

- **実装例と参考資料**
  - Python や Node.js、REST API での実装例が提示されている
  - [Google検索の検索候補を使用する](https://ai.google.dev/gemini-api/docs/grounding?hl=ja&lang=python#search-suggestions) などの詳細ガイドへのリンクが提供されている
