---
title: "I/F設計ガイドライン | フューチャー株式会社"
source: "https://future-architect.github.io/arch-guidelines/documents/forIF/if_guidelines.html"
author:
  - 真野隼記
  - 宮崎将太
  - 武田大輝
  - 村田靖拓
  - 山口真明
  - 澁川喜規
  - 山田勇一
published:
created: 2025-08-20
description: |
  システム間のデータ連携におけるインターフェース（I/F）設計に関するガイドライン。適切なI/F設計を通じて、外部環境の変化に柔軟に対応し、システムの保守運用を最適化することを目的としています。
tags:
  - "clippings"
  - "システム連携"
  - "I/F設計"
  - "アーキテクチャ"
  - "ファイル連携"
  - "API連携"
---

# I/F設計ガイドライン要約

本ガイドラインは、フューチャー株式会社の有志によって作成された、システム間のデータ連携（I/F）設計に関する包括的な指針です。システムの外部環境への変化に柔軟に対応し、保守運用を最適化することを目的としています。

## はじめに

システム間のデータ連携におけるインターフェース（I/F）の設計について説明します。適切なシステムI/Fを設計することで、システムの結合度を管理し、外部環境の変化への柔軟な対応や保守運用の最適化が可能になります。

![](/arch-guidelines/assets/abstract.drawio.DqDgH1vP.png)

## 基本的な考え方と統合パターン

システム連携方式は、**データ鮮度**、**システム間の結合度**、**実装・運用コスト**のバランスを取ることが重要です。エンタープライズ統合パターン（EIP）に基づき、以下の4つのパターンが比較検討されます。

| パターン | 同期/非同期 | データ鮮度 | 結合度 | スケーラビリティ | 推奨度 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **(1) DB共有** | 非同期 | 高い可能性 | ❌️ とても高い | ⚠️ ロック競合リスク | **非推奨** |
| **(2) RPC呼び出し** | 同期 | ✅️ 高い | ⚠️ 密結合 | ⚠️ サーバ負荷 | **限定的に利用** |
| **(3) メッセージング** | 非同期 | ✅️ 高い | ✅️ 疎結合 | ⚠️ サーバ負荷 | **通知用途に限定** |
| **(4) ファイル共有** | 非同期 | ⚠️ 低い傾向 | ✅️ 疎結合 | ✅️ バルクロードが得意 | **原則推奨** |

**推奨方針**:

* **ファイル共有（File Transfer）を原則として採用する。** 大量データの一括処理やバッチ連携に適しており、システム間の結合度を低く保てます。
* **DB共有（Shared Database）は非推奨。** スキーマ変更の影響範囲が広く、予期せぬ負荷やロック競合のリスクが高いためです。
* **RPC呼び出し（Web API）は密結合になりがち**なため、データ交換目的での利用は慎重に検討します。
* **メッセージング（Messaging）はデータ本体の連携ではなく、ファイル配置などを知らせる「通知」として利用**することを推奨します。

## ファイル共有（File Transfer）における詳細設計

ファイル共有を基本方針とする上で、具体的な設計指針を以下のように定めています。

### 1. システム連携パターン

* **Hub & Spoke型を推奨**: 中央のハブが連携を仲介することで、保守性や再利用性を高めます。ハブはフォーマット変換などの汎用的な処理に限定し、業務ロジックは各スポークに持たせます。
* **P2P型**: ハブ導入が困難な場合は、将来の移行を見越して標準的なファイルフォーマットに準拠します。

![](/arch-guidelines/assets/connect.drawio.BP9tCbr_.png)

### 2. オブジェクトストレージの利用

* **所有権**: 配信側システムがオブジェクトストレージ（バケット）を提供・管理します（**配信側アカウント管理**）。これにより、責任分界点が明確になります。
* **バケット分離**: 連携先ごとにバケットを分離する**個別バケット方式**を推奨。セキュリティと影響範囲の限定化に繋がります。
* **完了通知**: 集信側が取り込み完了を示すために、オブジェクトに**タグ付け**する方式（例：`processing-status: processed`）を推奨します。ファイルの移動やリネームは、データ欠損リスクを避けるため非推奨です。

### 3. オブジェクトキー命名規則

* **Hive形式のパス**（例：`/dt=2025-06-13/`）を採用し、データ分析基盤との親和性を高めます。
* ファイル名には**タイムスタンプ（ミリ秒単位）やUUIDを含め**、一意性と順序性を担保します。

### 4. 連携ファイル仕様

* **ファイル形式**: **CSV**を原則とします。RDBへのバルクロードとの相性が良く、汎用性が高いためです。
* **CSV定義**: **RFC 4180**に準拠し、ヘッダー行を必須とします。
* **文字コード・改行コード**: **UTF-8（BOMなし）**、**CRLF**を標準とします。
* **構造**:
  * **正規化**: 親子関係のあるデータ（例：受注ヘッダと明細）は、ファイルを分割する**正規化**を推奨します。マルチレイアウトや非正規化（横持ち）は非推奨です。
  * **空ファイル**: 連携対象が0件の場合でも、ヘッダー行のみの**空ファイルを連携**し、正常な処理完了を明確に伝えます。
* **圧縮**: 原則として**圧縮は行いません**。開発・運用時の手間に対し、コスト削減効果が限定的であるためです。
* **ソート**: 開発・テスト時の比較を容易にするため、**特定のキーでソート**して出力します。ただし、集信側はこのソート順に依存しない実装とします。

## データ鮮度と整合性

* **連携頻度**: **バッチ連携 → サイクルバッチ → マイクロバッチ**の順で検討し、ビジネス要件を満たす最もシンプルな方式を選択します。イベント駆動による1件単位の連携は、複雑性が増すため原則採用しません。
* **差分連携**: 原則として**全件連携**を採用し、データの整合性を担保します。性能要件が厳しい場合に限り差分連携を検討しますが、その際は定期的な全件洗い替えやチェックサム比較などの整合性チェック機構を設ける必要があります。

## セキュリティと運用

* **機密情報**: 連携データに機密情報を含めない**データ最小化の原則**を徹底します。やむを得ず連携する場合は、ファイルの暗号化、専用バケットでの厳格なアクセス制御など多層的な対策を講じます。
* **監視**: 定時連携の場合は、集信側で**門限チェック**を必須とし、ファイルの未着を確実に検知します。
* **ドキュメント**: **I/F一覧**と**ファイル定義書**を必ず作成し、常に最新の状態を維持します。

## 結論

本ガイドラインは、システム間I/F設計において、疎結合で保守性の高いアーキテクチャを実現するために、**ファイル連携**を基本とし、その具体的な設計プラクティスを詳細に示しています。これにより、将来の変更に強く、安定したシステム運用を目指します。
