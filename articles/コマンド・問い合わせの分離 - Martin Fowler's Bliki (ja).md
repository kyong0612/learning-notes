---
title: "コマンド・問い合わせの分離 - Martin Fowler's Bliki (ja)"
source: "https://bliki-ja.github.io/CommandQuerySeparation"
author:
  - Martin Fowler
published: 2005-12-05
created: 2025-10-19
description: "Bertrand Meyer氏が提唱したコマンド・問い合わせの分離原則について解説。オブジェクトのメソッドを、状態を変更せず結果を返す「問い合わせ」と、状態を変更するが値を返さない「コマンド」に明確に分類することで、コードの扱いやすさを向上させる設計原則を説明する。"
tags:
  - "API design"
  - "clean code"
  - "software design"
  - "object-oriented"
  - "best practices"
---

## 概要

**コマンド・問い合わせの分離（Command Query Separation）** は、Bertrand Meyer氏が『オブジェクト指向入門』で最初に提唱した設計原則です。この原則は、オブジェクトのメソッドを2つの明確なカテゴリに分類することを推奨しています。

## メソッドの分類

### 問い合わせ（Query）

- 結果を返す
- システムの状態を変更しない（副作用がない）
- 自信を持ってどこにでも配置可能
- 順番を入れ替えることができる

### コマンド（Command / Modifier / Mutator）

- システムの状態を変更する
- 値を返さない
- 扱いには注意が必要

## この原則の重要性

状態を変更するメソッドと変更しないメソッドを明確に分けることで、コードが **非常に扱いやすく** なります。問い合わせメソッドは様々な状況において自信を持って使用できる一方、モディファイア（状態を変更するメソッド）の扱いには注意が必要になります。

## 実装上の考慮事項

### 戻り値の型による区別

この原則は通常、戻り値の型によって両者を区別します。これはほとんどの場合うまく機能する良いルールです。

### 反例：JavaのIterator

`Iterator.next()` メソッドは、次の要素を返すと同時にイテレータを次に進めます。これはコマンド・問い合わせの分離原則に反する例です。Fowler氏は、`advance()` メソッド（状態を変更）と `current()` メソッド（値を取得）に分かれていた方が良いと指摘しています。

### 例外：スタックのpop

スタックの `pop` は、状態を変更しながら値を返すモディファイアの典型例です。Meyer氏も「このメソッドはできるだけ避けたほうがよいが、便利なイディオムである」と認めています。

## 原則の適用

Fowler氏は **できるだけこの原則に従う** ようにしていますが、**原則を破ることもいとわない** 心構えでいます。実用性と理論のバランスを取ることが重要です。

## 言語サポート

### 理想的な言語機能

- 言語が状態を変更するメソッドを検知する
- プログラマが目印をつけられる

### 制限事項

言語が自動的に検知できない理由は、**状態を変更しないというルールがシステムの `ObservableState` にしか適用できない** からです。

### C++のconst修飾子

C++の `const` 修飾子は、この原則をサポートする言語機能の例です。優れたC++プログラマは `const` を多用し、その有用性を高く評価しています。

## まとめ

コマンド・問い合わせの分離は、オブジェクト指向設計における重要な原則です。完璧に遵守する必要はありませんが、この原則を意識することで、より保守性が高く、理解しやすいコードを書くことができます。
