# Designing data products

ref: <https://martinfowler.com/articles/designing-data-products.html>

## What are data products?（データプロダクトとは何か？）

データプロダクトは、データメッシュの基盤となる要素であり、分析データを提供するものです。それらは、Zhamak Dehghani 氏の著書『Data Mesh: Delivering Data-Driven Value at Scale』で述べられている8つの特性を持つ必要があります。

 1. 発見可能であること（Discoverable）
データ消費者が、データプロダクトを簡単に探し出し、自分のユースケースに適しているかを判断できること。
 1. アドレス指定可能であること（Addressable）
プログラム的または手動でアクセス可能な、一意かつ永続的なアドレス（例: URLやURI）を持つこと。
 1. 自己記述的であること（Understandable / Self Describable）
データプロダクトの目的や使用方法を理解するためのドキュメントがあり、フィールドごとの説明やアクセス方法、サンプルデータセットが提供されていること。
 1. 信頼できること（Trustworthy）
サービスレベル目標（SLO）やそれを測る指標（SLI）を明示し、それを遵守することで信頼を構築すること。
 1. ネイティブにアクセス可能であること（Natively Accessible）
各ユーザー層（例: 管理者向けのレポート、データサイエンス用のSQL接続、バックエンドサービス用のAPI）に最適なアクセス方法を提供すること。
 1. 相互運用可能であること（Interoperable / Composable）
他のデータプロダクトと容易に連携できること（例: 結合、フィルタリング、集計など）。
 1. 独自の価値を持つこと（Valuable on its own）
他のデータプロダクトと結合しなくても、単独で価値を提供できること。
 1. セキュリティを備えていること（Secure）
適切なアクセス制御と暗号化を行い、認可されたユーザーやシステムだけがアクセスできるようにすること。

これらの特性を持つことで、データプロダクトは自己完結的で展開可能な形になり、効果的にデータを活用できます。

## What they are not（データプロダクトではないもの）

データプロダクトを正しく理解するためには、それが「何でないか」を明確にすることも重要です。

一般的な誤解と理由

以下は、データプロダクトではないものと、その理由です：

 1. データウェアハウス
 • 理由: 独立して構成可能なユニットとしては大きすぎるため。
 • 欠けている特性: 相互運用性（Interoperable）、自己記述性（Self-describing）。
 2. PDFレポート
 • 理由: プログラム的なアクセスが想定されていないため。
 • 欠けている特性: 相互運用性、ネイティブアクセス性。
 3. ダッシュボード
 • 理由: プログラム的なアクセスを想定していないため。なお、ダッシュボードはデータプロダクトの出力の一つとしては適しているが、それ自体はデータプロダクトではない。
 • 欠けている特性: 相互運用性、ネイティブアクセス性。
 4. ウェアハウス内のテーブル
 • 理由: 適切なメタデータやドキュメントがなければデータプロダクトと見なされない。
 • 欠けている特性: 自己記述性、独自の価値。
 5. Kafkaトピック
 • 理由: 一般的に分析データ用には設計されていない（メッセージのシーケンスとしてデータを保存する構造は、フィルタリングや集計に最適化されていないため）。
 • 欠けている特性: 分析データ性。

データプロダクトは、プログラム的なアクセスや再利用を前提とし、明確な目的と価値を提供するものである必要があります。これに対して、上記の例は、データプロダクトの特性を欠いているため適合しません。

## Working backwards from a use case（ユースケースから逆算する）

ゴールから逆算するアプローチはソフトウェア開発の基本原則であり、データプロダクトのモデリングにも非常に効果的です。この方法では、以下の点を重視します：

 1. エンドユーザーやシステムへのフォーカス
データプロダクトがどのように消費されるべきかを考え、それに基づいて設計を進めます。例えば、ネイティブアクセス可能な出力（APIやSQLなど）を通じて提供することを検討します。
 2. 明確な目標設定
このアプローチでは、データプロダクトチームに明確な目標を与え、デザインの過剰化を防ぎ、時間と労力の無駄を最小限にします。

注意点

データソースから出発してデータプロダクトを定義するのではなく、具体的なユースケースから始めることが重要です。明確なユースケースがなければ、「どの段階で設計が十分か」を判断することが難しくなり、分析が過剰になりがちです。

## How to do it?（具体的な進め方）

このプロセスは以下のステップで進められます。

 1. ワークショップの設定
このプロセスは通常、短期間のワークショップ形式で行います。参加者には以下が含まれます：
 • データプロダクトの潜在的なユーザー
 • ドメイン専門家
 • プロダクトの構築・運用チーム
また、スムーズな進行を確保するために、ホワイトボードツールと専任のファシリテーターを用意します。
 2. ユースケースの特定
例えば、ファッション小売業の一般的なユースケースを考えます：
ユースケース例
「顧客関係マネージャーとして、最も価値の高い顧客と低い顧客についての洞察を得られるタイムリーなレポートが必要です。これにより、価値の高い顧客の維持と、価値の低い顧客の体験向上を図りたい。」
このユースケースに基づいて、「顧客生涯価値（Customer Lifetime Value, CLV）」というデータプロダクトを定義します。このプロダクトは、顧客の価値をスコアとして算出し、そのスコアに基づく推奨アクションを提供します。
 3. データプロダクトの特定と定義
CLVを計算するためには、以下の追加のデータプロダクトが必要です：
 • 顧客プロファイル（名前、年齢、メールなど）
 • 購入履歴
これらをもとに、CLVがどのように構築されるべきかを逆算して考えます。

テスト方法：データプロダクトの適切な定義

データプロダクトが適切に定義されているかを確認するには、以下の基準を使います：
 • データプロダクトを1～2文で簡潔に説明できるか？
 • 説明が長くなりすぎる場合、データプロダクトは定義が不十分な可能性があります。

例として、以下のデータプロダクトを考えます：

 1. Customer Lifetime Value (CLV)
 • 顧客の生涯価値を予測スコアとして提供し、顧客対応者への次の最適な行動を提案します。
 2. Customer-Marketing 360
 • 顧客のマーケティング視点からの包括的な情報を提供します。
 3. Historical Purchases
 • 各顧客の購入履歴（SKU）を提供します。
 4. Returns
 • 顧客が返品した商品の一覧を提供します。

## Overlay additional use cases and generalize（追加のユースケースを重ね合わせて一般化する）

同じデータプロダクトを使って対応可能な別のユースケースを検討し、既存のデータプロダクトを一般化して新しいユースケースに適合させる方法を探ります。このプロセスにより、特定のユースケースに過度に特化することを防ぎ、データプロダクトの再利用性を向上させます。

ユースケース例

マーケティングバックエンドチームとして
「顧客に対して、アップセルやクロスセルの高確率な推奨商品を特定する必要があります。これにより、収益を増加させたい。」

このユースケースを解決するために、「商品推奨（Product Recommendations）」というデータプロダクトを作成します。このプロダクトは、各顧客に対する推奨商品リストを生成します。このリストは、顧客の購入履歴に基づいて作成されます。

既存データプロダクトの一般化

新しいユースケースに対応するため、以下の方法で既存のデータプロダクトを一般化します：

 1. 新しいデータプロダクト「Products」の作成
 • 販売する商品の詳細情報を提供するデータプロダクトを追加します。
 2. 「Customer-Marketing 360」の拡張
 • 性別情報を含めるなど、既存のプロダクトを拡張して適合させます。

進め方の推奨

これまでに、2つのユースケースを解決するためのデータプロダクト群を構築しました。このプロセスを最大5つのユースケースまで繰り返すことを推奨します。5つ以上になると、重要なデータプロダクトの大半がすでにカバーされているため、追加のユースケースの価値が減少する可能性があります。

## Assigning domain ownership（ドメイン所有権の割り当て）

データプロダクトを特定した後は、それぞれのプロダクトが属する論理的なドメイン（境界付けられたコンテキスト）を決定する必要があります。

所有権の割り当て方
 • ドメイン専門家との議論を通じて、以下の観点を考慮して所有権を決定します：
 • データプロダクトに関連するソースシステムを誰が所有しているか。
 • そのデータプロダクトを最も必要としているのは誰か。
 • データプロダクトを構築および管理するのに最適なポジションにいるのは誰か。
 • 原則
単一のデータプロダクトは複数のドメインによって所有されるべきではありません。これにより、品質問題における責任の所在が曖昧になるのを防ぎます。

所有権の明確化

複数のドメイン間で所有権に競合がある場合、最も緊急に必要とするドメインに割り当てるのが理想的です。重要なのは、所有権を明確にし、先に進むことです。

続いて次のセクションを翻訳します。

Defining service level objectives (SLOs)（サービスレベル目標の定義）

サービスレベル目標（SLO）は、データプロダクトの設計、アーキテクチャ、および実装を導く重要な要素です。以下の手順を通じてSLOを定義します。

なぜSLOが重要なのか
 • 特に消費者指向のデータプロダクトでは、明確なSLOを定義することが重要です。これにより、データプロダクトの信頼性や利用可能性を保証できます。
 • ソース指向のデータプロダクトについては、消費者指向のSLOから必要な要件を推測することが可能です。

SLOの定義は、データプロダクトに求められるプラットフォームの初期能力や設計方法（バッチ処理かリアルタイム処理かなど）を決定するのに役立ちます。

SLO定義のための質問

以下のような質問を使用してSLOを導きます：

 1. データプロダクトがどのくらいの頻度で更新されるべきか？
 2. 可用性の要件はどれくらいか？（例: 99.9%の可用性）
 3. エラー発生時にどのような通知や修復が行われるべきか？
 4. データプロダクトが満たすべき品質要件は何か？

これらの質問を通じて、SLOを具体的にし、データプロダクトの成功を測るための指標（SLI: Service Level Indicator）を明確化します。

透明性と信頼の構築
 • 実装段階では、SLOに基づいて測定可能なSLIを定義します。
 • これらの指標は、プラットフォームの能力を利用して自動的に測定・公開され、データプロダクトの消費者に透明性を提供します。

参考リソース
以下のリソースでは、SLOとSLIをデータプロダクトに適用するための実践的なガイドラインが紹介されています：
 • 「効果的なデータ品質戦略をゼロから構築するためのステップバイステップガイド」
 • 「データプロダクトのためのAmazon.comのような仕組みを構築する」

## How big should data products be?（データプロダクトの大きさはどれくらいが適切か？）

データプロダクトの設計段階でよく出てくる質問の一つが、「データプロダクトの大きさはどれくらいにすべきか？」というものです。これは、マイクロサービスの経験がある人には馴染み深い問題かもしれません。

適切な大きさの基準

データプロダクトは、ドメイン内で一貫した情報の概念を表現するのに十分な大きさであるべきです。以下が基準です：

 1. 構造化データの場合
 • 一つの「正規化されたテーブル」として提供されるのが理想的です。
 2. 半構造化データや非構造化データの場合
 • 単一のデータセットであることが望ましい。

これ以上大きい場合、データプロダクトはその役割が広範囲すぎる可能性があり、説明が難しくなります。また、構成可能性や再利用性が低下します。

内部のデータと公開されるデータ

データプロダクトの内部には、追加のテーブルや中間データセットが存在することもありますが、これらは実装の詳細に過ぎません。重要なのは、データプロダクトが外部に公開する「主データセット」または「主テーブル」です。公開データには以下のような要件が求められます：
 • **サービスレベル目標（SLO）**の適用
 • 後方互換性の確保
 • データ品質の担保

We’ve designed data products - what next?（データプロダクトを設計した後はどうするか？）

データプロダクトの論理的な境界を確立し、その目的を定義し、SLOを設定し、ドメインを割り当てました。これにより、設計の基盤が整いました。ここからは、実装の準備を進めます。

実装に向けた重要なポイント

設計段階の成果を活用して、次のステップを踏むことをお勧めします：

 1. パターンを特定し、標準化された方法を確立する（Identify patterns and establish paved roads）
 • 入力（FTP、S3バケット、API、他のデータプロダクト）
 • 出力（API、テーブル、S3バケット、推論エンドポイントを備えたMLモデル）
 • トランスフォーメーション（SQL変換、Sparkジョブ）
 • サービスレベル（プラットフォームによる測定・公開）
 • アクセス制御（ルールをプラットフォームで強制実行）
 2. 開発者体験を向上させる（Provide a seamless developer experience）
 • プラットフォームが「敷かれた道」を提供します。これにより、開発者は事前定義された設計やパターンに基づいてデータプロダクトを効率的に構築できます。
 3. 独立したソース管理とデプロイメントパイプラインを設定する（Setup independent source control and deployment pipelines）
 • 各データプロダクトごとに専用のリポジトリとパイプラインを用意します。
 • 必要な要素（インフラプロビジョニング、データの取り込み、変換、出力プロセス、アクセスポリシーなど）をコードまたは仕様として明確化します。
 4. ガバナンスを自動化する（Automate governance）
 • データプロダクトがベストプラクティスに従うようにするため、ガバナンスを自動化します。
 • フィットネスファンクションを使用して、データプロダクトの構築が組織の標準と一致していることを確認します。

## Conclusion（結論）

データメッシュの導入が広まり始めたのは5年前のことですが、多くの組織がそのビジョンを取り入れつつも、効果的な運用方法を見つけられずに苦戦しています。このシリーズの目的は、データプロダクト設計において実践的で経験に基づくガイドラインを提供することです。

特に注目すべきは、「データをプロダクトとして扱う」ことに重点を置く点です。このアプローチを正しく実践することで、他の柱（ガバナンス、自律的なチーム構成など）を自然に取り入れる基盤が築かれます。

この記事の技法を活用して、より良いデータプロダクトを設計し、データメッシュの成功を目指してください。
