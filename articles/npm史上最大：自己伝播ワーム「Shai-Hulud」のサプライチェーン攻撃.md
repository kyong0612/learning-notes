---
title: "npm史上最大：自己伝播ワーム「Shai-Hulud」のサプライチェーン攻撃"
source: "https://qiita.com/___nix___/items/6bf6801ca350d7e2eb9e"
author:
  - "[[___nix___]]"
published: 2025-09-17
created: 2025-09-19
description: |
  2025年9月に発生したnpmエコシステムに対する大規模サプライチェーン攻撃「Shai-Hulud」について解説。187以上の人気パッケージが自己増殖型マルウェアに感染し、開発者の認証情報を窃取するなどの被害が拡大。記事では攻撃の概要、マルウェアの挙動、影響範囲、そしてAikido社が提供する対策ツールについて詳述する。
tags:
  - "npm"
  - "マルウェア"
  - "サプライチェーン"
  - "Shai-Hulud"
  - "自己増殖ワーム"
---

# npm史上最大：自己伝播ワーム「Shai-Hulud」のサプライチェーン攻撃

## はじめに

この記事は、2025年9月に発生したnpmエコシステムにおける大規模なサプライチェーン攻撃「Shai-Hulud」について詳述したものです。

## 背景

npmパッケージは、JavaScript/Node.js開発において不可欠な要素であり、フロントエンドからサーバーサイドまで広範囲にわたり開発速度の向上とエコシステムの拡大に貢献してきました。

## 概要

2025年9月、多数の人気npmパッケージが「Shai-Hulud」と名付けられた大規模サプライチェーン攻撃の標的となりました。攻撃者は管理者アカウントを乗っ取り、187以上のnpmパッケージに自己増殖型のマルウェアを混入させ、依存関係を通じて感染を急速に拡大させました。

## 詳細

### 攻撃の概要

`@ctrl/tinycolor`、`ngx-toastr`、`angulartics2` といった著名なnpmパッケージを含む187種類以上が攻撃の対象となりました。攻撃者は複数のnpm管理者アカウントを侵害し、悪意のあるコード（例: `bundle.js`）をパッケージに組み込みました。感染したパッケージは、`package.json`を改ざんし、正規の権限で再公開されることで、ワームのように拡散しました。この攻撃は数時間で数千のプロジェクトに影響を及ぼす可能性が指摘されています。

### マルウェアの挙動

- `npm install` や `update` 時に実行されるライフサイクルフックを悪用。
- 正規ツールである `TruffleHog` を不正に利用し、開発者端末やCI/CD環境から認証情報（GitHubトークン、クラウドクレデンシャル、APIキー等）を収集・検証。
- AWS/GCP/AzureのメタデータAPIを悪用して追加の権限を奪取。
- 窃取した認証情報を集約するため、GitHub上に "Shai-Hulud" という名前のリポジトリを作成し、GitHub Actionsを悪用してデータの外部流出やバックドアの維持を図りました。

### 影響範囲とリスク

- CrowdStrike傘下のnpmアカウントや、Google Gemini CLIなどの依存パッケージにも影響が及ぶ懸念がありました。
- ソースコード本体や主要な基盤への直接的な侵入は確認されていません。
- しかし、CI/CDパイプラインや本番サーバーに感染した場合、機密情報の漏洩、不正な権限利用、バックドアの設置といった深刻なリスクが生じます。
- この攻撃キャンペーンは、過去にnpmを標的とした `S1ngularity/nx` と同一グループによるものと見られています。

### 推奨される対策

- 依存パッケージとlockファイルを確認し、不審な変更やリポジトリが作成されていないか監査する。
- CI/CDや管理者用のクレデンシャルをすべてローテーションする。
- 信頼できるバージョンのリリースに依存を固定し、プライベートnpmレジストリの利用を検討する。
- プルリクエストのレビューを必須化し、コミットや依存関係のスキャンを強制するなど、SDLC（Software Development Lifecycle）全体でセキュリティを強化する。
- 元記事には被害パッケージのリストが公開されており、開発者は速やかに確認とアップデートを行う必要があります。

## 対応策：Aikido Safe Chain

この攻撃を受け、セキュリティ専門企業のAikido社が対策用の専用パッケージ `Aikido Safe Chain` を提供しています。

### 主な特徴と機能

- `npm` や `yarn` などの主要なパッケージマネージャーのコマンドをラップし、インストール前にマルウェアチェックを実行します。
- チェックはオープンソースの脅威インテリジェンス情報「Aikido Intel」に基づいています。
- マルウェアが検出された場合、デフォルトでインストールをブロックし、コマンドを終了します。
- `bash`、`zsh`、`fish`、`PowerShell` など多様なシェルに対応しています。
- Node.js 18以上が必要です。

### 導入と使い方

1. **グローバルインストール:**

    ```bash
    npm install -g @aikidosec/safe-chain
    ```

2. **シェル統合の設定:**

    ```bash
    safe-chain setup
    ```

3. **ターミナルの再起動:** 設定を有効にするために、ターミナルを再起動してください。
4. **インストールの確認:**

    ```bash
    npm install safe-chain-test
    ```

    実行後、テスト用マルウェアパッケージのインストールがブロックされることを確認します。

マルウェアが検出されると、以下のようなメッセージが表示され、インストールが中断されます。

```
$ npm install safe-chain-test
✖ Malicious changes detected:
 - safe-chain-test@0.0.1-security

Exiting without installing malicious packages.
```

### CI/CD統合

このツールはCI/CD環境にも対応しており、安全な開発パイプラインの構築を支援します.

### アンインストール

エイリアスの除去、パッケージの削除、端末の再起動という簡単な手順でアンインストールが可能です.

## 重要事項

`lock`ファイル内に感染パッケージが存在しないかを継続的にチェックすることが重要です。「Shai-Hulud」は自己増殖性を持つため、感染パッケージは今後も拡大する恐れがあります。問題が収束するまでは、`safe-chain` のような信頼できるマルウェア検出ツールを導入し、定期的な監査を行うことが不可欠です。

## 終わりに

2025年のnpmサプライチェーン攻撃「Shai-Hulud」は、JavaScript開発の基盤を揺るがす重大な脅威です。開発者は依存パッケージの管理と認証情報の保護を徹底し、迅速に対応することが求められます。この事件は、ソフトウェアサプライチェーンの安全性を確保する重要性を改めて認識させるものとなりました。
