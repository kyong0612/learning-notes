---
title: "OAuthとOIDCの前にJWTから勉強しよう"
source: "https://zenn.dev/nttdata_tech/articles/cdf46cbf625147#jwt%E3%81%8C%E7%99%BB%E5%A0%B4%E3%81%99%E3%82%8B%E3%81%A8%E6%B7%B7%E4%B9%B1%E3%81%99%E3%82%8B%E7%90%86%E7%94%B1"
author:
  - "Jun Nishimura (NTT DATA 技術革新統括本部)"
  - "[[Zenn]]"
published: 2025-07-16
created: 2025-07-21
description: JWT、OAuth2.0、OIDCの関係性を明らかにし、JWTの仕組みと実装時の注意点を詳しく解説。認証・認可の実装で混乱しがちなこれらの技術を、依存関係から理解することで整理します。
tags:
  - "clippings"
  - "セキュリティ"
  - "JWT"
  - "OAuth2.0"
  - "OIDC"
  - "認証"
  - "認可"
  - "OpenID Connect"
---

### メインポイント

- **JWT／OAuth2.0／OIDCの関係性を正しく理解することが重要**
- **JWTは「トークンの形式」であって「認証・認可の手段」ではない**
- **JWTは便利で柔軟な仕組みだが、正しく使わないとリスクが高まる**

### 認証と認可の基本

- **認証（Authentication）**: 利用者が「誰であるか」を確認すること
- **認可（Authorization）**: 利用者が「その操作を許可されているか」を確認すること

### 各技術の概要

#### OAuth2.0

- リソースへのアクセス権限（認可）を委譲するためのプロトコル
- 2種類のトークンを使用：
  - **アクセストークン**: APIアクセス用（有効期間短い）
  - **リフレッシュトークン**: アクセストークン更新用（有効期間長い）
- トークンの形式は仕様として定められていない（JWTの採用は実装依存）

#### OIDC (OpenID Connect)

- OAuth2.0をベースにした認証用のプロトコル
- OAuth2.0のトークンに加えて**IDトークン**が追加
- IDトークンはJWSで署名されなければならない（仕様で規定）

#### JWT (JSON Web Token)

- JSON形式でトークンを実現するためのデータ構造
- JWS（JSON Web Signature）と組み合わせて署名付きトークンを実現
- 最大の利点：**発行元に問い合わせることなく検証できる**

### JWTが混乱を招く3つの理由

1. **OAuth2.0／OIDCでトークン実装の扱いに差がある**
   - OAuth2.0：JWT採用は任意
   - OIDC：JWS署名が必須

2. **依存の向きを間違えやすい**
   - 正：OAuth2.0がJWTを採用する（ことがある）
   - 正：OIDCがJWSに依存する
   - 誤：JWTがOAuth2.0/OIDCに依存する

3. **JWTには署名・検証の仕組みがある**
   - 単なる文字列ではなく、署名・検証の処理手順が必要

### JWTの技術的詳細

#### 構造

```
<base64url(header)>.<base64url(payload)>.<base64url(signature)>
```

- **ヘッダ**: 署名アルゴリズムなどのメタデータ
- **ペイロード**: ユーザ情報等のクレーム
- **署名**: 改ざん防止のための電子署名

#### 署名検証の流れ

1. JWTを3つのパートに分割
2. ヘッダとペイロードをBase64URLデコード
3. 署名をBase64URLデコードしバイナリ化
4. `<header>.<payload>`をハッシュ化
5. 公開鍵で署名を変換し、ハッシュ値と照合

#### 公開鍵の管理

- JWKS（JSON Web Key Set）形式で公開
- エンドポイント例：`https://example.com/.well-known/jwks.json`
- **公開鍵のローテーションへの対応が必須**
  - 変更検知処理
  - JWKS取得処理
  - kid（Key ID）による適切な鍵選択
  - 新しい公開鍵の保存処理

### JWTの運用上の注意点

#### カスタムクレームの取り扱い

- 機密情報を含めない（クライアント側で参照可能なため）
- システム間連携のためのデータ格納は避ける
- 本来の目的（認証・認可情報の伝達）から逸脱しない

#### ログアウトとトークン無効化

- JWTはステートレスなため、有効期限まで使用可能
- ブラックリスト方式での対処：
  - ログアウト時にjti（JWT ID）をブラックリストに登録
  - リクエストごとにブラックリストを参照

### 推奨される学習順序

![技術関係図](https://storage.googleapis.com/zenn-user-upload/779b9646e641-20250709.png)

1. **JWT+JWSから理解を始める**（基礎となるデータ構造）
2. **OAuth2.0でのJWT利用を理解**（認可での活用）
3. **OIDCでのJWT必須要件を理解**（認証での活用）

この順序により、各技術の役割と関係性が明確になり、混乱を避けられる。
