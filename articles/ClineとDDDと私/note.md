# ClineとDDDと私

ref: <https://tech.codmon.com/entry/2025/05/01/132700>

この記事は、株式会社コドモンのプロダクト開発部の中田氏が、AIコーディングツール Cline を利用した経験と、特にドメイン駆動設計 (DDD) の原則を取り入れたプロジェクトでの活用方法について紹介するものです。

## はじめに

### Clineを使い始めたわけ

* 著者（中田氏）は、当初AI技術に苦手意識を持っていたが、開発効率向上のため Cline を試すことにした。
* VSCode拡張機能として手軽に導入でき、GitHub Copilot 契約があれば追加料金なしで利用可能だった点が決め手となった（法務チェックも通過）。
* 当初 `o1-mini` モデルでは苦戦したが、`claude-3.5-sonnet` モデルに変更したところ、その有効性を実感した。
* 本記事は VSCode 拡張機能 `Cline`、API Provider `VS Code LM API`、Language Model `copilot - claude-3.5-sonnet` の組み合わせでの利用を前提としている。

### Clineを使い始めて悩んだこと

* 適切なタスクの大きさや指示の具体性のレベルを見極めるのに試行錯誤が必要だった。
* AIの能力不足なのか指示が悪いのか判断が難しく、調整に時間がかかる場合があった。
* タスクを細かくしすぎると、指示出しの頻度が多くなり、待ち時間やコンテキストスイッチのコストが発生した。
* ある程度まとまったタスクを任せられる `Auto Approve` 機能の活用が効率化の鍵と感じた。

## AIを使用するうえでの保守性の高いコードベースの重要性

### コンテキストの局所化

* AIに的確な指示を出すためには、必要なコンテキスト情報を小さく抑えることが重要。
* DDD やクリーンアーキテクチャによる関心事の分離は、AIが必要とするコンテキストを限定し、特にドメイン知識が不要なレイヤの実装をAIに任せやすくする。
* レイヤごとに関心事が分離されていれば、AIへの指示が容易になり、期待通りの結果を得やすい。

### 自然言語としての可読性

* 命名規則が適切で、その名前から振る舞いが予測できるような「ヒューマンリーダブルなコード」は、AIにとっても理解しやすい。
* AIはコードや自然言語で学習しているため、自然言語的な理解に基づいた判断を行う傾向がある。
* 現時点では「AIフレンドリーなコード」≒「ヒューマンリーダブルなコード」と言える。

## 実際のタスク分担の例

新規機能「保護者は子どもの情報を更新できる」を実装する際の、著者と Cline とのタスク分担例を紹介。

**アーキテクチャ:** DDDのレイヤ化アーキテクチャ (ユーザインターフェース: Controller, アプリケーション: UseCase, ドメイン: Domainオブジェクト・Repositoryインターフェース, インフラストラクチャ: Repository実装)

**タスク分担の図:**

![](https://cdn-ak.f.st-hatena.com/images/fotolife/y/y_nakata_codmon/20250424/20250424202738.png)

**分担方針:**

* **著者:** ドメインモデリング、UseCase・Domain実装など、創造的で楽しい部分を担当。アーキテクチャ設計。
* **Cline:** UseCase より外側のレイヤ（Controller, Repository実装）、ユニットテストなど、定型的で面倒な部分を担当。
* 前提として、Cline に任せるタスクについては、事前にアーキテクチャに沿った見本コードを作成しておく。

### バックエンド開発タスク (SpringBoot/Kotlin)

(事前に Domain, UseCase の実装が完了している前提)

#### UseCaseのユニットテスト実装

* **著者:** UseCaseクラス本体を実装。
* **Cline:** Repositoryモックを用いたユニットテストの実装。エラーケースや例外ケースも含む網羅的なテストを作成。
  * **指示例:** `UpdateExampleChildUseCase.kt` のユニットテスト作成指示（参考ファイル、テストケースの網羅性、実行と修正を含む）。
  * **成果物例:** `UpdateExampleChildUseCaseSpec.kt` のコード抜粋。

#### Controller実装

* **著者:** OpenAPI Generator で Controller インターフェースを自動生成。
* **Cline:** Controller 実装クラスの作成。リクエスト/レスポンスと UseCase DTO の変換、UseCase 呼び出し。
  * **指示例:** `ExampleChildApiControllerImpl` の `putExampleChild` メソッド実装指示（参考メソッド、コンパイルと修正を含む）。
  * **成果物例:** `ExampleChildApiControllerImpl.kt` のコード抜粋。

#### Repository実装

* **著者:** Repository インターフェースを定義。テーブルと JOOQ モデルを自動生成。
* **Cline:** Repository 実装クラスの作成。ドメインモデルと JOOQ モデルの変換、JOOQ による SQL 組み立て (Driver, Translator クラスへの責務分割を含む)。
  * **指示例:** `ExampleChildRepositoryImpl` のメソッド実装指示（参考メソッド、Driver/Translatorクラス作成、コンパイルと修正を含む）。
  * **成果物例:** Plan通りのため省略。

### フロントエンド開発タスク (React/TypeScript)

* React/TypeScript は Cline との相性が良いと感じている。
  * 実装中のエラー検知・修正が容易。
  * AI の学習量が多いのか、より良いコード生成が期待できる。

#### コンポーネントライブラリの実装

* **Cline:** Figma の URL を基に、デザインシステムに沿った React コンポーネント (例: Checkbox) を生成。
  * **指示例:** Figma URL を指定した Checkbox コンポーネント作成指示。
  * **成果物例:** `Checkbox.tsx` のコード抜粋 (CSS の手動補正は必要)。

#### 個別コンポーネントの実装

* **Cline:** アプリケーション固有のページコンポーネント (例: ExampleChild編集画面) の実装。API 連携 (Tanstack Query), フォーム (React Hook Form), データ表示、カスタムフック、ユニットテストを含む。
  * **指示例:** ExampleChild編集画面作成指示（参考コンポーネント、API利用方法、テスト実行と修正を含む）。
  * **成果物例:** `ExampleChildEdit.tsx` のコード抜粋、関連ファイル一覧。

## やってみて効果を実感したTIPS

* **参考にしたい既存コードをVSCodeで開いておく:** パス指定なしでも Cline が優先的に参照してくれる。
* **Planですり合わせしてからActする:** Plan 段階で Cline の応答を確認し、必要なら追加指示や軌道修正を行う。
* **`.clinerules`ファイルを活用する:** 共通の前提情報を記述し、指示の簡略化と再現性向上を図る。
* **Clineとのやりとりを記録・共有する:** 実際のやりとりを見せるのが効果的。後々の振り返りや簡易ADRとしても活用できる。
* **Clineにキャラ付けする:** Custom Instructions で AI に役割を与えることで、楽しく開発を進める（例: アスラーダ）。
    ![](https://cdn-ak.f.st-hatena.com/images/fotolife/y/y_nakata_codmon/20250424/20250424202840.png)

## まとめ

* DDD のレイヤ化アーキテクチャは、関心事を分離し AI が必要とするコンテキストを限定するため、Cline との相性が良い。
* AI を活用することで、人間はドメインの複雑性に集中できる。
* **課題:** タスク分解や AI とのやりとりには依然として手間がかかる。
* **今後:** プロセス効率化やコンテキスト整理を進めつつ、AI 自体の進化（コンテキスト理解、タスク分解能力）にも期待。
* 当面は、AI 活用のためにもヒューマンリーダブルなコードベースの維持が重要。

## お知らせ・関連情報

* 技術イベントの告知 (技術的負債 PHP 編, 社会インフラを創る！コドモン, 開発生産性カンファレンス)
* コドモン開発チーム X アカウント
* 関連記事へのリンク
* ブログ情報 (カテゴリー、アーカイブ、リンク等)

---

**重要な結論・発見:**

* **DDD と AI の親和性:** DDD やクリーンアーキテクチャによる関心事の分離は、AI コーディングツール (Cline) が必要とするコンテキストを局所化し、効率的なタスク委譲を可能にする。
* **保守性の重要性:** AI を活用する上でも、人間が理解・保守しやすいコードベース (ヒューマンリーダブルなコード) が極めて重要である。これは AI がコードを理解し、適切な出力を生成するためにも役立つ。
* **効果的なタスク分担:** 開発者はドメインモデリングなど創造的な部分に集中し、定型的な実装 (テスト、Controller/Repository 実装など) を AI に任せることで、開発効率を向上させることができる。ただし、適切なタスク分解と指示、AI とのコミュニケーション (Plan/Act) が鍵となる。

**制限事項:**

* 本記事の内容は、特定のツール (Cline)、モデル (`claude-3.5-sonnet`)、技術スタック (SpringBoot/Kotlin, React/TypeScript) を前提とした個人の経験に基づく一例である。
* AI への指示の仕方やタスク分解の粒度は、試行錯誤が必要であり、現時点ではある程度の人的コストがかかる。
* AI が生成したコード (特に CSS など) には、まだ手動での調整が必要な場合がある。
