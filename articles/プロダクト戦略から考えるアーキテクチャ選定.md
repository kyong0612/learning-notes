---
title: "プロダクト戦略から考えるアーキテクチャ選定"
source: "https://zenn.dev/peoplex_blog/articles/b95bb516a7410c"
author:
  - "ttiger (PeopleX CTO)"
published: 2025-10-14
created: 2025-10-16
description: |
  PeopleXで1年半の間に5つのプロダクトを立ち上げた経験をもとに、プロダクトゴールとマーケット構造から逆算するアーキテクチャ選定の実践的な考え方について解説。モノリス vs マイクロサービス、レイヤー設計の選択基準、そして継続的適応の重要性を論じる。
tags:
  - "architecture"
  - "clean-architecture"
  - "microservices"
  - "startup"
  - "domain-driven-design"
  - "product-strategy"
---

## 概要

新しいプロダクトを立ち上げる際のソフトウェアアーキテクチャ選定は重要な意思決定です。本記事では、PeopleXで1年半の間に5つのプロダクトを立ち上げた経験をもとに、プロダクト戦略とマーケット特性から逆算するアーキテクチャ選定の考え方を解説します。

## 目的から出発し、実践との相互フィードバックを重ねる

アーキテクチャ選定において重要なのは、**「プロダクトゴールを起点とし、現場からのフィードバックを重ねて実践知化していく」** ことです。

- **トップダウン型の課題**: 現場のリアリティや暗黙知が共有されにくい
- **ボトムアップ型の課題**: 全体の方向性を見失い、局所最適に陥りがち

両者の視点を往復しながら「目的志向のアーキテクチャ」を磨くことが重要です。主要なアーキテクチャパターンや先行事例を学ぶことは重要ですが、「有名企業が採用しているから」という理由だけで真似をするのは危険です。自分たちのプロダクトのゴールやチームの構成を踏まえて、最適な選択を探ることが大切です。

## マーケットからリアリティのある未来予測を行う

アーキテクチャの議論では、「モノリスかマイクロサービスか」「MVCかクリーンアーキテクチャか」といった設計論に注目が集まりがちです。しかし、その前に **自分たちが参入するマーケット構造と制約を深く理解する必要があります**。

### 現代の市場構造の特徴

- マス向けの巨大市場は90〜00年代に既に押さえられている
- 金融、EC、採用といった領域では先行プレイヤーが圧倒的シェアを保持
- スマートフォン以降の変革も限定的
- TAM（最大市場規模）が明確に予測できる場合もある
- 技術的優位が市場に求められないケースも少なくない

マーケットを丁寧に学び、リアリティのある未来予測を立てることで、プロダクトと組織の"攻め方"の方向性が定まっていきます。

## モノリスか、マイクロサービスか

### 比較表

| パターン | Pros | Cons |
|---------|------|------|
| **モノリス** | ・構成がシンプルで全体像を把握しやすい<br>・同一トランザクションでCRUDが可能なためデータ整合性の問題が少ない<br>・ローカル環境の構築が容易 | ・異なるドメインが同居しやすく、後から分離が難しい<br>・全体を理解しないと開発が進めにくく、認知負荷が高い |
| **マイクロサービス** | ・各サービス単位で最適化でき、チーム分業に強い<br>・小さな単位で素早くリリースできる<br>・サービスごとに最適な技術を選択できる | ・サービス間の整合性や依存関係の管理が難しい<br>・ローカル環境構築が複雑化しやすい<br>・メンテナンスするサービスの数が増える |

### 選択基準

よく「まずはモノリスから始め、必要に応じてマイクロサービスに移行すべき」と言われますが、以下のように整理できます：

> **製品が市場に受け入れられるか不確実ならモノリスから。**
> **市場が大きく、初期から大規模展開が前提ならマイクロサービスから。**

### 実例

- **PayPay**: 後発ながら巨大市場を短期間で取りにいく戦略を採用。当初からマイクロサービス構成を前提
- **新市場創出型プロダクト**: 初期の不確実性が高く、モノリス構成で素早くMVPを出すほうが合理的

**重要な注意点**: 新市場創出型のプロダクトでは、事前に適切なドメイン境界を定義すること自体が難しいため、マイクロサービスを"理想通り"に運用するのは非常に困難です。

## 市場規模から逆算する

TAM（最大市場規模）の視点から、アーキテクチャの方向性を逆算することもできます。

### 市場規模別の戦略

- **1,000億円規模（国内）**: 必然的にtoCの大規模サービスや広告・金融・ECといった領域
- **100億円規模（国内BtoB SaaS）**: 単一プロダクトで達成する例はごくわずか

### 戦略の方向性

市場の成熟度や事業ポートフォリオ（PPM）を踏まえ、以下のような選択を意識的に行うことが重要です：

- 「マイクロサービスで拡張を前提に大きな市場を作り続ける」
- 「マーケット規模を考慮して、モノリスのまま少人数で高収益を維持する」

## レイヤー設計の考え方

同一アプリケーション内でレイヤーをどのように分割するかは、アーキテクチャ設計におけるもう一つの大きな選択です。

### 代表的なパターン

かつてはRuby on RailsのMVCパターンが主流でしたが、近年は責務の明確化と依存方向の制御を重視する以下のパターンが普及してきました：

1. **クリーンアーキテクチャ**
2. **オニオンアーキテクチャ**
3. **ヘキサゴナルアーキテクチャ**

### 共通の特徴

- 4層以上のレイヤー構造
- ドメイン（ビジネスルール）を中心に据えた設計
- **依存性逆転の原則（DIP）** を用いて「外側（インフラやUI）→内側（ドメイン）」への依存方向を保つ
- データ中心ではなく**ドメイン中心**の発想
- データベーススキーマ設計とビジネスルールの表現を切り離す

これにより、ドメイン層がインフラやフレームワークに依存せず、**テスト容易性・保守性・変更耐性**を高めることができます。

### PeopleXでの実践と考え方

PeopleXでは、プロダクトごとにレイヤー設計の適用度や構造を意図的に変えています。

#### PeopleWork（HRプラットフォーム）

- ビジネスロジックが複雑化しやすい
- DBスキーマとドメインモデルを分離
- リポジトリ層でDIPを適用
- ドメインロジックをデータアクセス層から独立させる設計

#### AI面接プロダクト

- データ自体が主軸となる
- ORMのスキーマ型をドメインモデルとして直接利用
- DIPのような複雑な抽象化は採用しない
- 理由: データ駆動型アプリケーションでは「スキーマ＝ドメイン」と見なすほうがシンプルかつ効率的

### ドメインの複雑さとレイヤー構造の関係

- **ドメインが複雑な場合**: クリーンアーキテクチャのようなレイヤー分離が有効
- **ビジネスロジックが単純な場合**: 多層構造を採用するとモデルが「貧血化」し、実質的にデータの詰め替え処理だけを行うドメイン層になりがち

リポジトリ層の捉え方も設計思想によって変わります：

- 「ドメインを表現するための抽象インターフェース」として扱う
- 単に「データ受け渡しのヘルパー」として扱う

どちらが正しいというものではなく、**プロダクトの性質・組織の成熟度・チームの文化に依存**します。

### プロダクト特性による選択

レイヤー構造を考える上で重要なのは、「プロダクトが潜在市場に挑むのか、既存市場に後発参入するのか」という文脈です。

#### 潜在市場向けの新しいプロダクト

- ユーザーがその製品に初めて触れることが多い
- 複雑なビジネスルールを実装しても使いこなされにくい
- プロダクトのビジネスロジック自体も初期は単純
- レイヤー構造も簡素な方が現実的

#### 既存市場に参入する後発プロダクト

- 顧客要求や業務ルールが複雑
- 初期段階から高いドメイン表現力が求められる
- 初期からドメイン中心の設計を意識することが長期的に有効

#### 長期的な視点

どちらのタイプであっても、5年・10年と時間が経てばビジネスルールは必ず複雑化します。特に前者では成長に合わせて段階的にレイヤーを拡張していく **「進化的アーキテクチャ」** の発想が望ましいといえます。

## まとめ: 早期適応の重要性

### アーキテクチャ変更の現実

アーキテクチャを後から根底から変更することは容易ではありません。開発を数ヶ月止めるような変更は経営マターになり、現実的にはほとんど起こりません。

### 素早い適応の重要性

だからこそ、決定した設計を絶対視せず、**ズレを早期に察知して素早く適応する姿勢**が不可欠です。

### PeopleXの実例: AI面接

リリース後5ヶ月で実施した変更：

- レイヤー再設計
- モジュール再配置
- バリデーション方式の変更

成長が早いからこそズレも早期に顕在化し、開発を止めず迅速に対応できたのは、チーム全体で合意形成しパワープレーを厭わず進めた結果です。

### 結論

> アーキテクチャには絶対的な正解はありません。
> プロダクトと組織の変化にあわせて、**継続的に適応し続けることこそが唯一の「正解に近づく道」** です。

## 関連リンク

- [PeopleX採用情報](https://hrmos.co/pages/peoplex/jobs)
- [PeopleX Entrance Book](https://peoplex.wraptas.site/)
