---
title: "CVE-2025-69263 - pnpm Has Lockfile Integrity Bypass that Allows Remote Dynamic Dependencies"
source: "https://github.com/advisories/GHSA-7vhp-vf5g-r2fw"
author:
  - "orenyomtov (Finder)"
  - "zkochan (pnpm maintainer)"
published:
created: 2026-01-10
description: |
  pnpmにおいて、HTTP tarball依存関係がロックファイルに整合性ハッシュなしで保存される脆弱性。リモートサーバーがインストールごとに異なるコンテンツを配信できるため、サプライチェーン攻撃が可能になる。CVSS 7.5（High）。
tags:
  - "security"
  - "vulnerability"
  - "pnpm"
  - "supply-chain-attack"
  - "CVE"
  - "npm"
---

## 概要

**CVE ID**: CVE-2025-69263  
**Advisory ID**: GHSA-7vhp-vf5g-r2fw  
**深刻度**: **7.5 (High)**  
**EPSS スコア**: 0.018%  
**CWE**: CWE-494 (Download of Code Without Integrity Check)  
**対象パッケージ**: pnpm (npm)  
**ソースコード**: [pnpm/pnpm](https://github.com/pnpm/pnpm)

## 脆弱性の詳細

### 問題の概要

HTTP tarball依存関係（およびgitでホストされたtarball）がロックファイルに**整合性ハッシュなしで保存される**。これにより、ロックファイルが存在していても、リモートサーバーがインストールごとに異なるコンテンツを配信できてしまう。

### 技術的詳細

パッケージがHTTP tarball URLに依存している場合、pnpmのtarballリゾルバは整合性ハッシュを計算せずにURLのみを返す：

```
resolving/tarball-resolver/src/index.ts
```

結果として、ロックファイルエントリには検証すべき整合性情報がない。整合性ハッシュがないため、pnpmはサーバーが異なるコンテンツを返しても検出できない。

### 影響を受ける依存関係の種類

| 種類 | 例 |
|------|-----|
| HTTP/HTTPS tarball URL | `"pkg": "https://example.com/pkg.tgz"` |
| Git ショートハンド | `"pkg": "github:user/repo"` |
| Git URL | `"pkg": "git+https://github.com/user/repo"` |

> ⚠️ **注意**: npmレジストリパッケージは、レジストリメタデータから整合性ハッシュが含まれるため影響を受けない。

## 攻撃シナリオとインパクト

HTTP tarball依存関係を持つパッケージを公開した攻撃者は、異なるユーザーやCI/CD環境に異なるコードを配信できる。これにより以下が可能になる：

1. **ターゲット型攻撃**: リクエストメタデータ（IP、ヘッダー、タイミング）に基づく攻撃
2. **セキュリティ監査の回避**: レビュー中は無害なコード、後から悪意あるコードを配信
3. **サプライチェーン攻撃**: 時間経過とともに悪意あるペイロードが変化

### 攻撃の前提条件

被害者が依存関係ツリーにHTTP/git tarballを持つパッケージをインストールすること。**被害者のロックファイルは保護を提供しない**。

## PoC（概念実証）

提供されたPoCには以下が含まれる：

- 各リクエストで異なるtarballコンテンツを返すサーバー
- HTTP tarballに依存する悪意あるパッケージ
- 悪意あるパッケージに依存する被害者プロジェクト

PoCの出力は、コミット済みロックファイルが存在するにもかかわらず、各インストール（間に`pnpm store prune`を実行）で異なるコードがダウンロードされることを示す。

## 参考情報

- [GHSA-7vhp-vf5g-r2fw](https://github.com/advisories/GHSA-7vhp-vf5g-r2fw)
- [NVD - CVE-2025-69263](https://nvd.nist.gov/vuln/detail/CVE-2025-69263)
- [pnpm/pnpm@0958027](https://github.com/pnpm/pnpm/commit/0958027) (修正コミット)
- [CWE-494: Download of Code Without Integrity Check](https://cwe.mitre.org/data/definitions/494.html)

## クレジット

- **発見者**: orenyomtov
- **修正者**: zkochan (pnpmメンテナー)
