# pg_duckdb - PostgreSQL プロセス上の DuckDB で OLAP ワークロードを処理する

ref: <https://zenn.dev/yohei/articles/2024-11-09-pg-duckdb>

- **pg_duckdbの概要**: pg_duckdbはPostgreSQLの拡張機能で、DuckDBのOLAP(オンライン分析処理)クエリエンジンをPostgreSQLプロセス内で実行することで、分析ワークロードの処理を強化します。
- **パフォーマンスの利点**: DuckDBはPostgreSQLのネイティブクエリエンジンよりもOLAPワークロードの処理が速く、クエリの実行時間が短縮されます。
- **データレイクとの統合**: pg_duckdbはParquet、Iceberg、Delta Lakeなどのクラウドオブジェクトストレージ形式のデータを照会することができ、モダンなデータレークアーキテクチャに適しています。
- **コラボレーション**: この拡張機能は、Hydra、DuckDB Labs、MotherDuckといったスタートアップ企業が共同で開発したものであり、データ処理技術の発展に向けた協調的な取り組みを示しています。
- **ユースケースの背景**: 著者は、スタートアップ環境におけるOLAPワークロードの経験を振り返り、従来のクラウドデータウェアハウスが抱える課題と、コスト効率的な解決策を探る必要性について述べています。
- **コスト最適化**: 著者は、特に小規模なワークロードにおいて、クラウドデータウェアハウスの高コストが問題となっており、DuckDBのようなより手頃な代替手段に注目が集まっていると指摘しています。
- **クエリパフォーマンステスト**: パフォーマンス比較の結果、特定のクエリでPostgreSQLの92秒から、DuckDBの144ミリ秒へと大幅な改善が見られました。
- **データ処理方法**: CSVファイルをDuckDBにロードしたり、Parquet形式で出力するなど、オブジェクトストレージからのデータ処理方法が説明されています。
- **スケーラビリティの限界**: pg_duckdbは小規模なデータセットに対して高いパフォーマンスを示しますが、専用のOLAPデータベースと比べると、特に大規模なデータセットに対するスケーラビリティに限界があります。
- **将来の可能性**: 新しいプロジェクトであるpg_duckdbは、今後の開発と改善により、中規模のOLAPワークロードに対して、従来のデータウェアハウスのオーバーヘッドなく対応できる有望なソリューションになる可能性があります。
