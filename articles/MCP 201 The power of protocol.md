---
title: "MCP 201: The power of protocol"
source: "https://www.youtube.com/watch?v=HNzH5Us1Rvg"
author:
  - "[[Anthropic]]"
published: 2025-08-01
created: 2025-08-03
description: "Presented at Code w/ Claude by @anthropic-ai on May 22, 2025 in San Francisco, CA, USA. Speakers: David Soria Parra, Member of Technical Staff at @anthropic-ai"
tags:
  - "clippings"
  - "MCP"
  - "Model Context Protocol"
  - "AI"
  - "Anthropic"
  - "Protocol"
  - "Developer Tools"
category: "Technology"
type: "Conference Talk"
language: "ja"
duration: "約30分"
topics:
  - "MCP Primitives"
  - "Prompts"
  - "Resources"
  - "Tools"
  - "Sampling"
  - "Roots"
  - "OAuth 2.1"
  - "Web Deployment"
  - "Enterprise Integration"
speaker:
  name: "David Soria Parra"
  role: "Member of Technical Staff"
  company: "Anthropic"
  title: "MCP Co-creator"
event:
  name: "Code w/ Claude"
  organizer: "Anthropic"
  date: "2025-05-22"
  location: "San Francisco, CA, USA"
key_concepts:
  - "プロトコルプリミティブ（サーバーサイド：プロンプト、リソース、ツール / クライアントサイド：サンプリング、ルーツ）"
  - "インタラクションモデル（ユーザー主導、アプリケーション主導、モデル主導）"
  - "ウェブ展開とスケーリング"
  - "エンタープライズ統合パターン"
future_developments:
  - "エージェント機能の強化"
  - "エリシテーション機能"
  - "公式レジストリ"
  - "マルチモダリティ拡張"
---
# MCP 201: The power of protocol - 文字起こし内容（箇条書き版）

## 基本情報

- **イベント**: Code w/ Claude by Anthropic
- **開催日**: 2025年5月22日
- **開催地**: サンフランシスコ、カリフォルニア州、米国
- **講演者**: David Soria Parra（Anthropic技術スタッフメンバー、MCP共同作成者）

## 講演の目的と構成

- プロトコルについてより詳しく説明
- 現在多くの人が使用している「ツール」以外にも、プロトコルでできることがあることを理解してもらう
- プロトコルの全力を活用してより豊かなMCPクライアントとのインタラクションを構築する方法を紹介

### 講演の流れ

1. サーバーがクライアントに情報を公開する「プリミティブ」について説明
2. プロトコルのあまり知られていない側面について解説
3. 豊かなインタラクションの構築方法について説明
4. MCPの今後の展開とウェブへの展開について紹介

## MCPプリミティブ詳細

### 1. プロンプト（Prompts）

- **定義**: AI インタラクション用の事前定義されたテンプレート
- **機能**: MCPサーバーがテキストセット（プロンプト）を公開する方法
- **使用方法**: ユーザーが直接コンテキストウィンドウに追加

#### 主な使用ケース

- **例の提供**: MCPサーバーの作成者がユーザーに最適な使用方法を示す
  - 作成者はサーバーを構築し、最適な使用方法を知っている
  - リリース時点で最も多く使用している人物
- **動的機能**: MCPプロンプトは動的であり、MCPサーバーで実行されるコードに過ぎない
  - より豊かな機能を実現可能

#### デモンストレーション例

- ユーザーがエディタで呼び出すMCPプロンプト
- GitHubのコメントを直接コンテキストウィンドウに取得
- プルリクエストからのコメントをコンテキストウィンドウに追加
- モデルと対話して、要求された変更を適用

#### 特徴

- **ユーザー主導**: モデルではなくユーザーが実行タイミングを決定
- **ツールとの違い**: ツールはモデルが実行タイミングを決定

#### プロンプト補完機能

- **機能**: あまり知られていない隠れた機能
- **例**: 利用可能なプルリクエストを選択するポップアップ表示
- **用途**: より豊かなパラメータ化されたテンプレートを構築
- **実装**: TypeScriptで非常に簡単
  - Claude CodeとClaude 4で必要なコードを自動生成可能
  - 補完のための関数とプロンプト生成のための関数のみで実現

### 2. リソース（Resources）

- **定義**: MCPサーバーがMCPクライアントに公開できるもう一つのプリミティブ
- **焦点**: サーバーからの生データやコンテンツの公開
- **プロンプトとの違い**: プロンプトはテキストスニペット、リソースは生データ

#### 使用理由

- **直接追加**: 現在のクライアントの多くは生コンテンツを直接コンテキストウィンドウに追加可能
- **追加処理**: アプリケーションがその生データに対して追加の処理を実行可能
  - サーバーが公開するデータの周りに埋め込みを構築
  - 検索拡張生成（RAG）の実装
  - 最も適切なものをコンテキストウィンドウに追加

#### 現状と将来性

- **現状**: この分野は現在あまり探求されていない
- **潜在的可能性**: ファイル追加以外の用途（検索拡張、その他アプリケーション処理）

#### デモンストレーション例

- MCPクライアントがリソースをファイルのようなオブジェクトとして公開
- PostgreSQLデータベースのスキーマをリソースとして公開
- Claude Desktopでファイルのように追加
- Claudeにテーブルの可視化を依頼
- 結果: Claudeがデータベーススキーマを可視化する美しい図を作成

### 3. ツール（Tools）

- **定義**: 呼び出すことができるアクション
- **対象**: 多くの人が既に馴染みのあるプリミティブ
- **前提**: MCPサーバーを構築した人は、おそらくツールを公開するために構築

#### 特徴

- **魔法的な瞬間**: MCPサーバー構築時の最も魔法的な瞬間の一つ
  - モデルが初めて、作成者が関心を持ち構築したものを呼び出す時
  - 小さな影響を与える（データベースのクエリなど）
- **モデル主導**: モデルがアクションを呼び出すタイミングを決定

## インタラクションモデル

### 概念

- **定義**: Model Context Protocolの仕様言語に埋もれている概念
- **目的**: 「いつ何を使うか」を明確にする
- **仕組み**: 同じデータを3つの異なる方法で公開可能

### 3つの駆動方式

1. **プロンプト**: ユーザー主導
   - ユーザーが呼び出し、コンテキストウィンドウに追加
   - 最も一般的なシナリオ: スラッシュコマンド、アドコマンドなど

2. **リソース**: アプリケーション主導
   - LLMを使用するアプリケーション（Claude Desktop、VS Codeなど）が決定
   - アプリケーションが処理方法を完全に制御

3. **ツール**: モデル主導
   - モデルが実行タイミングを決定

### 利点

- AIアプリケーション、モデル、ユーザーの間で全ての部分をカバー
- ツールだけでは実現できない、より豊かなアプリケーションと体験を構築可能
- モデルがツールを呼び出すのを待つよりも、ユーザーとより繊細に対話可能

## 高度な機能

### サンプリング（Sampling）

- **定義**: MCPの隠れた機能またはプリミティブ
- **機能**: サーバーがクライアントから補完を要求できる

#### 背景と問題設定

- **例**: イシュートラッカーからディスカッションを要約するMCPサーバー
- **課題**: 要約ステップにはモデルが必要
- **従来の方法**: 独自のSDKを持参してモデルを呼び出し
- **問題点**:
  - クライアントは既にモデル（Claudeなど）を選択している
  - MCPサーバーはクライアントの設定モデルを知らない
  - 追加のAPIキーが必要になり煩雑

#### サンプリングの解決策

- **仕組み**: サーバーが独自にSDKを提供することなく、モデルを独立して使用
- **方法**: クライアントに設定されているモデルを尋ね、クライアントがサーバーに補完を提供

#### 2つの主要メリット

1. **クライアント制御**:
   - セキュリティ、プライバシー、コストを完全に制御
   - 追加のAPIキー不要
   - クライアントが既に持っているサブスクリプションを利用可能

2. **再帰的パターン**:
   - 複数のMCPサーバーを興味深い方法でチェーン可能
   - ツールを公開するMCPサーバーの実行中に下流でより多くのMCPサーバーを使用
   - リクエストをバブルアップし、クライアントが常に完全制御を維持
   - 小さなMCPエージェントを構築する複雑なパターンが可能

#### 現状と今後

- **現状**: 最もエキサイティングな機能だが、クライアントで最もサポートされていない
- **予定**: Anthropicのファーストパーティプロジェクト・製品で今年中に導入予定

### ルーツ（Roots）

- **定義**: 興味深いが名前が適切でないプリミティブ（作成者による自己評価）
- **作成者の反省**: 命名が得意ではない

#### 使用場面

- **例**: gitコマンドを扱うMCPサーバーの構築
- **ニーズ**:
  - gitを直接扱いたくない
  - ソースコントロールコマンドを実行したくない
  - コマンドを覚えていない
  - MCPサーバーに処理させたい

#### 問題と解決

- **問題**: MCPサーバーはIDEで開かれているプロジェクトを知らない
- **必要**: 開いているワークスペースでgitコマンドを実行したい
- **解決**: ルーツ機能
  - サーバーがVS Codeなどのクライアントから「開いているプロジェクトは何ですか」を照会
  - サーバーが開いているディレクトリ内でのみ動作
  - gitコマンドを実行したい場所を特定

#### 現状

- **利用状況**: 広く使用されていない機能
- **サポート**: VS Codeは現在これをサポート

## 全体の構造

### 5つのプリミティブ

- **サーバーサイド**: 3つ（プロンプト、リソース、ツール）
- **クライアントサイド**: 2つ（サンプリング、ルーツ）
- **目的**: これらすべてをまとめて豊かなインタラクションを構築

### 実装例：チャットアプリケーション統合

仮想的なMCPサーバー（Discord、Slack連携）の構築例：

#### プロンプトの活用

- **例の提供**: 「この議論を要約する」などのユーザーへの例
- **補完機能**: 最近のスレッド、ユーザー、または公開したいものとの補完
- **追加プロンプト**:
  - 「新しいこと」
  - 「昨日以来何が起こったか」
- **効果**: ユーザーが提供したサーバーの使用をすぐに開始し、使用意図を理解

#### リソースの活用

- **チャンネルリスト**: チャンネルを直接リスト
- **最近の脅威公開**: チャットアプリケーションで発生した最近の脅威を公開
- **クライアント処理**: MCPクライアントがインデックス化し、望む方法で処理

#### ツールの活用

- **検索機能**
- **チャンネル読み取り**
- **スレッド読み取り**
- **サンプリング活用**: スレッドを要約するためにサンプリングを使用

#### 結果

- MCPでプロトコルが提供する全力を使用
- はるかに豊かな体験を構築可能

## MCPのウェブ展開

### 現状の課題

- **過去の体験**: これまでのMCPサーバー構築はほとんどがローカル体験
- **統計**: 過去6〜7ヶ月でコミュニティが構築した10,000のMCPサーバーの大多数がローカル体験
- **次のステップ**: MCPサーバーをローカル体験からウェブに移行

### ウェブ展開の概念

- **従来**: DockerコンテナやローカルファイルPexecutableの形のMCPサーバー
- **新しい形**: クライアントが接続してMCPを公開し、通信できるウェブサイト

### 必要な2つの重要コンポーネント

#### 1. 認証（Authorization）

- **最新仕様での対応**: コミュニティや主要パートナーからの教訓とフィードバックを反映
- **業界協力**: 業界の専門家と密接に協力して正しい実装を実現

##### 認証の機能

- **プライベートコンテキスト提供**: オンラインアカウント背後のユーザーのプライベートコンテキストをLLMアプリケーションに直接提供
- **機能バインド**: MCP作成者がMCPサーバーの機能をユーザー、オンラインアカウントなどにバインド可能

##### OAuth 2.1の採用

- **要求仕様**: MCP仕様でOAuth 2.1の実装が必要
- **懸念点**: OAuth 2.1を知っている人は非常に少ない
- **実際の内容**:
  - 通常行うすべての基本的なことを含むOAuth 2.0
  - OAuth経験者が推奨するセキュリティ考慮事項
  - 少し整理されたOAuth 2.0
  - 既にOAuthを実装している場合はおそらく対応済み

#### 2. スケーリング（Scaling）

- **新機能**: 「ストリーム可能HTTP」の追加
- **目的**: MCPサーバーを通常のAPIと同様にスケールさせる

##### 実装オプション

1. **シンプルな方法**:
   - REST APIのように結果を直接返す（完全にRESTではない）
   - リクエスト受信 → アプリケーションJSON返却 → 接続終了
   - 次の接続は別のLambda関数で処理

2. **リッチな相互作用**:
   - 通知やサンプリングなどの高度な機能が必要な場合
   - リクエスト受信 → ストリーム開始 → クライアントがストリーム受け入れ
   - 最終結果返却前にクライアントに追加情報送信可能

## OAuth実装による2つのパターン

### パターン1: ウェブでのMCPサーバー

#### 例：支払いプロバイダー

- **設定**: payment.comというウェブサイト、ユーザーがオンラインアカウントを保有
- **実装**: 支払いプロバイダーがmcp.payment.comを公開
- **フロー**:
  1. ユーザーがMCPクライアントにURLを入力
  2. MCPクライアントがOAuthフローを実行
  3. ユーザーが自分のアカウントでログイン
  4. payment.comとして認識、信頼するプロバイダーとして識別

#### メリット

- **信頼性向上**:
  - 第三者開発者のランダムなDockerコンテナを信頼する必要がない
  - 既にデータを信頼している人とその開発者を信頼
- **更新の簡便性**:
  - 開発側で好きなようにサーバーを更新可能
  - 新しいDockerイメージのダウンロード待ち不要
- **インパクト**: MCPサーバーのウェブ公開とMCPクライアントの既存オンライン相互作用との統合を大幅に促進

### パターン2: エンタープライズ統合

#### 統合方法

- **デプロイメント**: 内部でMCPサーバーを内部ネットまたは使用環境にデプロイ
- **認証基盤**: 既存のアイデンティティプロバイダーを活用
  - Azure ID
  - Okta
  - その他の中央アイデンティティプロバイダー
  - 通常シングルサインオンに使用するもの

#### 実装の流れ

- **トークン提供**: アイデンティティプロバイダーがMCPサーバーとの相互作用に必要なトークンを提供
- **スムーズな統合**: 非常にスムーズな統合を実現

#### ユーザー体験

- **開発チーム**:
  - 制御するMCPサーバーを内部で構築
  - デプロイメントを制御
- **エンドユーザー**:
  - 朝に通常のSSOでログイン（従来通り）
  - MCPサーバー使用時は自動的にログイン状態
  - 会社が持っている自分のデータにアクセス可能

#### 組織的メリット

- **分離された役割**:
  - 会社の一部がサーバーを構築
  - 他の部分が統合を担当
  - 統合ビルダーとプラットフォームビルダーの明確な分離
- **拡張性**: 大企業での広大なMCPサーバーシステム構築が可能

### 基盤としての意義

- **変革**: MCPをローカル体験から真の標準への転換
- **標準化**: LLMアプリケーションがウェブと相互作用する方法の真の標準
- **実現要素**: 認証とスケーリングが一緒になることで実現

## MCPの今後の展開

### 1. エージェント機能の強化

#### 非同期タスクの対応

- **課題**: 現在は1分程度の短いタスクが中心
- **ニーズ**: 数時間の長時間実行タスクへの対応
- **アプローチ**: エージェントが引き受ける長時間実行の非同期タスク
- **計画**: 近い将来MCPにそのためのプリミティブを構築

### 2. エリシテーション（Elicitation）

- **定義**: MCPサーバー作成者がユーザーからの入力を求める機能
- **リリース予定**: 講演当日または翌月曜日にプロトコルに実装予定

### 3. 公式レジストリの構築

#### 目的

- **中央集約**: MCPサーバーを見つけて公開できる中央の場所を確保
- **共通プラットフォーム**: 一つの共通の場所でサーバーを探索

#### 機能

- **静的機能**: サーバーの発見と公開
- **動的機能**: エージェントによるサーバーの動的ダウンロード、インストール、使用

### 4. マルチモダリティの拡張

#### 検討中の機能

- **結果のストリーミング**: 確実に実装予定
- **その他の側面**: 詳細は未公開（将来の発表予定）

## エコシステムの拡充

### SDK開発

#### 新しいSDK

1. **Ruby SDK**:
   - 提供者: Shopify
   - リリース予定: 今後数週間
   - 形態: 寄贈

2. **Go SDK**:
   - 開発者: GoogleのGoチーム
   - 現状: 現在構築中
   - 性質: 公式SDK

### 開発サポート

- **自動化**: Claude CodeとClaude 4による開発支援
- **コード生成**: 必要なコードの大部分を自動生成可能

## 講演の結論

### 達成目標

- **詳細な視点提供**: MCPプロトコルの全力を使用する場合の可能性について
- **実用的知識**: より詳細な実装に関する理解の向上

### 時間制約

- **Q&A中止**: 時間不足により質疑応答セッションは実施できず
- **代替対応**: 講演後の廊下での個別質問対応を提案

### 感謝表明

- **聴衆への謝意**: 講演への参加と注意深い聞き取りに対する感謝
