---
title: "操作より状態・性質に着目する"
source: "https://zenn.dev/knowledgework/articles/c48539d2f35ecc"
author:
  - "mayah"
published: 2025-09-01
created: 2025-09-02
description: |
  美しく堅牢なコードを書く上で、操作よりも状態・性質に注目する習慣の重要性について論じています。操作から考えると状態の変更に抜け漏れが生じやすく、複雑な「ただし書き」仕様を生みがちですが、先に操作前後の状態を定義することで、コードはシンプルかつ堅牢になります。
tags:
  - "設計"
  - "ソフトウェア設計"
  - "状態管理"
  - "プログラミング"
---

この記事では、美しく堅牢なコードを書くための重要な習慣として、「操作」よりも「状態・性質」に注目することの重要性を論じています。多くのソフトウェアエンジニアが関数の実装、すなわち「操作」から考え始めるのに対し、一握りのエンジニアは操作の前後に期待される「状態・性質」から考えることで、コードの複雑性を低減し、堅牢性を高めていると指摘します。

## ユーザー登録を例に考える

ユーザー登録機能を例に、「操作から考える」アプローチと「状態から考える」アプローチの違いを説明しています。

### 操作から考えるアプローチ

このアプローチでは、まず「`users`テーブルにデータをINSERTする」という操作から発想します。その後で、メールアドレスが重複していた場合（有効なユーザー、無効化されたユーザー）などの例外的なケースを後付けで考慮していくことになります。

この思考プロセスには、以下のような問題点があります。

* **抜け・漏れの発生**: 操作の前提となる状態をその場しのぎで考えてしまうため、考慮すべき状態の変更に抜けや漏れが生じやすくなります。
* **状態の複雑化**: 操作（コード）を単純にするために、「ユーザーが〜〜の場合には状態を変更しない」といった「ただし書き」のある仕様が生まれがちです。このような小さな例外の積み重ねが、システム全体の状態を複雑にし、開発者の認知負荷を増大させます。

### 状態から考えるアプローチ

推奨されるアプローチは、実装（操作）を考える前に、操作の前後で取りうる状態を明確に定義することです。

1. **操作前の状態を定義する**:
    * 該当するメールアドレスのユーザーは存在しない。
    * 該当するメールアドレスのユーザーが存在し、有効である。
    * 該当するメールアドレスのユーザーが存在し、無効である。
2. **操作後の状態を定義する**:
    * 操作が成功すれば、該当するメールアドレスのユーザーが存在し、**有効である**。

このアプローチでは、操作が成功した後の状態を可能な限りシンプルに（この例では1つに）保つことを目指します。これにより、**「この操作が成功すれば、必ず有効なユーザーが作成されている」という強力な性質が保証されます。** 無効なユーザーのメールアドレスが渡された場合の振る舞いなどは、この状態定義を維持する前提でプロダクト仕様として決定します。

## 関数定義からプロダクト仕様への敷衍

この「状態から考える」アプローチは、関数定義のような小さな単位に限りません。プロダクトの仕様定義のような、より大きなレベルでも応用できます。

* **What vs How**: 機能の詳細（How: 操作）を先に考えるのではなく、その機能によって何を成し遂げたいか（What: 事後条件）や、ユーザーが現在どのような状態にあるか（事前条件）を先に考えるべきです。
* **問題構造の理解**: これは、いきなり回答（実装）に飛びつくのではなく、まず問題の構造（状態や性質）を理解しようという、学問的な問題解決アプローチの焼き直しでもあります。

## まとめ

著者は、操作から考える癖をやめ、まず操作の前後で成り立ってほしい状態や性質を定義し、その後にそれを満たす操作を考えるという思考順序を推奨しています。この習慣が、美しく堅牢なコードを書くための下地となると結論付けています。
