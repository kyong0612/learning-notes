---
title: "テスト用に適当なドメインを注入したいときは .invalid を使うとよさそう"
source: "https://blog.3qe.us/entry/2025/07/02/170320"
author:
  - "Windymelt"
published: 2025-07-02
created: 2025-07-05
description: |
  テスト時にダミーURLが必要な際、意図しない外部アクセスを防ぐため、常にNXDOMAINを返すことが保証されている`.invalid` TLDの使用が推奨されることについて解説しています。
tags:
  - "DNS"
  - "TLD"
  - "RFC"
  - "testing"
  - "network"
---
## 要点

テストや開発でダミーのドメイン名が必要な場合、`.invalid` というトップレベルドメイン（TLD）を使用することが最も安全で推奨されます。このドメインは、外部のネットワークに意図せずリクエストが送信されることを確実に防ぎます。

## 背景と課題

開発中のアプリケーション、特に環境変数でURLを受け取るような設定がある場合、テスト時にはバリデーションを通過させるためにダミーのURL（例: `https://example.com/dummy`）を設定することがあります。

しかし、この方法には以下のようなリスクが伴います。

* **意図しない外部アクセス**: コードの不具合や設定ミスにより、ダミーのつもりで設定した `example.com` のような実在するドメインに、実際にHTTPリクエストが送信されてしまう可能性があります。
* **情報漏洩リスク**: もしそのリクエストに機密情報や内部データが含まれていた場合、情報漏洩につながる恐れがあります。

これらのリスクは低いかもしれませんが、意図しないデータ送信の可能性は極力排除することが望ましいです。

## RFCに基づく解決策: `.invalid` TLD

この問題を解決するために、IETF（Internet Engineering Task Force）が発行するRFC（Request for Comments）で予約されている特殊なTLDの利用が有効です。

### 予約済みTLD

RFC 2606およびRFC 6761では、以下のTLDが特殊な用途のために予約されています。

* `.test`: テスト目的で使用。
* `.example`: ドキュメントや例示で使用。
* `.invalid`: 明らかに無効なドメインとして使用。
* `.localhost`: ローカルホスト（自身のコンピュータ）を指すために使用。

### `.invalid` の特別な役割

これらのTLDの中でも、`.invalid` は特に安全な選択肢です。RFC 6761では、`.invalid` TLDについて以下のように規定されています。

1. **常に失敗する名前解決**: `.invalid` で終わるドメイン名へのDNSクエリは、**必ず `NXDOMAIN`（Non-Existent Domain）** という「ドメインが存在しない」応答を返す必要があります。
2. **外部への問い合わせを禁止**: DNSリゾルバやサーバーは、`.invalid` ドメインの問い合わせを外部の権威DNSサーバーなどに転送してはならないとされています。
3. **登録の禁止**: DNSレジストリは、`.invalid` ドメインを誰にも登録してはなりません。

これにより、`.invalid` を使用したドメイン（例: `https://api.internal.invalid/v1/users`）は、どのような状況でも外部ネットワークへアクセスしないことが保証されます。

### 他のTLDとの比較

| TLD | 応答の挙動 | 主な用途と注意点 |
| :--- | :--- | :--- |
| **`.invalid`** | **常に `NXDOMAIN`** | **最も安全なダミー値。** 外部へのリクエストが発生しない。 |
| `.localhost` | ループバックアドレスを返す | ローカルマシン内のサービスを指す場合にのみ使用すべき。 |
| `.test` | デフォルトで `NXDOMAIN` だが変更可能 | ローカルのテスト環境で特定のアドレスを返すように設定されることがある。 |
| `.example` | 通常の名前解決が行われる | 実在するサーバーにアクセスする可能性があり、ダミー値としては不適切。 |

## 結論

テスト用のダミーURLとして、`example.com` のようなドメインを使用するのは避けるべきです。代わりに、RFCによって外部へのアクセスが発生しないことが保証されている `.invalid` TLDを使用することで、意図しないリクエスト送信のリスクを完全に排除し、より安全なテスト環境を構築できます。
