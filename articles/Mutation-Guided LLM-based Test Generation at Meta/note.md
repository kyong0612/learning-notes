# Mutation-Guided LLM-based Test Generation at Meta

ref: <https://arxiv.org/html/2501.12862v1>

ソフトウェア開発現場では、品質向上のために新しいテストケースを自動生成する取り組みが活発です。Meta では、**ACH**（仮称：Automated Compliance Hardener）と呼ばれるシステムを用い、**大規模言語モデル（LLM）** を活用して、ミュータント（疑似的な欠陥）を「殺す」テストケースを自動生成する手法を実装しています。ここでは、ACH の基本的な考え方、仕組み、得られた成果や課題について、わかりやすく解説します。

---

## はじめに

近年、LLM の性能向上により、コード生成やテスト生成への応用が注目されています。Meta では、既存のテストで検知できなかった欠陥を狙い、LLM を活用して新しいテストを自動生成する仕組みを開発しました。特に、プライバシーなどの重要な懸念事項に対応するため、**ミュータントテスト**の考え方を取り入れたアプローチを採用しています。

---

## ミュータントテストとは？

ミュータントテストは、プログラムに故意に小さな変更（ミュータント）を加え、その変更が検出されるかどうかでテストの有効性を評価する手法です。

- **ミュータント生成**  
  → ルールベースまたは LLM を用いて、現実に起こりうる欠陥をシミュレートするコード変更を自動生成
- **テスト生成**  
  → 生成したミュータントを「殺す」（検出する）テストケースを自動生成
- **目的**  
  → 既存テストで検出できなかった潜在的な欠陥（例えばプライバシー関連の問題）を捕捉し、コードの堅牢性を向上させる

---

## ACH のアプローチ

### 1. LLM を活用したミュータント生成

ACH では、LLM の強力なコード生成能力を利用して、与えられたテキスト（例：プライバシーに関する懸念事項）から、実際に発生しうる欠陥をシミュレートするミュータントを生成します。  
→ これにより、既存のテストでは検知できない新たな問題の候補を用意します。

### 2. ミュータントを殺すテストケースの自動生成

生成したミュータントに対して、それらの欠陥を検知（＝殺す）するユニットテストを、LLM を用いて自動生成します。  
→ ミュータントが検出されることで、そのテストが有効であることが保証されます。

### 3. 等価ミュータントの検出

しばしば発生する課題として、ミュータントは文法上変更があっても意味的にはオリジナルと同一（＝等価）な場合があります。  
ACH では、LLM を利用したエージェントとシンプルな静的解析を組み合わせ、等価ミュータントを除外する仕組みを取り入れています。

---

## 実験結果と学び

Meta の複数のソフトウェアプラットフォーム（例：Facebook Feed、Messenger、Instagram、WhatsApp など）に対して ACH を展開した結果、以下のような成果が得られました。

- **ミュータント生成数とテスト生成数**  
  → 数千のクラスから数千のミュータントが生成され、そのうち約半数が等価でないと判断され、実際にテスト生成に利用された
- **テストの有用性**  
  → 生成されたテストは、既存のテストが捉えられていなかった欠陥（例えば、プライバシーリグレッション）を検出することに成功
- **エンジニアの受け入れ率**  
  → 自動生成されたテストは、コードレビューを通じて実際に採用され、リグレッション防止に寄与

また、等価ミュータント検出エージェントの精度・再現率は、シンプルなルールと組み合わせることで非常に高い数値（精度 0.95、再現率 0.96）を達成しました。

---

## 今後の課題

ACH の展開により多くの成果が得られた一方で、以下のような課題も見えてきました。

- **ミュータント等価性の一般化**  
  → 現在の結果が特定の言語（Kotlin）や環境（Android, Meta）に依存していないか、さらなる検証が必要
- **欠陥の関連性評価**  
  → 生成されたミュータントが実際にどの程度「類似」または「関連」しているかを定量的に評価する方法の開発
- **既存欠陥検出との統合**  
  → 将来的には、既存の欠陥も検出できるオラクル推定技術との統合も視野に入れる

---

## 結論

Meta での ACH の展開は、LLM とミュータントテストの組み合わせによる自動テスト生成が、産業規模のソフトウェア開発において実用的かつ有用であることを示しています。  

- **LLM の柔軟性**  
  → テキスト（懸念事項）から現実的な欠陥を生成できる  
- **自動化の強み**  
  → テストケース生成を自動化することで、エンジニアの負担を軽減し、リグレッションを未然に防ぐ  
- **産業応用の成功例**  
  → 実際のコードベースに適用し、受け入れられたテストケースを生成できた点は大きな成果

ACH の成功は、今後の自動テスト生成やコード品質向上のアプローチに大きな影響を与えるとともに、LLM の新たな活用例として注目されています。

---

## おわりに

本稿では、Meta における ACH システムの概要とその成果、そして今後の課題についてご紹介しました。  
今後も、LLM の技術進化や新たな手法の登場により、より高品質なテスト自動生成や欠陥検出の技術が進化していくことが期待されます。

---

> ※本記事は、最新の研究成果をもとに、技術者向けにわかりやすく解説した内容です。興味をお持ちの方は、元論文や関連文献もぜひご参照ください。

---

# 付録：等価ミュータント検出エージェントの評価結果

以下に、論文中で示された等価ミュータント検出エージェントの評価結果の一部を示します。

### Table 6. 等価ミュータント検出エージェントの精度と再現率

※「判断が不確か」の場合は、単純に評価対象から除外する場合の結果

| 真陽性 (TP) | 偽陽性 (FP) | 真陰性 (TN) | 偽陰性 (FN) | 精度 (Precision) | 再現率 (Recall) |
| ----------- | ----------- | ----------- | ----------- | ---------------- | --------------- |
| 56          | 2           | 205         | 72          | 0.97             | 0.44            |

※「判断が不確か」を等価とみなす場合

| TP | FP | TN  | FN  | 精度  | 再現率 |
| -- | -- | --- | --- | ----- | ------ |
| 65 | 17 | 205 | 72  | 0.79  | 0.47   |

※コードが同一であるものも等価とみなす場合

| TP  | FP | TN  | FN  | 精度  | 再現率 |
| --- | -- | --- | --- | ----- | ------ |
| 161 | 17 | 205 | 72  | 0.90  | 0.69   |

※生成エージェントが追加したコメントをすべて除去した場合

| TP  | FP | TN  | FN  | 精度  | 再現率 |
| --- | -- | --- | --- | ----- | ------ |
| 183 | 9  | 251 | 8   | 0.95  | 0.96   |

### Table 7. ミュータント数が最も多い4つのプラットフォームにおける、等価ミュータント検出エージェントの精度 (Prec.) と再現率

#### 【Messenger プラットフォームの場合】  

※エージェントが「不確か」と判断した場合は、その判断を単に評価対象から除外して算出する場合

| TP  | FP | TN  | FN  | 精度  | 再現率 |
| --- | -- | --- | --- | ----- | ------ |
| 17  | 2  | 50  | 19  | 0.89  | 0.47   |

#### 【Wearables プラットフォームの場合】

| TP  | FP | TN  | FN  | 精度 | 再現率 |
| --- | -- | --- | --- | ---- | ------ |
| 11  | 0  | 55  | 18  | 1.0  | 0.38   |

#### 【WhatsApp プラットフォームの場合】

| TP  | FP | TN  | FN  | 精度 | 再現率 |
| --- | -- | --- | --- | ---- | ------ |
| 16  | 0  | 51  | 11  | 1.0  | 0.59   |

#### 【Instagram プラットフォームの場合】

| TP  | FP | TN  | FN  | 精度 | 再現率 |
| --- | -- | --- | --- | ---- | ------ |
| 12  | 0  | 49  | 24  | 1.0  | 0.33   |

（さらに「不確か」と判断したものや、コメント除去後の結果も詳細に記載されていますが、ここでは省略しています。）

---
> 以下原文

※「判断が不確か」の場合は、単純に評価対象から除外する場合の結果

| 真陽性 (TP) | 偽陽性 (FP) | 真陰性 (TN) | 偽陰性 (FN) | 精度 (Precision) | 再現率 (Recall) |
| ----------- | ----------- | ----------- | ----------- | ---------------- | --------------- |
| 56          | 2           | 205         | 72          | 0.97             | 0.44            |

※「判断が不確か」を等価とみなす場合

| TP | FP | TN  | FN  | 精度  | 再現率 |
| -- | -- | --- | --- | ----- | ------ |
| 65 | 17 | 205 | 72  | 0.79  | 0.47   |

※コードが同一であるものも等価とみなす場合

| TP  | FP | TN  | FN  | 精度  | 再現率 |
| --- | -- | --- | --- | ----- | ------ |
| 161 | 17 | 205 | 72  | 0.90  | 0.69   |

※生成エージェントが追加したコメントをすべて除去した場合

| TP  | FP | TN  | FN  | 精度  | 再現率 |
| --- | -- | --- | --- | ----- | ------ |
| 183 | 9  | 251 | 8   | 0.95  | 0.96   |

---

### Table 7. ミュータント数が最も多い4つのプラットフォームにおける、等価ミュータント検出エージェントの精度 (Prec.) と再現率

#### 【Messenger プラットフォームの場合】  

※エージェントが「不確か」と判断した場合は、その判断を単に評価対象から除外して算出する場合

| TP  | FP | TN  | FN  | 精度  | 再現率 |
| --- | -- | --- | --- | ----- | ------ |
| 17  | 2  | 50  | 19  | 0.89  | 0.47   |

#### 【Wearables プラットフォームの場合】

| TP  | FP | TN  | FN  | 精度 | 再現率 |
| --- | -- | --- | --- | ---- | ------ |
| 11  | 0  | 55  | 18  | 1.0  | 0.38   |

#### 【WhatsApp プラットフォームの場合】

| TP  | FP | TN  | FN  | 精度 | 再現率 |
| --- | -- | --- | --- | ---- | ------ |
| 16  | 0  | 51  | 11  | 1.0  | 0.59   |

#### 【Instagram プラットフォームの場合】

| TP  | FP | TN  | FN  | 精度 | 再現率 |
| --- | -- | --- | --- | ---- | ------ |
| 12  | 0  | 49  | 24  | 1.0  | 0.33   |

次に、「不確か」と判断したものを等価と見なす場合の結果は以下の通りです。

#### 【Messenger プラットフォームの場合】

| TP  | FP | TN  | FN  | 精度 | 再現率 |
| --- | -- | --- | --- | ---- | ------ |
| 19  | 3  | 50  | 19  | 0.86 | 0.50   |

#### 【Wearables プラットフォームの場合】

| TP  | FP | TN  | FN  | 精度 | 再現率 |
| --- | -- | --- | --- | ---- | ------ |
| 14  | 1  | 55  | 18  | 0.93 | 0.50   |

#### 【WhatsApp プラットフォームの場合】

| TP  | FP | TN  | FN  | 精度 | 再現率 |
| --- | -- | --- | --- | ---- | ------ |
| 19  | 9  | 51  | 11  | 0.68 | 0.63   |

#### 【Instagram プラットフォームの場合】

| TP  | FP | TN  | FN  | 精度 | 再現率 |
| --- | -- | --- | --- | ---- | ------ |
| 13  | 4  | 49  | 24  | 0.76 | 0.35   |

さらに、生成エージェントが追加したコメントを除去後、すなわちコードが文法的に同一と判断できる場合の結果は以下の通りです。

#### 【Messenger プラットフォームの場合】

| TP  | FP | TN  | FN  | 精度  | 再現率 |
| --- | -- | --- | --- | ----- | ------ |
| 41  | 3  | 50  | 19  | 0.93  | 0.58   |

#### 【Wearables プラットフォームの場合】

| TP  | FP | TN  | FN  | 精度  | 再現率 |
| --- | -- | --- | --- | ----- | ------ |
| 42  | 1  | 55  | 18  | 0.98  | 0.70   |

#### 【WhatsApp プラットフォームの場合】

| TP  | FP | TN  | FN  | 精度  | 再現率 |
| --- | -- | --- | --- | ----- | ------ |
| 47  | 9  | 51  | 11  | 0.84  | 0.81   |

#### 【Instagram プラットフォームの場合】

| TP  | FP | TN  | FN  | 精度 | 再現率 |
| --- | -- | --- | --- | ---- | ------ |
| 31  | 4  | 49  | 24  | 0.86 | 0.56   |

最後に、さらに生成エージェントが追加したコメントを除去し、文法的に同一と判断した場合は、

#### 【Messenger プラットフォームの場合】

| TP  | FP | TN  | FN  | 精度  | 再現率 |
| --- | -- | --- | --- | ----- | ------ |
| 41  | 3  | 67  | 2   | 0.93  | 0.95   |

#### 【Wearables プラットフォームの場合】

| TP  | FP | TN  | FN  | 精度  | 再現率 |
| --- | -- | --- | --- | ----- | ------ |
| 42  | 1  | 69  | 4   | 0.93  | 0.91   |

#### 【WhatsApp プラットフォームの場合】

| TP  | FP | TN  | FN  | 精度  | 再現率 |
| --- | -- | --- | --- | ----- | ------ |
| 47  | 1  | 66  | 0   | 0.99  | 1.0    |

#### 【Instagram プラットフォームの場合】

| TP  | FP | TN  | FN  | 精度  | 再現率 |
| --- | -- | --- | --- | ----- | ------ |
| 53  | 4  | 49  | 2   | 0.93  | 0.96   |

---

### 6. ミュータントテストの重要性

テストに関する文献では、理論的にも実証的にも、ミュータント適合基準（mutation adequacy criteria）が、従来の構造的基準（たとえば、行カバレッジや分岐カバレッジ）よりも優れていることが広く知られています（Chekam et al., 2017; Papadakis et al., 2019）。

本節では、実際の大規模産業システムへのミュータントテストの導入経験から、これまでの研究成果をさらに裏付ける結果を示します。

Table 8 は、等価でないミュータントを殺すテストによる行カバレッジの結果を示しています。Messenger、Instagram、Wearables、WhatsApp の各プラットフォームについては、「おそらく実際の」ミュータント殺害率は Table 5 の各プラットフォームにおける実際の等価ミュータントの割合に基づいています。その他のプラットフォームでは、4つのプラットフォーム全体の平均値に基づいています。最後の3列は、TestGen-LLM（Alshahwan et al., 2024a）によって生成されたテストの結果（割合）を示し、ACH によって生成されたテストとの比較を行っています。TestGen-LLM は特定の欠陥を対象にテストを生成するのではなく、単に追加のカバレッジを取得するテストを生成することを目的としています。

Table 8 の結果から、唯一追加でミュータントを殺すテストの大部分（49%）は、行カバレッジを追加していないことが分かります。これらのテストは、既存のテストでは検知できなかった欠陥を捕捉するため、明らかに価値があります。しかし、テストケースを追加カバレッジのみで評価すると、こうした価値あるテストケースが誤って却下される可能性があります。

また、Table 8 の結果は、TestGen-LLM は ACH よりも多くのクラスに対してテストを生成する（32% 対 5.3%）一方、殺せるミュータントの割合ははるかに低い（2.4% 対 15%）ことも明らかにしています。これは、ACH が特定のミュータントをターゲットにしているのに対し、TestGen-LLM はそのようなターゲットを設けていないためです。

これらの結果から、ミュータントをターゲットにすることでカバレッジを向上させることも可能ですが、単にカバレッジだけをターゲットにするとミュータントを殺すことは不十分であると結論づけられます。既に研究文献（Papadakis et al., 2019; Chekam et al., 2017）では示されていますが、これらは産業システムではなく、実験室での制御実験に基づくものです。今回の我々の知見は、既存の文献を補完し、産業実践に基づくミュータントテストの重要性を裏付けるものです。

さらに、TestGen-LLM によって殺されなかったミュータントの70%は、TestGen-LLM によるテストが存在しないクラスに存在します。これに加えて、ACH によって生成されたテストの51%が行カバレッジも向上させていることから、ミュータントをターゲットにする ACH の手法は、カバレッジ向上という副次的効果も有していると結論付けられます。

具体的には、もしあるメソッドに対してあらゆる種類、あらゆる抽象度のミュータントを多数生成し、それぞれを LLM へのプロンプトとして利用すれば、ミュータントは Retrieval Augmented Generation (RAG) に類似した役割を果たす可能性があります。既存の結果および、RAG が他のソフトウェア工学タスクにおける LLM の性能向上に寄与することが知られている事実（Fan et al., 2023）を鑑みると、カバレッジ向上を目的としたミュータント＝RAG 手法は、特定の欠陥検出だけでなく、構造的カバレッジの最適化においても有望であると考えられます。

Table 8 は、テストが追加カバレッジとともにミュータント検出も行っている件数を示しています。これは、もし新規カバレッジのみをターゲットにしていた場合、プラットフォームが約半数の欠陥に起因するリグレッションに対して脆弱なままであった可能性の上限を示しています。

| プラットフォーム   | （等価でないミュータントとみなされたおそらく実際の数） | ミュータント殺害テスト数 | クラスのうちミュータント殺害テストを持つ割合 | ミュータント殺害率（おそらく実際の） | テストのうちカバレッジを追加しないものの数（％） | TestGen-LLM テストを持つクラスの割合 | TestGen-LLM による殺害率（おそらく実際の） | TestGen-LLM テストを持たないクラスに残る未殺害ミュータントの割合 |
| ------------------ | ---------------------------------------------------------- | ------------------------ | --------------------------------------------- | ------------------------------------- | -------------------------------------------------- | ------------------------------------ | ------------------------------------------ | ---------------------------------------------------------- |
| Facebook Feed      | 164; 133                                                 | 15                       | 4.3%                                         | 9%; 11%                             | 9 (60%)                                           | 33%                                | 3.0%; 3.7%                              | 71%                                                       |
| Messenger          | 1,395; 1,155                                             | 196                      | 5.9%                                         | 14%; 17%                           | 84 (43%)                                          | 31%                                | 2.0%; 2.4%                              | 71%                                                       |
| Instagram          | 742; 687                                                 | 122                      | 7.2%                                         | 16%; 18%                           | 77 (55%)                                          | 27%                                | 2.9%; 3.1%                              | 74%                                                       |
| Aloha              | 90; 74                                                   | 9                        | 5.1%                                         | 10%; 12%                           | 4 (44%)                                           | 27%                                | 1.0%; 1.2%                              | 76%                                                       |
| Wearables          | 1,314; 1,007                                             | 45                       | 1.6%                                         | 3%; 4%                             | 32 (71%)                                          | 31%                                | 1.9%; 2.5%                              | 70%                                                       |
| Cross-app          | 270; 275                                                 | 35                       | 4.3%                                         | 13%; 13%                           | 20 (57%)                                          | 28%                                | 2.8%; 2.7%                              | 75%                                                       |
| Oculus             | 150; 121                                                 | 14                       | 4.3%                                         | 9%; 12%                            | 3 (21%)                                           | 35%                                | 4.9%; 6.1%                              | 70%                                                       |
| WhatsApp           | 535; 445                                                 | 135                      | 10.6%                                        | 25%; 30%                           | 48 (36%)                                          | 44%                                | 3.5%; 4.2%                              | 55%                                                       |
| **Totals**         | 4,660; 3,897                                             | 571                      | 5.3%                                         | 12%; 15%                           | 277 (49%)                                         | 32%                                | 2.0%; 2.4%                              | 70%                                                       |

---

### 7. 関連研究

コードの予測可能性に関する強い実証的・理論的根拠（Hindle et al., 2012; Barr et al., 2014; Gabel and Su, 2010）があるため、予測言語モデルが有用なコード生成に効果的であることは驚くべきことではありません。その結果、LLM はソフトウェア工学のさまざまな応用分野でコード生成の役割を担っています（Fan et al., 2023）。

LLM 生成コードに対するソフトウェアエンジニアの受け入れ率は広く研究されています。たとえば、Google の研究者は AI によるコード補完に対する信頼に影響を与える要因を調査しており（Brown et al., 2024）、また、Copilot の受け入れ率がおおよそ30%であると報告されています（Speed, 2023）。

しかしながら、これらの研究は、生成されたコード補完が必ずしもコンパイル可能でない（保証がない）という点で、コード補完のユースケースに関するものです。一方、ACH は Assured LLM-Based Software Engineering (Assured LLMSE) を採用しており（Alshahwan et al., 2024c）、生成されるテストの意味論的な正しさや有用性について保証を与えています。ACH の提案は、単なるコード補完の断片ではなく、コンパイル可能なコード単位として提出され、オンデマンドで（特定の欠陥クラスをターゲットにするために）生成されるため、IDE 内でリアルタイムに補完を行うコード補完技術よりも、より高い全体的受け入れ率が期待できると考えられます。

さらに、コード補完はリアルタイム（オンライン）にIDEへ直接展開されるのに対し、ACH は通常の継続的インテグレーション（CI）およびコードレビューのプロセスを通してオフラインで提案されるため、エンジニアが機械生成コードの受け入れ判断に対して監査証跡（audit trail）が残るという利点もあります。対して、エンジニアが受け入れた LLM ベースのコード補完は、誰がどの程度その補完に寄与したかの詳細が監査記録に残らず、そのプロセスは不透明です。

LLMSE に関する文献はすでに多数存在します（Fan et al., 2023）。しかし、ここではソフトウェアテスト、特にミュータントテストへの LLM の応用に焦点を当てています。

従来、ミュータントテスト（Jia and Harman, 2011）では、あらかじめ定義されたルールベースのオペレーターを用いてミュータントを生成していました。しかし、こうしたルールベースのミュータント生成手法は、現実的な欠陥生成には不向きであることが広く指摘されており（Richter and Wehrheim, 2022; Jimenez et al., 2018）、より現実的なミュータントの生成方法が求められていました。最近では、言語モデルを用いてより現実的なミュータントを生成する試みがなされており（Tip et al., 2024; Wang et al., 2024）、ACH はこの方向性をさらに発展させ、特定の懸念事項に関連する欠陥群を生成する手法として位置づけられています。

ミュータントテストは、また LLM 自身の評価の手段としても用いられてきました（Li and Shin, 2024）、あるいはコンパイラの入力を変異させてテストする手法としても応用されています（Italiano and Cummins, 2025）。この文脈において、ミュータントの望ましい性質は、変異前のプログラムと文法的・意味論的に近い「近傍」を生成できる点にあります。これにより、言語モデルがコードをどの程度「理解」しているかなどの特性を探ることが可能となります。また、この「近傍」性は、遺伝的改善（Genetic Improvement、Petke et al., 2018）など他のソフトウェア工学技術を向上させるためにも、言語モデルと組み合わせて利用されています。

等価ミュータント問題については（Jia and Harman, 2011; Madeyski et al., 2013）、既に広く研究されており、我々が LLM を用いてこの問題に取り組むのは初めてではありません。Tian et al.（2024）は、MutantBench 上で従来のルールベースの変異演算子に対して、LLM を用いた等価ミュータント検出が、従来手法よりも F1 スコアで35% 向上することを報告しています。特に、ファインチューニングされた埋め込み表現の高性能が強調されています。

これまでの LLM を用いたミュータントテストに関する研究は、主にベンチマーク問題や実験室環境での実証に留まっていましたが、本論文は、産業規模での LLM ベースのミュータントテストの展開報告としては初めてのものです。従来の非 LLM ベースのミュータントテストは、Meta（Beller et al., 2021）や Google（Petrović et al., 2021; Petrović and Ivanković, 2018; Petrovic et al., 2018）において産業応用が評価されていましたが、これらの事例ではミュータントを殺すテストの自動生成は行われず、生成されたミュータントを殺す作業はエンジニアが行っていました。これに対し、ACH はミュータントを殺すテストを自動生成する初のシステムであり、この点は研究文献（Carlos et al., 2014; Harman et al., 2011）で研究されてきたものの、産業規模で展開された事例はこれまで存在しませんでした。

ACH の本報告は、Meta におけるこれまでの自動解析・テスト生成技術の流れの延長上に位置付けられます。これまでの取り組みには、Sapienz（Alshahwan et al., 2018）などのエンドツーエンドのテスト生成ツールや、Infer（Calcagno et al., 2015）などの静的解析ツール、さらにはユーザーコミュニティ間の相互作用をテストするシミュレーションベースのテスト生成（Ahlgren et al., 2021a; Tuli et al., 2023; Ahlgren et al., 2021b）などがありました。これらの多くはシステムレベルのテストに焦点を当てていましたが、我々はユニットレベルのテスト生成手法についても、観察に基づく手法（Alshahwan et al., 2024b）や言語モデルを用いた手法（Alshahwan et al., 2024a）に取り組んできました。しかし、これまでのユニットテスト生成はカバレッジ向上のみを目的としていたため、ACH のように特定の欠陥クラスをターゲットにすることはできませんでした。

---

### 8. 未解決の課題

今後の研究の方向性として、以下のような課題が挙げられます。

**ミュータント等価性:**  
言語モデルによって生成された疑似プライバシー欠陥は、二峰性を示す傾向があり、その結果、等価ミュータントは非常に容易に検出できることが分かりました（セクション5参照）。ただし、これらの結果が Kotlin、Android、Meta、または疑似プライバシー欠陥に特有のものである可能性も否定できません。しかし、我々の手法自体には、結果が一般化しないという要素はないと考えられ、もし一般化できれば、これまでミュータント等価性が展開の大きな障害となっていたミュータントテスト研究にとって重要な知見となるでしょう。

**ミュータントの関連性:**  
我々は、以前に観測された欠陥と類似した欠陥を捉える特定のミュータントを生成することに成功しました。しかし、場合によっては、生成されたミュータントは一般的な欠陥クラスに属するものの、具体的な事例そのものではないという指摘がありました。ここでの難しさは、ある欠陥が別の欠陥とどの程度類似しているか、または関連しているかを一貫して信頼性高く測定する方法が確立されていない点にあります。今後は、欠陥間の類似性や関連性の定義を明確化し、その指標を利用して、ファインチューニング、プロンプト設計、再プロンプト、Chain-of-Thought などを用いたエージェント型 LLM ワークフローをより適切に導く手法の研究が求められます。

**既存の欠陥検出:**  
本手法は将来的なリグレッションに対してシステムを強化することを目的としているため、現行バージョンのコードをリグレッションオラクルとして扱っています（Alshahwan et al., 2023）。すなわち、変更前後でテストの挙動が同一であればテストはパスと見なされます。この仕組みにより、将来のリグレッションに対しては防御できますが、既存のコードベースに潜む欠陥を検出することはできません。既存欠陥を検出するためには、従来から知られるオラクル問題（Barr et al., 2015）に取り組む必要があります。

特に、Targeted LLM-based Mutation-Guided Test Generation のためにオラクルを推定する手法が見出されれば、大きなインパクトをもたらすでしょう。これにより、既存の欠陥クラスを探索できるようになります。オラクル推定に関する先行研究は多くあります（Tuli et al., 2023; Ibrahimzada et al., 2022; Oliveira et al., 2014; Zhang et al., 2014）が、誤検出によってエンジニアの時間を無駄にしないためには、より高精度な手法が必要です。ACH のように、特定の懸念事項に対する欠陥やテストを生成する手法は、オラクル生成においても有用な方向性となる可能性があります。

---

### 9. 結論

ミュータントテストは、1980年代半ば（Howden, 1985; DeMillo et al., 1978）以来、5割近くにわたって研究され続け、その知的魅力と研究者の関心は依然として高いテーマです。しかしながら、産業界においてミュータントテストを実用的に導入することは難しい課題でした（Beller et al., 2021; Alshahwan et al., 2023, 2019）。

従来、ミュータントは人手で作成されたテストスイートの評価手段として、ルールベースのシンプルな手法で構築されてきました。しかし、現場のソフトウェアエンジニアは、機械が自動生成すべきテストを自ら作るのではなく、むしろ特定の喫緊の懸念事項を明示することに専念すべきです。幸いなことに、ACH においては以下の 3 つの重要な技術的進展が実現されています：

1. **懸念事項（テキスト）をコード（疑似欠陥）に変換する LLM の能力により、非常に現実的な欠陥を自動生成できること。**  
2. **シンプルな静的解析と組み合わせた LLM ベースのエージェントにより、等価ミュータントを排除できること。**  
3. **ミュータントを殺すためのユニットテストを自動生成する手法を提供できること。**

本論文では、Meta における ACH の展開結果を示しました。LLM を用いたテスト生成やミュータント生成自体は新しい技術ではありませんが、これらを組み合わせた手法を大規模産業システムで展開したのは本論文が初めてです。我々は、この自動テスト生成のアプローチが、あいまい・不完全・場合によっては矛盾した自然言語で表現される複数の懸念事項に直面する現代のソフトウェア開発現場と非常に親和性が高いと考えています。また、本手法の結果は、ミュータントを Retrieval Augmented Generation（RAG）のように利用する手法が、構造的カバレッジ基準の最適化にも大きな影響を与える可能性を示唆しています。

---

### ACKNOWLEDGMENTS

本研究の実施にあたり、Meta の Llama チームおよび Fundamental Artificial Intelligence Research (FAIR)、Developer Infrastructure (DevInfra)、Product Compliance and Privacy 各チームのリーダーシップ、さらに ACH によって自動生成されたテストのレビューにご協力いただいた Meta のソフトウェアエンジニアの皆様に深く感謝いたします。

---

### References

※以下、参考文献リスト（各文献の詳細は元論文参照）。

- **Ahlgren et al. (2021a)**  
  John Ahlgren, Maria Eugenia Berezin, Kinga Bojarczuk, Elena Dulskyte, Inna Dvortsova, Johann George, Natalija Gucevska, Mark Harman, Maria Lomeli, Erik Meijer, Silvia Sapora, and Justin Spahr-Summers. 2021a.  
  *Testing Web Enabled Simulation at Scale Using Metamorphic Testing.* In *International Conference on Software Engineering (ICSE) Software Engineering in Practice (SEIP) track*. Virtual.

- **Ahlgren et al. (2021b)**  
  John Ahlgren, Kinga Bojarczuk, Sophia Drossopoulou, Inna Dvortsova, Johann George, Natalija Gucevska, Mark Harman, Maria Lomeli, Simon Lucas, Erik Meijer, Steve Omohundro, Rubmary Rojas, Silvia Sapora, Jie M. Zhang, and Norm Zhou. 2021b.  
  *Facebook’s Cyber–Cyber and Cyber–Physical Digital Twins (keynote paper).* In *25th International Conference on Evaluation and Assessment in Software Engineering (EASE 2021)*. Virtual.

- **Alshahwan et al. (2024a)**  
  Nadia Alshahwan, Jubin Chheda, Anastasia Finegenova, Mark Harman, Alexandru Marginean, Shubho Sengupta, and Eddy Wang. 2024a.  
  *Automated unit test improvement using Large Language Models at Meta.* In *ACM International Conference on the Foundations of Software Engineering (FSE 2024)* (Porto de Galinhas, Brazil).

- …（以下、他多数の文献が続く）

---
