# Rustで進化するPayPayのスケーラビリティ

ref: <https://blog.paypay.ne.jp/scaling-paypay-with-rust/>

PayPayは設立から6年間で急速に成長し、現在では6700万人以上のユーザーに対して、日々数百万件の決済を処理するまでに拡大しました。しかし、急増するトラフィックと高い信頼性要求により、従来のJavaやNodeJSベースのシステムでは、Kubernetesクラスター上でのCPU・メモリ使用量の増大とサーバーコストの上昇という課題に直面していました。そこで、2023年末からGraalVM、Go、Rustなどの選択肢が検討され、その中でもRustの高いパフォーマンス、メモリ安全性、強力な型システムが評価され、導入候補として注目されることになりました。

## Rust導入の動機

PayPayがRust導入を決断した理由は大きく3点に集約されます。

- **リソース効率の向上**  
  従来のJavaやNodeJSではリソース使用量が大きく、スケールが難しい点が課題でした。

- **運用の複雑さの解消**  
  JVMのチューニングやコンテナ内のヒープ管理など、運用面での複雑さが問題となっていました。

- **安全性と型システム**  
  金融サービスにおいてデータの正確性と安全性が求められる中、Rustの強固な型システムがエラーハンドリングの向上とリスクの低減に寄与する点が評価されました。

## PoC（概念実証）と初期展開

Rustが自社の課題を解決できるかを確認するため、まずは小規模なPoCプロジェクトが実施されました。  
このプロジェクトでは、従来NginxとJava/NodeJSで実装していたAPIゲートウェイの共通ロジック部分を、Rust製の「Proxy Companion」（Actix Webを利用した軽量HTTPサーバー）に置き換え、リソース使用量の削減や安定性の向上が検証されました。  
また、サイドカーコンテナとして配置することで、単一障害点の排除やノード間トラフィックの削減にも成功しました。

## 本番環境でのロールアウトと成果

初期のPoCが成功した後、段階的に本番環境へのロールアウトが開始されました。  
まず、トラフィックの少ないサービスから導入し、1ヶ月間でNginxの各ルートに対してRust製ゲートウェイを展開。その結果、Java版と比較して以下の改善が確認されました。

- **CPU使用量:** 約10倍の削減  
- **メモリ使用量:** 約80倍の削減

さらに、より大量のトラフィックを扱うサービスでは、従来の冗長なNodeJS認証サービスを排除することで、以下の成果を達成しました。

- **CPU使用量:** 約16倍の削減  
- **メモリ使用量:** 約100倍の削減  
- **平均レイテンシ:** 約30%の改善

## 評価と今後の展望

これまでのPoCとロールアウトの結果から、Rustはリソース効率とシステムの安定性向上に大きく貢献することが確認されました。  
自社インフラへの導入においても大きな問題は発生せず、運用面での信頼性も高いと評価されています。  
今後は、PoC実装を汎用化し、他のチームやプロジェクトでの活用を促進するとともに、社内ライブラリのRust化や定期的な学習グループの開催を通じて、Rustエコシステムをさらに強化していく方針です。

## 結論

PayPayは、Rustの導入により従来のシステムと比較して大幅なリソース削減と運用コストの低減を達成しました。  
今後もRustを中心とした技術基盤を拡充し、さらなるスケーラビリティとパフォーマンス向上を目指していきます。
