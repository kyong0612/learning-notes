---
title: "Entra ID の理解を深めよう Part 2 ～ アクセス権のライフサイクル管理 編 - MGTBC12"
source: "https://www.youtube.com/watch?v=5fAAYA5nZxs"
author:
  - "[[日本マイクロソフト株式会社 公式チャンネル]]"
published: 2024-10-28
created: 2025-08-04
description: |
  Entra IDにおけるアクセス権のライフサイクル管理についての解説。ID管理者が直面する権限管理の煩雑さや特権クリープの問題を取り上げ、RBAC、動的グループ、エンタイトルメント管理、PIM、アクセスレビュー、CIEM（Entraパーミッションマネジメント）といった機能を用いて、最小特権の原則に基づいた自動化された権限管理を実現する方法を詳説する。マルチクラウド環境（Azure, AWS, GCP）にも対応する包括的なアプローチを学ぶ。
tags:
  - clippings
  - Entra ID
  - Azure
  - AWS
  - GCP
  - Microsoft
  - Security
  - AccessManagement
  - PIM
  - CIEM
  - Identity
---
# Entra ID の理解を深めよう Part 2 ～ アクセス権のライフサイクル管理 編

## はじめに

- **講師**: Microsoft担当者
- **テーマ**: Entra IDの理解を深めよう パート2「特権のライフサイクル管理」について

## 特権のライフサイクル管理とは

### 概要

- アイデンティティ全体のライフサイクルを管理
  - ユーザーの登録から削除まで
  - この間でアクセス権の付与・変更が発生
- 人によっては特権・管理特権が必要
  - 例：Entra IDのユーザー登録権限
- **目標**: 管理者の負荷を少なく、確実に権限管理を行う

## 特権とは

### 定義

- **特権 = 何かをするための権限**（管理権限だけではない）
- 含まれるもの：
  - 管理権限（Entraに対する全体管理者、サブスクリプションの所有者）
  - 特定のアプリケーションに対するアクセス権

## ロールベースアクセスコントロール（RBAC）

### 基本概念

- **従来の問題点**: ユーザーを直接権限に割り当て → ユーザーと権限のマップが複雑化
- **RBACの仕組み**:
  - ユーザー・グループ → ロール → 権限
  - ロールには「スコープ」（リソース）が設定される
  - スコープ = ロールをどの範囲で行使できるか
  - ロールがリソース内で権限に変換される

### 特権管理の本質

- **核心**: ユーザー・グループにロールを割り当てるプロセス
- **求められること**:
  - 速やかに
  - スムーズに
  - 間違いなく
  - 短時間で

## 特権管理プロセスに使用する機能

### 全体像

- **パーミッションマネジメント（最後に詳説）**:
  - マルチクラウド環境（Azure、AWS、GCP）対応
  - ユーザー・グループの特権を可視化
  - 問題があれば修正

### 主要な5つの機能

1. **Entra IDのエンタイトルメント管理**
   - adhocなユーザーリクエストに対応
   - 自動的なワークフローを実行

2. **特権ID管理（PIM）**
   - ジャストインタイム方式
   - 管理特権を必要時のみ有効化

3. **エンタイトルメント管理・アクセスレビュー**
   - 特権のレビュー機能
   - 「このユーザーに特権は必要？」の判定を自動化

4. **条件付きアクセス・アイデンティティプロテクション**
   - 安全な環境でのみ特権使用を許可
   - リスクベース認証との組み合わせ

5. **アイデンティティガバナンス**
   - 各機能をワークフロー化
   - 自動化を実現

## 動的グループ

### 基本機能

- **概要**: グループにルールを設定し、自動でメンバーシップを管理
- **例**:
  - ルール: 「ユーザーの部署がSalesで始まる場合」
  - 結果: Sales部門のユーザーが自動的にグループメンバーになる
- **動的管理**:
  - ユーザーがSales → Marketingに移動
  - 属性変更に伴い、自動的にグループから除外・追加

## 特権付与のトリガー

### トリガーの種類

- **入社・社内移動**
- **adhocなアクセス必要性の発生**
- **突発的な管理権限の必要性**
  - 例：「今年は君がユーザー管理を担当して」

### 自動化の仕組み

- トリガー検出 → ワークフロー実行 → 特権の付与・剥奪を自動化

## 入社・移動に伴う特権付与

### 発生する事象

- **入社時**: ユーザー・ID新規作成がトリガー
- **移動時**: 属性変更（department属性）がトリガー

### アイデンティティガバナンスの活用

- **テンプレート例**: 「移動するユーザー」
- **トリガー**: ユーザーのdepartment属性変更
- **自動実行されるワークフロー**:
  1. 元の部署のグループからユーザーを削除
  2. 元の部署のTeamsチャンネルからユーザーを削除
  3. 新しい部署のグループにユーザーを追加
  4. 新しい部署のTeamsにユーザーを追加

### Logic Appとの連携

- **承認プロセスの追加**:
  - 上長による承認が必要な場合
  - Send approval mailでメール送信
  - Approveボタンクリックで承認
  - 承認済み → 左側フロー（実行）
  - 非承認 → 右側フロー（変更なし）

## エンタイトルメント管理（adhocなアクセス権要求）

### 概要

- **目的**: システム管理者へのメール依頼を削減
- **方式**: セルフサービス型のワークフロー化
- **語源**: エンタイトルメント = 資格付与

### アクセスパッケージの仕組み

- **事前設定内容**:
  - グループメンバーシップの付与
  - アプリケーションアクセス権
  - SharePointサイトアクセス権
  - 有効期間の設定
  - 承認者の指定
  - 申請可能者の制限（特定部署、FTEのみ等）
  - 質問事項の設定（アクセス理由等）

### アイデンティティガバナンスライセンス特典

- **承認後のLogic App連携**:
  - 単純な権限付与以外の作業も自動化
  - フォルダー作成等の関連作業

### アクセス方法

- **サイト**: MyAccess.Microsoft.com
- **プロセス**:
  1. ユーザーがサイトにアクセス・ログイン
  2. 該当パッケージを選択
  3. フォーム入力：
     - アクセス必要理由
     - 権限レベル（参照のみ/編集権限）
     - アクセス期間（一定期間/無期限）
  4. 要求送信
  5. 自動承認 or 上長承認
  6. アクセス権付与

### 特徴

- **申請者**: ユーザー本人
- **管理者関与**: なし（システム管理者が絡まない）

## 特権ID管理（Privileged Identity Management：PIM）

### 背景・目的

- **問題意識**:
  - IT部門の権限（Entra ID管理、Azureリソース操作等）
  - 常時権限を持つ必要はない
  - 1日中ユーザー管理をしているわけではない
- **解決策**: ジャストインタイムでの権限アクティベート（有効化）

### PIMの流れ

1. **一般ユーザー**
   - 初期状態：管理特権なし

2. **資格保有者への昇格**
   - 管理特権を使う資格がある状態
   - 事前に設定が必要

3. **特権申請**
   - 資格保有者のみが申請可能
   - 管理者特権使用の申請

4. **承認プロセス**
   - 自動承認 or 人による承認
   - 承認方式は設定で選択

5. **一定時間の権限行使**
   - 承認後に管理権限を取得
   - 最大24時間の制限

6. **権限の無効化**
   - 手動での無効化も可能
   - 時間経過による自動無効化

7. **降格**
   - 自動的に資格保有者に戻る

### 資格保有者の管理

- **期間設定**:
  - 最大1年間
  - 無期限
- **自動降格**: 1年経過後に非対象者へ降格
- **管理負荷**: 期限到来時の自動剥奪（手動管理不要）

## 安全な環境での特権使用

### セキュリティ要件

- **問題意識**:
  - 監視・盗聴される可能性のあるネットワークでの特権使用は危険
  - 安全な環境でのみ特権使用を許可したい

### 条件付きアクセス・アイデンティティプロテクションとの連携

- **PIMでの設定**:
  - アクティブ化の条件として「Microsoft Entra条件付きアクセス認証コンテキスト」を設定
  - 条件をパスした場合のみ特権使用可能

### 具体的な条件例

- **ユーザーリスク**:
  - ユーザーリスクが低い場合 or リスクなしの場合のみ
  - サインインリスクが低い場合のみ
- **場所制限**:
  - 信頼できるネットワークでのみ使用可能

### 推奨事項

- **必須連携**: 条件付きアクセスとの連携を強く推奨

## アクセスレビュー（特権のレビュー）

### 背景・必要性

- **課題**:
  - 自動化されたプロセスでも第三者による適切性の確認が必要
  - 定期的な棚卸しの必要性
  - 特権剥奪の判断の難しさ

### アクセスレビューの機能

- **目的**: 難しい棚卸し作業の簡単化・自動化

### 設定項目

- **レビュー対象**:
  - グループ
  - アプリケーション
- **レビュー担当者**:
  - 本人（セルフレビュー）
  - 上長等の第三者
- **レビュー周期**:
  - 重要システム：1ヶ月に1回
  - 通常システム：1年に1回
- **スコープ**:
  - 正社員全員
  - ゲストのみ
  - 特定条件のユーザー

### 重要な対象ユーザー

#### ゲストユーザー

- **管理の複雑さ**:
  - 外部Entra IDからの招待ユーザー
  - 相手側の実在確認が困難
- **推奨事項**: 必ずレビュー実施

#### 非アクティブユーザー

- **定義**: 特権をしばらく使用していないユーザー
- **問題点**: 「本当にこの権限が必要？」という疑問
- **効果**: より安全な環境の維持

### 機械学習を活用したレビュー支援

#### 判断の困難さ

- **承認者の課題**:
  - 「本当に必要な権限か？」の全体把握が困難
  - 本人に確認しても「使うかもしれません」という曖昧な回答

#### 機械学習による支援

- **比較分析**:
  - 対象ユーザーと他のユーザーの比較
  - グループ内メンバーとの比較
  - 各種グループ所属状態の分析
- **所属度の算出**:
  - 他ユーザーとの関連性を数値化
  - 所属度が低い場合にアラート表示
- **承認者支援**:
  - 「アフィリエーションがLow」等の情報提供
  - 関連性が低いユーザーの可視化
  - 参考情報として活用（絶対的な判断基準ではない）

## マルチクラウドの特権管理（CIEM：Entraパーミッションマネジメント）

### 従来機能の限界

- **対象範囲**: 主にEntra ID・Azure・関連アプリケーション
- **目的**: IT管理者の運用コスト削減
- **判断主体**: 人による判断（特権クリープの検出）

### マルチクラウド環境での課題

- **複雑性**:
  - Azure、AWS、GCP各々で異なる権限管理方式
  - 判断の困難さ
- **必要性**: 一元的な監視仕組み

### CIEM（Cloud Infrastructure Entitlement Management）

- **読み方**: 「キム」
- **分野**: セキュリティ
- **実装**: Entraパーミッションマネジメント

### 現状認識

- **多くの顧客**: マルチクラウド環境での運用
- **必要な監視対象**:
  - Entra・Azure
  - AWS・GCP
  - 各クラウドのアイデンティティプロバイダー
- **求められる機能**: 包括的な特権監視

### パーミッションマネジメントの機能

#### 1. スキャン機能

- **対象リソース**:
  - Azure、Entra、AWS、GCP
- **スキャン項目**:
  - ユーザーID
  - グループ
  - アプリケーションID
- **状態確認**:
  - アクティブ/非アクティブ
  - 有効/無効
- **分析内容**:
  - 過剰な特権付与の検出
  - 未使用特権の特定

#### 2. PCI（Permission Creep Index）算出

- **指標**: パーミッションクリープインデックス
- **意味**: 数値が大きいほど過剰な特権保有度が高い

#### 3. パターン検出・異常検出

- **特権使用パターンの分析**
- **機械学習による異常検出**

#### 4. 修復プロセス

- **対応方法**:
  - ポリシー適用
  - 特権削除
- **継続的改善**: 検出→修復のサイクル

### 具体的な画面例・機能

#### AWSのクリープインデックス表示

- **例**: PCI = 568
- **表示方式**: 左から右に行くほど高リスク
- **視覚的把握**: 現在位置の相対的な危険度

#### 多角的分析

- **ユーザー側面**
- **ロール側面**  
- **リソース側面**

#### 詳細分析例

- **高リスクユーザーの特定**:
  - PCI値が82-83等の高値ユーザー
- **根拠データ**:
  - 許可済み権限：11,404個
  - 実際使用権限：93個
  - 未使用権限：約11,700個
- **判定**: 明らかな権限過多（パーミッションギャップが大きい）

#### 修復機能

- **ロール削除**: ユーザーに割り当てられたロールの削除
- **ポリシー適用**:
  - ロール割り当て維持
  - ジャストインタイム使用への変更

#### 詳細権限分析

- **過去24時間の使用権限表示**:
  - ロールレベルではなく権限レベルでの詳細表示
  - 実際に使用された権限の可視化
- **カスタムロール作成**:
  - 過去半年間の使用権限分析
  - 必要最小限の権限のみでカスタムロール作成

### 総合効果

- **対象**: Azure・AWS・GCP全般
- **実現機能**:
  - 特権状態の監視
  - 問題の修復
  - 継続的な改善サイクル

## まとめ

### 特権ライフサイクル管理の重要事項

#### 基本原則

- **適切なユーザーが**
- **正しい特権で**  
- **適切な期間だけ**
- **リソースにアクセスできる**
- **これを常に維持し続ける**

#### 実現方法

- **手動管理の限界**: 手動では困難
- **自動化の必要性**: 自動化による解決

#### 継続的管理

- **監視体制**: 常に監視できる状態の維持
- **レビュー体制**: レビューできる状態の確保

#### 管理特権の特別な注意事項

- **危険性**: 常時アクティブは非常に危険
- **推奨方式**:
  - 使用時のみジャストインタイムで昇格
  - 使用後は自動降格
- **目標**: 安全な特権ライフサイクル管理の実現

### 適用範囲

- **Entra IDのみならず**
- **マルチクラウド環境でも同様の戦略が必要**
- **マルチクラウド利用者への推奨**: パーミッションマネジメントの検討

### 最終メッセージ

- **包括的アプローチ**: 様々な特権管理機能の組み合わせ
- **継続的改善**: 自動化とレビューの両立
- **セキュリティ重視**: 安全性を最優先とした設計

---

**講演終了**: ご清聴ありがとうございました
