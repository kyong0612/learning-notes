---
title: "E.1. Release 18"
source: "https://www.postgresql.org/docs/18/release-18.html"
author:
  - "The PostgreSQL Global Development Group"
published: 2025-TBD
created: 2025-01-02
description: "PostgreSQL 18の包括的なリリースノート。新機能、パフォーマンス改善、サーバー設定変更、ユーティリティコマンドの追加、データ型の拡張、関数の追加、そして既存機能からの重要な変更点を詳細に記載。"
tags:
  - "PostgreSQL"
  - "データベース"
  - "リリースノート"
  - "バージョン18"
  - "新機能"
  - "パフォーマンス改善"
  - "SQL"
  - "クエリ最適化"
---

## PostgreSQL 18 リリースノート

**リリース日**: 2025年（未定）  
**現在のドキュメント**: 2025年7月29日時点

## 概要

PostgreSQL 18は多数の新機能と機能強化を含むメジャーリリースです。主な改善点は現在整理中ですが、パフォーマンス最適化、新しいサーバー機能、ユーティリティの拡張などが含まれます。

## 重要な変更点と注意事項

### 互換性に影響する変更

#### initdb関連

- **データチェックサムがデフォルトで有効**: `initdb`でデータチェックサムがデフォルトで有効になりました
- チェックサムを無効にするには新しい`--no-data-checksums`オプションを使用
- `pg_upgrade`は同じチェックサム設定を要求するため、古いクラスターをアップグレードする際に注意が必要

#### 認証とセキュリティ

- **MD5パスワード認証の非推奨化**: MD5パスワードサポートが将来のメジャーバージョンで削除予定
- `CREATE ROLE`および`ALTER ROLE`でMD5パスワード設定時に非推奨警告を表示
- 警告は`md5_password_warnings`パラメータで無効化可能

#### VACUUMとANALYZE

- パーティションテーブルで子テーブルも自動処理するように変更
- 以前の動作は新しい`ONLY`オプションで可能

#### その他の変更

- `COPY FROM`でCSVファイル読み取り時に`\.`をEOFマーカーとして扱わない
- タイムゾーン略語の処理順序変更
- `AFTER`トリガーの実行ロール変更
- パーティション化テーブルでのunloggedテーブル作成の禁止

## 新機能とパフォーマンス改善

### クエリ最適化の強化

#### 自動最適化

- **セルフ結合の自動除去**: 不要なテーブル自己結合を自動的に最適化
- **OR句の配列変換**: OR句をANY配列に変換してインデックス処理を高速化
- **DISTINCT句の並び替え最適化**: ソートを回避するためのキー順序変更

#### 結合とグループ化の改善

- `GROUP BY`での機能依存列の自動除去
- `HAVING`句の`WHERE`句への押し下げ最適化
- 右セミ結合プランの使用許可
- パーティション賢い結合の拡張とメモリ使用量削減

### インデックスの機能強化

#### Btreeインデックス

- **スキップスキャン**: 複数列インデックスで2番目以降の列のみを等価参照するクエリでも使用可能
- 非btreeユニークインデックスのパーティションキーおよびマテリアライズドビューでの使用許可

#### その他のインデックス

- **GINインデックスの並列作成**: GINインデックス作成の並列処理対応
- 範囲型GiSTおよびbtreeインデックス構築時の値ソート最適化

### I/Oとパフォーマンス

#### 非同期I/Oサブシステム

- **新しい非同期I/Oサブシステム**: 複数の読み取りリクエストのキューイングが可能
- より効率的なシーケンシャルスキャン、ビットマップヒープスキャン、VACUUM処理
- `io_method`設定変数で制御、`io_combine_limit`と`io_max_combine_limit`で調整

#### 各種パフォーマンス改善

- 多数のリレーションにアクセスするクエリのロック性能向上
- ハッシュ結合と`GROUP BY`の性能向上とメモリ使用量削減
- VACUUMでの全可視ページの早期凍結処理
- `effective_io_concurrency`と`maintenance_io_concurrency`のデフォルト値を16に増加

### モニタリングの機能強化

#### 新しい統計情報

- **接続ログの詳細化**: `log_connections`の粒度向上と接続段階の継続時間レポート
- **VACUUM/ANALYZE時間追跡**: `pg_stat_all_tables`に各種処理時間の列を追加
- **I/O統計の拡張**: バイト単位でのI/O活動レポート、WAL I/O活動の追加

#### 新しいシステムビューと関数

- `pg_aios`: 非同期I/Oファイルハンドルの表示
- `pg_stat_get_backend_io()`: バックエンドごとのI/O統計
- `pg_stat_get_backend_wal()`: バックエンドごとのWAL統計

## データ型と関数の拡張

### 新しいデータ型機能

- **バーチャル生成列**: 読み取り時に値を生成するバーチャル生成列がデフォルトに
- **jsonb null値のキャスト**: jsonb nullをスカラー型にNULLとしてキャスト可能
- **Unicode完全ケースマッピング**: 条件付きおよびタイトルケースマッピングの改善

### 新しい関数

- `casefold()`: より洗練された大文字小文字を区別しない比較
- `array_sort()`: 配列の第一次元のソート
- `array_reverse()`: 配列の第一次元の逆順
- `reverse()`: byteaバイトの逆順
- `uuidv7()`: 時間的にソート可能なUUID v7の生成
- `crc32()`および`crc32c()`: CRC値の計算
- `gamma()`および`lgamma()`: ガンマ関数

### 制約の拡張

- **PRIMARY KEYとUNIQUE制約の非重複指定**: `WITHOUT OVERLAPS`による非重複制約
- **CHECKと外部キー制約の`NOT ENFORCED`**: 制約を非強制として指定可能
- **NOT NULL制約の名前付け**: `pg_constraint`での`NOT NULL`制約管理

## ユーティリティとツールの改善

### psqlの新機能

- **名前付きプリペアドステートメント**: `\parse`、`\bind_named`、`\close_prepared`コマンド
- **パイプラインクエリ**: 複数のパイプライン関連コマンドを追加
- **拡張表示モード**: 全リストコマンドで拡張表示モードの使用可能

### pg_dumpとpg_upgrade

- **統計情報の保持**: pg_upgradeでオプティマイザ統計の保持が可能
- **並列処理**: pg_upgradeでデータベースチェックの並列処理
- **スワップモード**: `--swap`オプションによる高速ディレクトリスワップ

### 新しいアプリケーション

- `pg_logicalinspect`: ロジカルスナップショット検査用の新しい拡張
- `pg_overexplain`: EXPLAINの詳細デバッグ情報追加

## 論理レプリケーション

### 生成列のレプリケーション

- 生成列の値を論理レプリケーションで複製可能
- `publish_generated_columns`オプションで制御

### ストリーミング設定

- `CREATE SUBSCRIPTION`のデフォルトストリーミングオプションが`parallel`に変更
- 2相コミット動作の変更をサブスクリプション単位で可能

### 競合ログ

- 論理レプリケーション適用時の競合をログ出力
- `pg_stat_subscription_stats`に新しい列を追加

## 認証とセキュリティの強化

### OAuth認証

- **新しいOAuth認証方式**: `pg_hba.conf`に`oauth`認証方式を追加
- libpqでOAuthオプション対応
- `--with-libcurl`コンパイル時フラグの追加

### SSL/TLS強化

- **TLSv1.3暗号スイート**: `ssl_tls13_ciphers`で複数指定可能
- **ECDH曲線の拡張**: `ssl_groups`で複数の曲線指定、X25519をデフォルトに追加
- **キャンセルリクエストキー**: 256ビットに拡張（プロトコルv3.2対応）

## 運用管理の改善

### 自動VACUUM

- `autovacuum_worker_slots`: 最大バックグラウンドワーカー数の指定
- `autovacuum_vacuum_max_threshold`: 固定デッドタプル数でのautovacuumトリガー
- `idle_replication_slot_timeout`: 非アクティブレプリケーションスロットの自動無効化

### レプリケーション

- `max_active_replication_origins`: アクティブレプリケーション起点の最大数制御
- レプリケーションスロットのフェイルオーバー対応

## 拡張とモジュール

### pgcrypto

- `sha256crypt`および`sha512crypt`アルゴリズムの追加
- CFBモード暗号化の追加
- `fips_mode()`関数とFIPSモード制御

### pg_stat_statements

- `CREATE TABLE AS`と`DECLARE`のクエリ追跡
- `SET`値のパラメータ化
- 並列処理統計の追加

### その他

- `postgres_fdw`: SCRAM認証のパススルー対応
- `file_fdw`: エラー処理オプションの追加
- `amcheck`: `gin_index_check()`関数の追加

## 開発者向けの変更

### アーキテクチャサポート

- **HPPA/PA-RISCサポート削除**: 32ビットアトミック操作が必須要件に
- **Python 3.6.8以上**: 最小サポートバージョンの引き上げ
- **OpenSSL 1.1.1以上**: 古いバージョンのサポート終了

### API/ABI変更

- `PG_MODULE_MAGIC_EXT`: 拡張機能の名前とバージョン報告
- カスタムEXPLAINオプションのサポート
- 累積統計APIの拡張機能での使用許可

### パフォーマンス最適化

- SIMD最適化によるJSON文字列処理の高速化
- x86 AVX-512命令によるCRC32C計算の高速化
- ARM NeonとSVE CPU組み込み関数によるbitカウント最適化

---

このリリースノートは2025年7月29日時点の情報に基づいており、最終リリースまでに変更される可能性があります。PostgreSQL 18は既存のワークロードのパフォーマンス向上と新機能による開発者体験の改善に重点を置いた重要なアップデートです。
