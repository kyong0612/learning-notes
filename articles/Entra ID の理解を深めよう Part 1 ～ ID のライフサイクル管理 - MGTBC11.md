---
title: "Entra ID の理解を深めよう Part 1 ～ ID のライフサイクル管理 - MGTBC11"
source: "https://www.youtube.com/watch?v=-Uc8qKe81rY"
author:
  - "[[日本マイクロソフト株式会社 公式チャンネル]]"
published: 2024-10-28
created: 2025-08-03
description: |
  本稿では、Microsoft Entra IDにおけるIDライフサイクル管理の重要性と、その自動化手法について詳説する。人事システムを起点としたIDプロビEisioningから、WorkdayやSuccessFactorsなどのクラウド人事システムとのネイティブ連携、さらにはSCIMやECMA Hostを介した各種アプリケーションへの同期まで、Entra IDが提供する包括的なソリューションを解説。また、ID作成後のオンボーディングプロセスを自動化する「Identity Governanceライフサイクルワークフロー」の機能や設定例も紹介し、入社から退職までの一連のID管理プロセスをいかに効率化し、セキュアに保つかを論じる。
tags:
  - "clippings"
  - "Entra ID"
  - "IDライフサイクル管理"
  - "プロビジョニング"
  - "Identity Governance"
  - "Azure"
---
# Entra ID の理解を深めよう Part 1 ～ IDのライフサイクル管理

## セッション概要

MicrosoftのAnnoによるEntra IDのIDライフサイクル管理に関するセッション（Management & Security Boot Camp 2024）の内容まとめ。

## 1. IDライフサイクル管理とは

### IDライフサイクルの流れ

入社から退職までの間に発生するIDの様々な変化を管理するプロセス：

- **IDの作成** - 新規入社時のアカウント作成
- **アクセス権の付与** - アプリケーションへのアクセス権限設定
- **IDの有効化・無効化** - アカウントの状態管理
- **人事異動対応** - 部署変更等に伴うアクセス権変更
- **退職処理** - アカウントの無効化と削除

### 監視と管理の重要性

これらの変化・変遷が適切かつ安全に行われているかを監視する仕組みが必要。これらをまとめて「ライフサイクル管理」と呼ぶ。

## 2. IDライフサイクル管理における課題

### 一般的な課題

- **IDプロビジョニング** - 人事システムを起点としたIDプロビジョニングの効率化
- **権限割当て** - 人事異動に伴う権限の割当ての効率化
- **プロセスレビュー** - これらのプロセスが適切に行われていることのレビュー

### 現状の問題点

多くの場合、これらの処理は人依存やマニュアル的な対応が多く、プロセスの信頼性を高める必要がある。

### 解決の方向性

**イベントドリブンなライフサイクルワークフロー**の実現：

- 入社、移動、退職といった会社員としての社内における様々なイベント
- それに伴ってIDのライフサイクルワークフローを自動的に実行
- ガバナンスが効いた状態でのプロセス管理

## 3. Entra ID プロビジョニングサービス

### アーキテクチャの概要

**Entra ID プロビジョニングサービス**がIDのハブとして機能：

- **データソース** - 人事システム（CSV、SQLサーバー等も含む）がIDの起点
- **プロビジョニングサービス** - 中央のハブとして機能
- **同期先** - Entra ID、オンプレミスのActive Directory、各種アプリケーション

### APIドリブンプロビジョニングエンドポイント

プロビジョニングサービスを呼び出すためのAPIが提供されている：

#### 2つのエンドポイント

1. **Entra ID用エンドポイント** - クラウド環境への同期
2. **オンプレミスActive Directory用エンドポイント** - オンプレミス環境への同期

#### 実装上の注意点

- **同期プログラムの作成が必須** - API呼び出し用のプログラムは自前で作成する必要
- **言語の自由度** - PowerShell、Python、Logic Apps等、API呼び出し可能な任意の言語で実装可能
- **データ同期方式** - 初期登録時は一括同期、その後は差分検知による同期

### Microsoft Entra ギャラリーでの提供

Enterprise Applicationsのギャラリーで2つのAPIが提供：

- 左側：Entra ID用API
- 右側：オンプレミスActive Directory用API

### 属性マッピング機能

- **オブジェクトアクション** - 作成、更新、削除のメソッド
- **属性マッピング** - 人事システムとEntra ID/ADの属性名の違いを吸収
- **管理の分離** - 同期プログラムとは独立して属性マッピングを管理
- **一元管理** - 人事システムが変わらなければプログラム変更不要

## 4. 同期フローの詳細

### Entra IDとの同期

1. 同期プログラムから"to Entra ID"エンドポイントを呼び出し
2. API内の属性マッピング設定を利用
3. プロビジョニングサービスに情報が流れる
4. Entra IDに情報が登録される

### オンプレミスとの同期

1. 同期プログラムからオンプレミス用エンドポイントを呼び出し
2. **プロビジョニングエージェント**のインストールが必要
3. Entra Cloud Syncと同じエージェントを使用
4. ハイブリッド環境では：
   - オンプレミスADにエージェント経由で同期
   - さらにCloud SyncまたはEntra Connectで Entra IDに同期

## 5. クラウド版人事システムとの連携

### ネイティブサポート対象

**Workday**と**SuccessFactors**のクラウド版人事システムには専用エンドポイントが提供：

#### Workday用API

- **Workday to Entra ID** - Entra IDへの同期
- **Workday to AD User Provisioning** - Active Directoryへの同期
- **Workday Writeback** - Entra IDからWorkdayへの書き戻し

#### Writeback機能の活用例

- 人事システムにメールアドレスがない場合
- プロビジョニング過程でメールアドレスを生成
- 生成されたメールアドレスをWriteback APIで人事システムに格納
- 双方向のデータ同期サイクルを実現

### SuccessFactors

Workdayと同様に3つのAPIが公開されている。

## 6. アプリケーションへの同期

### クラウドアプリケーションへの同期

#### 条件

**SCIMエンドポイントのサポート**が必要：

- SCIMエンドポイントがあれば、Entra IDから情報を取得して同期可能
- SCIMエンドポイントがない場合：
  - ベンダーにSCIMエンドポイント作成を依頼
  - 中間アプリケーションでSCIMエンドポイントを実装

#### ギャラリーでの提供

Microsoft Entraギャラリーで同期マーク（絡み合ったマーク）があるアプリケーション：

- Atlassian Cloud
- AWS Single Sign-On
- Box
- Cisco WebEx
- その他多数

このマークがあれば専用プログラムが用意されており、設定のみで同期可能。

### オンプレミスアプリケーションへの同期

#### ECMA Hostの活用

オンプレミス用同期の仕組みとして**ECMA Host**が提供：

#### 利用可能なコネクター

- **SCIMコネクター**
- **SAP ECCコネクター**
- **RESTエンドポイント用コネクター**
- **PowerShellコネクター**
- **SQLサーバーコネクター**
- **LDAPコネクター**
- **カスタムコネクター** - 適切なコネクターがない場合

#### 同期フロー

1. Entra IDからECMA Hostに同期情報が入力
2. 適切なコネクター（例：SQLサーバーコネクター）を使用
3. SQLサーバーで情報を持つアプリケーションに同期

#### 推奨アプローチ

- レガシーシステムはSQLサーバーやLDAPコネクターで対応
- 汎用的な対応にはPowerShellやRESTエンドポイントコネクターを活用
- オンプレミスでSCIM対応のアプリケーションは少ないため、その他のコネクターが実用的

## 7. IDライフサイクルワークフロー

### ID作成以後の課題

IDの同期だけでは不十分。入社直後には以下のような作業が必要：

- 社内事務処理の案内
- メール送信
- 各種申請サイトへの誘導
- Teams チャンネルへの参加
- その他のオンボーディング作業

### 入社イベントの分類

入社イベントは実際には3つのフェーズに分かれる：

#### 1. 入社前の作業

- **ユーザーアカウント作成**（無効状態で作成）
- **オンボード用メール**の上長への送信
- **初期パスワード生成**と上長への送付
- **チームメンバーへの新入社員案内**

#### 2. 入社当日の作業

- **ユーザーアカウントの有効化**
- **部署グループへの追加**
- **ウェルカムメールの送信**
- **Teamsチャンネルへの参加**

#### 3. 入社後の継続作業

- その他のオンボーディングプロセス

### スケジューリングの重要性

各作業を入社前の何日前に実行するかといったスケジューリングが必要。

## 8. Entra Identity Governance

### ライセンスと機能

**別ライセンス**として提供される**Entra Identity Governance**にライフサイクルワークフロー機能が含まれる。

### テンプレートの提供

入社、移動、退職に伴って発生する様々なワークフローのテンプレートが用意されている：

- **参加するユーザー**（入社）
- **移動するユーザー**
- **やめるユーザー**（退職）

### Logic Appsとの連携

ワークフロー作成には**Azure Logic Apps**を使用：

- 承認プロセス
- メール送信
- その他の自動化処理を構築

### カスタマイズ機能

テンプレートに自社特有のプロセスがない場合、Logic Appsを使って独自プロセスを作成可能。

## 9. 実際のワークフロー設定例

### 採用前従業員のオンボードワークフロー

実際の画面での設定例：

#### タイミング設定

- **Employee Hire Date**の7日前に実行
- 入社準備の事前設定

#### 部門別条件設定

- **条件式**を使用して部門ごとの異なるプロセスに対応
- 営業部、IT部門、マーケティング部門それぞれの個別プロセス

#### タスクの例

- **TAP（Temporary Access Passcode）**の生成
- 一時パスワードをマネージャーに送付
- マネージャーが入社当日に初期パスワードとして提供

#### 拡張性

- **タスクの追加**ボタンでより複雑な処理を設計可能
- カスタマイズによる柔軟な対応

## 10. まとめ

### 2つの主要な仕組み

#### 1. Microsoft Entra ID プロビジョニングサービス

- 人事システムを起点としたID生成の仕組み
- **必要ライセンス**: Entra P1以上

#### 2. Identity Governance ライフサイクルワークフロー

- ID作成後の入社準備自動化機能
- **必要ライセンス**: Identity Governance（独立ライセンス）

### 目標

入社から退職までの様々なプロセスの自動化を設計し、人手を介さずに間違いが発生しないワークフローによる自動処理を実現することで、組織のIDライフサイクル管理を効率化し、セキュリティを向上させる。
