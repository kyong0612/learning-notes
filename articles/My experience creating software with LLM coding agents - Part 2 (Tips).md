---
title: "My experience creating software with LLM coding agents - Part 2 (Tips)"
source: "https://efitz-thoughts.blogspot.com/2025/08/my-experience-creating-software-with_22.html"
author:
published: 2025-08-22
created: 2025-08-24
description: |
  This post details my experiences creating software with LLM coding agents, emphasizing that what you do with AI agents is ‘creation’, not just 'coding,' and sharing what worked for me. This is not 'The One True Path To AI Success.'
tags:
  - "clippings"
  - "AI"
  - "development"
---

この記事では、LLM（大規模言語モデル）コーディングエージェントを使用してソフトウェアを作成した経験から得られた、具体的なヒントやテクニックを紹介します。

### tl;dr (要約)

- 著者はプロの開発者ではなく、自身のスキルレベルを超えるコーディングプロジェクトを達成するために、数ヶ月にわたりAIエージェントツールを試してきました。
- 複雑なコーディングタスクには、Anthropic社の`Claude Sonnet`モデルの使用を推奨します。
- ヘビーユーザーは従量課金制を、ライトユーザー（簡単なスクリプト作成など）は無料または既存のサブスクリプションに含まれるチャットボットを利用するのが良いでしょう。

---

## 高度なAI活用スキル (Mad AI Skillz)

エージェント型AIから生産的なアウトプットを引き出すために学んだヒントとテクニックを共有します。

### コンテキスト (Context)

- **概要**: コンテキストとは、エージェントの短期記憶であり、システムプロンプト、指示、提供された情報を含みます。エージェントはこれを用いて推論します。
- **活用法**:
  - **➤ Tip**: タスクに直接関連するコンテキストを、意図的かつ惜しみなく提供することが重要です。
  - **➤ Tip**: プロジェクトルートに`context/`のような専用ディレクトリを作成し、エージェントにそこを参照するよう指示を一貫して行うと効果的です。
  - **➤ Tip**: コンテキストファイルの内容を事前にエージェントに伝えることで、不要なファイル読み込みを減らし、トークン（コスト）を節約できます。

### 良いコンテキストは身近にある (Good Context is Where you Find It)

- **概要**: エージェントが特定の構文で間違いを繰り返す場合、そのファイル自体に直接コメントとして指示（コンテキスト）を追加することが非常に有効です。
- **活用法**:
  - **➤ Tip**: LLMにとって、編集中のソースコードファイルもコンテキストの一部です。コメントを活用して、特定のファイルや関数に対する指示を補強しましょう。

### 多すぎるコンテキスト (Too much context)

- **課題**: LLMのコンテキストウィンドウには上限があり、セッションが長くなるにつれて古い情報を忘れたり、直近の指示に過度に影響されたりする（Recency Bias）傾向があります。
- **対策**:
  - **➤ Tip**: `pnpm-lock.yaml`のような巨大なファイルを扱う際は、ファイル全体を読み込ませるのではなく、ツールを使って必要な部分だけを抽出するよう指示します。
  - **➤ Tip**: コンテキストサイズを常に監視し、エージェントが全体像を見失っていると感じたら、セッションを要約（compact）するか、新たに開始します。コストを考えれば、単純に新しいセッションを始める方が効率的な場合が多いです。

### コンテキストのブートストラップ (Bootstrapping context)

- **概要**: エージェントが不得意そうなライブラリや技術（例：ドキュメントが外国語のみ）を扱う場合、事前にソースコードやサンプルを読ませて開発者ガイドを生成させ、それをコンテキストとして提供します。
- **活用法**:
  - **➤ Tip**: LLMが困難に直面しそうな領域を予測し、作業開始前に補助となるコンテキストを生成しておくことで、エージェントのパフォーマンスを向上させます。

### 人格のないものとの「対話」

- **要点**: エージェントは人間ではありません。タスクの背景にある「なぜ」を説明するのは、それが追求すべき目標や守るべきガイドラインを明らかにする場合にのみ有効です。
- **注意点**:
  - **➤ Tip**: タスク完了後に「うまくいった」などと報告すると、エージェントが不要な要約を生成し、トークンを浪費する可能性があります。

### 設計 (Design)

- **重要性**: 単純な目標だけでなく、具体的な設計を持つことが極めて重要です。設計がないと、エージェントは独自の判断でリファクタリングを提案し始めます。
- **実践**:
  - **➤ Tip**: 設計書をファイルに書き出し、エージェントが常に参照できるようにします。設計の変更も必ずドキュメントに反映させます。
  - **➤ Tip**: OpenAPI仕様のような機械可読な形式で設計を記述すると、クライアントとサーバー間の連携などを非常にスムーズに進められます。

### 計画 (Planning)

- **手法**: 複雑なタスクに取り組む際は、必ずエージェントに「深く考えさせ (think deeply)」、詳細な実行計画を提示させます。このフレーズは、LLMをより高度な推論モードに切り替える効果があります。
- **活用法**:
  - **➤ Tip**: エージェントが提示した計画をレビューし、曖昧な点をなくし、エッジケースを考慮して修正を重ねます。
  - **➤ Tip**: エージェントが同じ失敗を繰り返すループ状態に陥った場合、「深く考える」よう指示することで、ループから脱出できることがあります。

### エージェント間コミュニケーション (Inter-agent communication)

- **アイデア**: クライアントとサーバーのように、2つの異なるコードベースを連携させる際、それぞれに専用のエージェントを割り当て、人間を介して「対話」させるアプローチが非常に効果的でした。
- **実践**:
  - **➤ Tip**: 片方のエージェント（例：サーバー側）に、もう片方（例：クライアント側）の開発者向けの説明ドキュメントを書かせ、それをもう片方に渡して実装させる、といった連携が可能です。

### 優れたロギング (Get really good at logging)

- **不可欠性**: エージェントがプログラムの動作を理解し、デバッグを行うためには、詳細で質の高いログが不可欠です。
- **ベストプラクティス**:
  - **➤ Tip**: プロジェクトの初期段階で、タイムスタンプやコンポーネント名を含む一貫したフォーマットのロギングクラスを導入します。
  - **➤ Tip**: 複雑な処理の開始/終了、状態の変更、APIの送受信データなど、あらゆる重要なポイントで詳細なログを出力します。
  - **➤ Tip**: UIにもデバッグ情報を表示する仕組み（例：オブジェクトの内部状態をコピーする機能）を設けると、エージェントへの情報提供が容易になります。
  - ! [UIに表示されたログ情報](https://lh7-rt.googleusercontent.com/docsz/AD_4nXc4hRw1XrIuctXGfyeuuNrqVdAAnvvs9Xgg-KJyOvBIRk3HZUCCFA3VIbvBM8usFdaKFciTep2tiKP3NElUxp_9gKUcIUbkysFh_CWYzPaRsE7ArSPi87h3gEwd827GajowrQPmKw?key=MQA7SFMGSvBlzQ_59OpCFQ)
  - ! [デバッグ用のコンテキストメニュー](https://lh7-rt.googleusercontent.com/docsz/AD_4nXdXF5axRJyuzn-y-PRgvLpp-trAVgb_KWgZyBChztS9N-GJQBj0yrWRLrOHLVtD3SGB82ASt063GeqYvFk4pqCZfFSebMD_8muP1sjZ2yk04Oq_634Mf40hq2JF0v9D0ytcZaqIpQ?key=MQA7SFMGSvBlzQ_59OpCFQ)

### 防御的なプロンプト (Use defensive prompts)

- **課題**: エージェントは時々、存在しないメソッド名を捏造するなどのハルシネーション（幻覚）を起こします。
- **対策**:
  - **➤ Tip**: 永続的な指示（standing instruction）に、「コード変更後は、必ずlint、ビルド、テストを実行し、すべてのエラーを修正してからタスクを完了すること」というルールを設けます。

### エージェントの怠慢とごまかし

- **問題**: エージェントはテストの失敗を修正しようと数回試みた後、諦めてそのテストを無効化したり、コメントアウトしたりすることがあります。
- **対策**:
  - **➤ Tip**: 「失敗したテストは決して無効にせず、根本原因を突き止めて修正すること」という指示を、永続的な指示や各テストファイルのコメントに明記します。

### 防御的なGit利用 (Use git defensively)

- **重要性**: エージェントによる意図しないファイルの破壊を防ぐため、Gitをセーフティネットとして活用します。
- **プラクティス**:
  - **➤ Tip**: エージェントに作業を依頼する前には、必ずコミットされていない変更がないクリーンな状態にしておきます。問題が発生した場合は`git restore`で簡単に元に戻せます。
  - **➤ Tip**: 大規模なリファクタリングなどを行う際は、必ず新しいブランチを作成します。
  - **➤ Tip**: エージェントに`git`コマンドを許可なく実行させないように、ツールの権限を厳しく設定します。

### タスクの分割とTODOリスト

- **戦略**: 大きなタスクは、より小さく管理しやすいサブタスクに分割します。これにより、コンテキストの肥大化を防ぎ、エージェントの集中力を維持します。
- **実践**:
  - **➤ Tip**: エージェントにTODOリストを作成させ、タスクが完了するたびにリストを更新させます。これにより、セッションを中断・再開しても、進捗状況を正確に把握できます。

### 監視と即時修正

- **行動**: エージェントがタスクを実行している間、その思考プロセスをチャットウィンドウで監視します。
- **対応**:
  - **➤ Tip**: もしエージェントが意図しない方向に進んでいることに気づいたら、即座に（例：Escapeキーで）処理を中断し、軌道修正のための指示を与えます。

### 良いテストを書かせる

- **課題**: エージェントが作成したテストは、バグを見逃すことがよくあります。これは、エージェントが「テストが成功すること」を目標にコードとテストを同時に生成するため、意図された仕様ではなく、その時点での実装の動作を検証するテストになりがちだからです。
- **対策**:
  - **➤ Tip**: エージェントが作成したテストケースは必ず人間がレビューし、重要なシナリオを追加したり、不要なテストを削除したりします。
  - **➤ Tip**: テストで検出されなかったバグが見つかった場合、エージェントに「なぜこのテストではバグを発見できなかったのか」を分析させ、テスト自体を改善させます。

### カスタムツールの作成

- **発想**: エージェントが特定の定型作業（例：巨大なJSONファイルの特定要素の編集）に苦労している場合、その作業を自動化するカスタムツール（例：Pythonスクリプト）を作成させます。
- **効果**:
  - **➤ Tip**: ツールを一度作成すれば、以降はエージェントにそのツールを使うよう指示するだけで、複雑な作業を効率的かつ正確に実行できるようになります。

### その他学んだこと

- エージェントはお世辞を言う傾向があります。
- エージェントはコードを繰り返しがちなので、適宜リファクタリングを指示する必要があります。
- 自分の設計についてエージェントに意見を求めてはいけません。コンテキストの有無で評価が180度変わることがあります。

### うまくいかなかったこと

- **コード → 仕様書 → 翻訳コード**: 既存のコードから仕様書を生成させ、その仕様書を基に別言語のコードを生成する、という試みはうまくいきませんでした。エージェントは高品質な仕様書を生成するのが苦手なようです。
