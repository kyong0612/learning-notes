# How Nubank refactors millions of lines of code to improve engineering efficiency with Devin

ref: <https://devin.ai/customers/nubank>

## Devinを活用したNubankのコードリファクタリングとエンジニアリング効率向上

**概要**

* **エンジニアリング時間効率:** 8倍向上
* **コスト削減:** 20倍以上

Nubankの最重要プロジェクト（2023-2024）の一つは、8年間運用された数百万行のコードを持つコアETL（Extract, Transform, Load）モノリスをサブモジュールに移行することでした。この大規模なリファクタリングは、当初1000人以上のエンジニアが反復的な作業を分担し、数年を要する計画でした。

しかし、AIコーディングアシスタント「Devin」の導入により状況は一変しました。エンジニアはDevinに移行作業を委任できるようになり、結果としてエンジニアリング時間を12倍節約し、20倍以上のコスト削減を達成しました。データ、回収、リスクなどのビジネスユニットは、数ヶ月または数年かかると予想された移行を数週間で検証・完了させました。

**課題**

Nubankは、中央集権型のETLアーキテクチャを採用していました。このモノリスアーキテクチャは、急成長期には開発者の自律性と柔軟性を支えましたが、8年後には顧客数の増加、地理的拡大、製品の多様化により、無数の相互依存関係を持つ巨大で複雑なETLとなり、スケーリングの限界に達していました。

* **問題点:**
  * ビジネスクリティカルなデータ変換の実行時間が長期化。
  * 依存関係の連鎖が最大70階層に達する。
  * 責任分界点が不明確。
  * ETLがスケーリングの主要なボトルネックに。

**結論:** 600万行を超えるモノリシックなETLリポジトリを、より小さく柔軟なサブモジュールに分割することが急務と判断されました。

この移行作業は、エンジニアが嫌う単調で反復的な作業に満ちていました。各データクラス実装を新しいアーキテクチャに移行し、インポートを正確に追跡し、複数の繊細なリファクタリングステップを実行し、無数のエッジケースに対応することは、非常に退屈な作業でした。Nubankの規模では、1000人以上のエンジニアが約10万のデータクラス実装を18ヶ月かけて移行する必要がありました。

大規模な移行とモダナイゼーションは、エンジニアリングリソースが限られる中で、非常に高価で時間のかかるプロジェクトとなり、顧客のためのより良い製品開発という本来のミッションからエンジニアを遠ざけてしまいます。

**意思決定：サブタスクを並行処理するためのDevinの活用**

プロジェクト開始当初（2023年）、Nubankはエンジニアによる手作業でのコード変更に頼るしかありませんでした。データクラスの移行は、多くのバリエーション、エッジケース、アドホックな意思決定を伴う非常に裁量的なタスクであり、スクリプト化するには複雑すぎましたが、手作業で行うには量が多すぎました。

Devinの登場後、Nubankはエンジニアリング時間を大幅に削減してリファクタリングを加速する明確な機会を見出しました。移行や大規模なリファクタリングタスクは、Devinにとって理想的なプロジェクトです。少量の初期投資でDevinにサブタスクへのアプローチ方法を教えれば、Devinは自律的に移行を完了できます。人間はプロジェクト管理とDevinの変更承認のみを担当します。

**ソリューション：カスタムETL移行Devin**

この規模と多様性を持つタスクは、ファインチューニングの絶好の機会でした。Nubankチームは、エンジニアが手動で行った以前の移行例を収集し、一部をDevinのファインチューニングに使用しました。残りはベンチマーク評価セットの作成に使用されました。

* **ファインチューニングの結果:**
  * Devinのタスク完了スコアが**2倍**に向上。
  * タスク速度が**4倍**向上（サブタスクあたり約40分から10分に短縮）。

これにより、移行全体のコストと時間が大幅に削減され、企業は新規ビジネスや価値創造により多くのエネルギーを注ぐことができるようになりました。

Devinは、移行の最も一般的で機械的なコンポーネントに使用する古典的なツールやスクリプトを自身で構築することで、自身の速度向上にも貢献しました。例えば、ファイルパスに基づいてデータクラスの国拡張子（'br'、'co'、'mx'のいずれか）を検出するプロセスは、Devinのスクリプトによって自動的に単一ステップの実行可能ファイルに変換され、数万のサブタスク全体で大幅な改善が蓄積されました。

Devinの学習には複利効果もあります。最初の数週間は、未解決のエラーやDevinが解決方法を確信できない小さな問題が見られましたが、より多くの例を見てタスクに慣れるにつれて、Devinは袋小路を避け、以前に見たエラーやエッジケースに対するより速い解決策を見つけるようになりました。人間エンジニアと同様に、Devinが移行作業に取り組む日々の中で、明らかな速度と信頼性の向上が観察されました。

**結果：8～12倍速い移行、エンジニアの負担軽減、移行コストの20倍削減**

> 「Devinは、移行に必要なエンジニアリング時間を削減する簡単な方法を提供してくれました。それはより安定しており、人的エラーが発生しにくい方法でした。エンジニアが複数のファイルを扱って移行タスク全体を100%完了させる必要はなく、Devinの変更を確認し、軽微な調整を行ってからPRをマージするだけで済みました」
>
> Jose Carlos Castro, Senior Product Manager

* **8～12倍の効率向上:** データクラス移行タスクを完了するために通常必要なエンジニアリング時間と、同じタスクに対するDevinの作業のプロンプトとレビューに費やされた総エンジニアリング時間を比較して算出。
* **Devinに委任された移行範囲における20倍以上のコスト削減:** Devinの実行コストと、エンジニアがそのタスクを完了する場合の時間単価を比較して算出。この大幅な削減は、タスク実行速度と、人間のエンジニアリング時間に対するDevinの費用対効果によって大きく推進されており、プロジェクト全体を予定より数ヶ月早く完了させることで得られる価値は考慮されていません。
* **Nubankエンジニアにとって、嫌われる移行タスクの削減。**

**(参考画像)**

* 記事冒頭の画像: ![Vimeo](https://devin.ai/assets/images/customers_feedback_hero.jpg)
  * *(注意: この画像はビデオへのリンクを含んでいますが、マークダウンの制約上、静止画として表示されます)*

**企業情報**

* **Nubank:** ラテンアメリカ最大のフィンテック銀行。2013年の設立以来、ブラジル、メキシコ、コロンビアで1億1000万人以上の顧客にサービスを提供。
* **業種:** フィンテック
* **ウェブサイト:** [https://international.nubank.com.br/about/](https://international.nubank.com.br/about/)
