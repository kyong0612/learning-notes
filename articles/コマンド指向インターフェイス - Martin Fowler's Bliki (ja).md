---
title: "コマンド指向インターフェイス - Martin Fowler's Bliki (ja)"
source: "https://bliki-ja.github.io/CommandOrientedInterface"
author:
  - Martin Fowler
  - 翻訳: bliki-ja
published: 2003-11-23
created: 2025-10-26
description: |
  コマンド指向インターフェイスとメソッド指向インターフェイスの違いと、それぞれの特徴を解説。操作毎にコマンドクラスを作成するアプローチの利点（トランザクション、ロギング、キューイング、キャッシング）と複雑さのトレードオフについて説明。
tags:
  - API design
  - design-patterns
  - command-pattern
  - interface-design
  - architecture
---

## 概要

モジュールのインターフェイス設計において、従来のメソッド指向インターフェイスとコマンド指向インターフェイスの違いと、それぞれの利点・欠点を解説した記事。

## メソッド指向インターフェイス vs コマンド指向インターフェイス

### メソッド指向インターフェイス（従来のアプローチ）

プロシージャやオブジェクトメソッドを使う一般的な方法：

```ruby
aBillingService.calculateCharges(aContract)
```

### コマンド指向インターフェイス

操作毎にコマンドクラスが存在するアプローチ：

```ruby
CalculateChargeCommand.new(aContract).run()
```

または、コマンドを実行するオブジェクトを別に用意する方法：

```ruby
aCommandExecutor.run(CalculateChargeCommand.new(aContract))
```

Strutsなどのフレームワークにおけるアクションクラスがこれに相当します。

## コマンド指向インターフェイスの複雑さ

メソッド指向インターフェイスと比較して、コマンド指向インターフェイスは以下の点で複雑：

- コマンドをインスタンス化する必要がある
- それから実行する手順を踏まなければならない
- 単にメソッドを呼び出すよりも手順が多い

このため、コマンド指向インターフェイスを好む開発者でも、以下のような大きなインターフェイスにのみ適用することが一般的：

- サービス層
- サーバサイドロジック
- 主要サブシステムのインターフェイス

## コマンド指向インターフェイスの利点

### 1. 振る舞いの追加が容易

コマンド実行クラスをデコレートすることで、コマンドに振る舞いを容易に追加可能：

- トランザクション操作
- ロギング
- その他の横断的関心事

### 2. キューイングとネットワーク経由の処理

- コマンドクラスはキューを形成できる
- コマンドクラスやコマンド内のデータがシリアライズされていれば、ネットワーク経由でやり取り可能

### 3. キャッシング

コマンドの実行結果を、コマンド名と引数をキーとしてキャッシュ可能。

## よくある懸念事項

### ロジックの重複問題

コマンドクラス内のロジックが重複してしまうという不満がよく聞かれます。

#### 原因分析

- コマンドクラスがロジックを多く含んだTransaction Scriptsである場合に発生
- これはコマンド指向固有の問題ではなく、Transaction Scriptsの一般的な問題
- 適量よりも多くのコードをコマンド内に入れてしまうと、コマンド指向がこれを助長させる可能性

### インターフェイスとしての設計

重要なポイントは、「インターフェイス」という言葉の意味：

- コマンドクラスを使うかどうかは、**クライアントのインターフェイスをどうするか**という問題
- **クラス内の実装をどうするか**ではない

#### 推奨アプローチ

- 実行メソッドが単一行で、他のメソッドを呼び出すだけというコマンドクラスで十分
- これにより、コマンド指向の恩恵を十分に受けられる
- コマンドクラスからはロジックを排除する
- コマンドクラスにはごく少量のコードのみを含める

## 戻り値の扱い

### 一般的な戻り値型

ジェネリックな実行メソッドは、ObjectやCommandResultのような一般的な戻り値を必要とします。

### より具体的な戻り値が必要な場合の解決策

#### 方法1: 命名規則を決めて結果クラスを作る

- 例：CalculateChargeCommandからはCalculateChargeResultクラスが返る

#### 方法2: コマンドクラス内に結果をストアさせる

- コマンドを実行させた後、オブジェクトに結果を問い合わせる
- 後から結果を取得するアプローチ

## まとめ

コマンド指向インターフェイスは、以下のような場合に有効：

- 大規模なインターフェイス設計
- トランザクション、ロギング、キャッシングなどの横断的関心事が必要な場合
- 非同期処理やキューイングが必要な場合
- ネットワーク経由での処理が必要な場合

一方で、実装の複雑さというトレードオフがあるため、適用範囲を慎重に選択する必要があります。重要なのは、コマンドクラスをインターフェイスとして使い、ロジックは別の場所に分離することです。
