---
title: "Full-Stack TSでのマルチプロダクト基盤開発 / TSKaigi Hokuriku 2025"
source: "https://speakerdeck.com/soarteclab/tskaigi-hokuriku-2025?slide=60"
author:
  - "Shodai Suzuki"
published: 2025-11-22
created: 2025-11-24
description: |
  MOSH Inc.におけるFull-Stack TypeScriptを使ったマルチプロダクト基盤開発の実践について、TSKaigi Hokuriku 2025で発表された内容。フルサイクル開発の課題解決のため、共通サービスプラットフォームとコアプラットフォームをFull-Stack TSで構築し、モノレポとOpenAPIスキーマ駆動開発を活用したアプローチを紹介。
tags:
  - "TypeScript"
  - "Platform Engineering"
  - "モノレポ"
  - "フルサイクル開発"
  - "マルチプロダクト"
  - "TSKaigi"
---

# Full-Stack TSでのマルチプロダクト基盤開発

## 概要

本資料は、MOSH Inc.がFull-Stack TypeScriptを使用してマルチプロダクト基盤を開発する実践について、TSKaigi Hokuriku 2025で発表された内容です。フルサイクル開発の課題を解決するため、共通サービスプラットフォームとコアプラットフォームを構築し、モノレポとOpenAPIスキーマ駆動開発を活用したアプローチを紹介しています。

## 背景：MOSHのビジネスとプロダクト

### MOSHのビジネス

MOSHは、クリエイターが様々なコンテンツを提供するプラットフォームです。主なカテゴリとして以下があります：

- ヨガ・フィットネス
- ヘルス・ウェルネス
- 育児・子育て
- 養成講座・スクール
- オンラインサロン・コミュニティ
- メイク・ビューティー

### マルチプロダクト開発

複数のプロダクトを同時に開発・運用しており、Full-Stack TSとフルサイクル開発を実践しています。

## フルサイクル開発

フルサイクル開発とは、プロダクト仕様から開発、運用、サポートまでのライフサイクル全体を一貫して担う開発手法です。

### フルサイクル開発の価値

1. **ドメイン理解の深化**: プロダクト仕様から運用まで一貫して担当することで、ドメイン理解を深め、最適なソリューションを採用できる
2. **チームの自律性向上**: チームの自律性を高めてスループットを向上させる
3. **組織全体の知見活用**: チーム外とのコミュニケーションを通じて、組織全体の知見を活用する

### ドメイン理解の重要性

「チーム全員が顧客とかかわりを持たなければならない。これこそ、チームが顧客の気持ちを理解する唯一の方法だ。」（「小さなチーム、大きな仕事」より）

顧客と作り手の間に人が多いほど、顧客の声は歪んだり失われたりしていくため、直接的な顧客との関わりが重要です。

## フルサイクル開発における課題

### 課題①：運用コスト増加によるスピード低下

ドメイン理解への集中と同時に、開発と比例する運用コスト増加によるスピード低下がフルサイクル開発の現実的な課題です。

**生涯コストの現実**:

- ソフトウェアの生涯コストの内、少なくとも60～75%は初期開発後に発生
- その約4分の1は、移行やその他の適応メンテナンスにのみ費やされる

### 課題②：複数チームでの重複・繰り返し

複数チームで統一したい振る舞いや機能の重複・繰り返しが発生します。

## ソリューション：Full-Stack TSでの基盤開発

### なぜ基盤開発にTypeScriptを採用するのか

#### 期待される効果

1. **FE/BE開発で得たFull-Stack TSの生産性を再現**: 既存のフロントエンド・バックエンド開発で得た生産性を基盤開発でも再現したい
2. **AIとの親和性**: 静的型付けにより、AIツールとの連携が容易
3. **連携システム間の型定義共有**: 同じ言語なのでコンテキストが分断されず、目的単位で開発可能

#### 懸念事項

1. 共通基盤としての要求に応えられるか
2. 事例が少ない中でトラブルシューティング可能か

### 共通基盤の分類

Platform Engineeringの観点から、共通基盤は2つに分類されます：

1. **共通サービスプラットフォーム（Integration/Shared Services Platforms）**: アプリケーションの共通基盤
2. **コアプラットフォーム（core/infrastructure platform）**: インフラストラクチャレベルの基盤

## ①共通サービスプラットフォーム

### 共通サービスプラットフォームの例

- 決済
- 通知
- メッセージ配信
- クリエイタープラン管理
- 権限
- アカウント管理

### 共通サービスプラットフォームの価値

1. **横断するドメイン知識の深化**: 複数のプロダクトにまたがるドメイン知識を深める
2. **一貫したユーザー体験**: 統一された機能により、一貫したユーザー体験を提供
3. **基盤同士のデータ連携による価値作り**: 複数の基盤を連携させることで、新たな価値を創出
4. **各プロダクト間の共通処理を集約**: 重複を排除し、効率的な開発を実現
5. **技術的複雑性のカプセル化**: 複雑な技術的実装を基盤内に隠蔽

### OpenAPIでのスキーマ駆動開発

各基盤のインターフェースをOpenAPIで定義し、client/serverのソースコードを自動生成することで、以下の課題を解決します：

- **基盤同士のclient/server間の不整合を解消**: OpenAPI定義から自動生成することで、型の整合性を保証
- **依存関係の明示**: 使用するpackageにclientを出力し、依存先を明示
- **API定義変更と依存するclientの更新タイミングを強制**: インテグレーションと依存関係管理の問題に対応

#### 使用技術スタック

- **OpenAPI**: API定義
- **Orval**: OpenAPIからTypeScriptの型とクライアントコードを自動生成
- **zod**: ランタイム型検証
- **msw**: APIモック（テスト用）
- **fetch API**: HTTP通信

### 技術的複雑性のカプセル化の実例

#### 通知基盤

- **スケール**: 直近3ヶ月の1日あたりの最高値は40,000件（全ての共通化が完了したら100,000件想定）
- **スパイク**: 直近3ヶ月の最もスパイクした瞬間は秒間105件

#### メッセージ配信基盤

- **アーキテクチャ**: イベント駆動アーキテクチャ
- **インフラ**: AWS CDK、Lambda
- **ビルド**: Bun buildでLambda targetをNode.jsでビルド
- **Dockerfile**: AWS CDKで管理

### 共通サービスプラットフォームの価値創造

横断するドメイン知識を深めることで、共通サービスプラットフォーム自体がプロダクト価値とユーザー体験を作り出します。

## ②コアプラットフォーム

### Platform Engineeringのレバレッジ

Platform Engineeringの価値の中核であるレバレッジは、以下の2つです：

1. **ビジネス価値を作成する際の生産性を向上させること**
2. **チーム間の重複作業を排除することでエンジニアリング組織を効率化すること**

### レバレッジの実現方法

#### ①ビジネス価値を作成する際の生産性向上

**増幅する運用コストの最小化**:

- セキュリティパッチの適用に必要なアップグレード
- ソフトウェアの再テスト
- 基盤となる依存関係の新しいバージョンへの移行

これらに多くのエンジニアリング時間がかかるため、プラットフォームで集約することで運用コストを最小化します。

#### ②チーム間の重複作業の排除

**コアプラットフォームの重複作業例**:

- ライブラリのバージョンアップ
- Linter / Formatter / tsconfigのルール追加・変更
- CI/CD
- AIコンテキスト
- コードガイドライン
- UIコンポーネントの追加・変更

### 依存関係の管理

「オープンソフトウェア(OSS)モデルが新たな要因向けて発展と拡大を続け、また人気がある様々なプロジェクトの依存関係グラフが時間の経過とともに拡大を続けていくのに伴い、おそらくは依存関係の管理が、ソフトウェアエンジニアリングポリシー内における最重要問題となっていく。」（「Googleのソフトウェアエンジニアリング」より）

### 新たな課題：依存解決とインテグレーション

共通サービスプラットフォームを含めた複数プロダクトの依存解決とインテグレーションが新たな課題として浮上しました。

### モノレポの採用

「単一のリポジトリー(モノリポ)を持つ大規模組織は、ソースコントロールのポリシーを用いて、別々のリポジトリーを使う場合と比べ圧倒的に先までスケールアップ可能であり、それがGoogleのアプローチである。」（「Googleのソフトウェアエンジニアリング」より）

#### モノレポと技術選定の背景

1. **機能開発は既にFull-Stack TS**: 旧システムではバックエンドがPython、フロントエンドがTSだったが、技術スタックを増やすことで認知負荷を上げたくない
2. **TS周辺のモノレポ、複数プロダクト連携を支えるエコシステムが充実**: TypeScriptエコシステムが成熟している

#### モノレポを支えるTSエコシステム

- **TypeScript**: 型システム
- **Bun**: ランタイム、パッケージマネージャー、ビルドツール
- **server**: サーバーサイド開発
- **build**: ビルドツール
- **test**: テストランナー
- **package workspace**: パッケージ管理
- **Biome**: Linter/Formatter
- **commitlint**: コミットメッセージの検証

#### Bunの特徴

- **高速なtestランナー**: テスト実行が高速
- **シングルバイナリへのビルドで実行ファイルのサイズ圧縮**: デプロイサイズを削減
- **workspace内の厳格なライブラリ依存関係管理**: 依存関係の整合性を保証
- **どうしても行き詰まったらNode.jsに移行可能**: 柔軟性を確保

### 具体的な構成

#### rootディレクトリ

Bun workspaceでのパッケージ分割により、3種類のファイル群を管理：

1. **package間で共有するファイル**: 共通設定など
2. **各packageで必要に応じてカスタマイズするファイル**: 個別の設定
3. **各packageで必ず用意するファイルのベースファイル**: テンプレート

`package.json`での`workspaces`指定により、パッケージ間の依存関係を管理します。

#### 各package

- **アプリケーション共通基盤の責務ごとに分割**: 機能ごとにパッケージを分割
- **数個の設定ファイル + srcディレクトリのミニマム構成でクイックスタート**: 最小限の設定で開始可能
- **rootの設定を継承する事でシンプルな設定ファイル**: 設定の重複を排除
- **最悪パッケージ毎リニューアルできる**: 柔軟性を確保

主な設定ファイル:

- `biome.json`: Linter/Formatter設定
- `tsconfig.json`: TypeScript設定
- `packages`ディレクトリ構成

#### 横断scripts

`package.json`の`scripts`とworkspace横断で一括実行する処理を`scripts`で管理します。コマンド名はpackage間で統一されています。

## 課題・対策・効果の整理

| 課題 | 対策 | 効果 |
|------|------|------|
| ①複数チームで統一したい振る舞いや機能の重複・繰り返し | 共通サービスプラットフォーム、コアプラットフォーム | プラットフォームの再利用による機能の立ち上げ速度向上、共通基盤自体のプロダクト価値、基盤同士のデータ連携、技術的複雑性のカプセル化、設定ファイルの共有、横断スクリプト |
| ②開発と比例する運用コスト増加によるスピード低下 | コアプラットフォーム | 増幅する運用コストの最小化 |
| ③共通サービスプラットフォームを含めた複数プロダクトの依存解決とインテグレーション | コアプラットフォーム | モノレポによる複数プロダクトのインテグレーション、OpenAPIでのスキーマ駆動開発による厳密なIFと型での依存管理 |

## 今後の課題

### 技術的な課題

1. **Docker image size**: 放っておくとすぐに肥大化する（初期700MB → 翌月2.6GB → 1.5GBまで減らす → 再び2.6GB → 1.6GBまで減らす）
2. **Bun compileがいくつかのライブラリで失敗する**: 一部のライブラリでコンパイルエラーが発生
3. **Bunの理解**: マイナーアップグレードするとテストが落ちるなど、調査して解消の運用負荷がある

### プラットフォームの拡張

1. **共通サービスプラットフォームがまだまだ足りない**: 権限、認証、アカウント管理など、追加が必要
2. **DB分離、デプロイ分離**: 機能側もpackage分割を進めていく

## まとめ

フルサイクルなマルチプロダクト開発にレバレッジを効かせるコアプラットフォームと、新たな価値を作る共通サービスプラットフォームにFull-Stack TSをフル活用することで、以下の価値を実現しています：

1. **開発速度の向上**: 共通基盤の再利用により、機能の立ち上げ速度を向上
2. **運用コストの削減**: プラットフォームによる運用コストの集約と最小化
3. **品質の向上**: OpenAPIスキーマ駆動開発による型安全性と整合性の保証
4. **組織の効率化**: モノレポによる依存関係管理とインテグレーションの簡素化

## 参考資料

- 「Full Cycle Developers at Netflix — Operate What You Build」: <https://netflixtechblog.com/full-cycle-developers-at-netflix-a08c31f83249>
- 「小さなチーム、大きな仕事」P.230
- 「Platform Engineering -Chapter 1. Why Platform Engineering Is Becoming Essential-」
- 「Platform Engineering -Chapter 3. How and When to Get Started-」
- 「Googleのソフトウェアエンジニアリング」P.498, P.555
