---
title: "エージェントエンジニアリング | ClaudeLog"
source: "https://claudelog.com/mechanics/agent-engineering/"
author:
  - "[[Wilfred Kasekende]]"
  - "[[musistudio]]"
  - "[[ClaudeLog]]"
published: 2025-07-04
created: 2025-07-28
description: "Claude Codeのカスタムエージェントシステムの基礎（それが何であるか、いつ使用するか、そして重要なベストプラクティス）を理解する。"
tags:
  - "clippings"
  - "translation"
---
私たちはAIとの対話において、3つの異なる時代を経て進化してきました。プロンプトエンジニアリング（完璧な個別プロンプトを作成する）から、コンテキストエンジニアリング（`CLAUDE.md`ファイルを通じてコンテキスト、その内容、そしてその中に残るものを最適化する）、そして現在ではエージェントエンジニアリング（専門的で再利用可能、効率的なAIエージェントを設計する）へと至ります。各段階で、成果物を共有し、コミュニティとして成長する私たちの能力は拡大してきました。個別のプロンプトの共有から、包括的なコンテキスト構成と戦術の共有、そして今では、どのプロジェクトでも機能する完全なポータブルエージェント定義の共有へと。

`カスタムエージェント`は、Claude Codeのワークフローにおけるこの最新のパラダイムシフトを象徴しています。手動のオーケストレーションから自動的なデリゲーションへ、プロジェクト固有のソリューションからポータブルな専門ツールへと。このガイドでは、高度な戦術に飛び込む前に理解しておくべき不可欠な基礎について説明します。

---

## エージェントエコシステムの理解

比較: カスタムエージェント vs サブエージェント vs タスクツール

| 項目 | カスタムエージェント | 分割役割サブエージェント | タスク/エージェントツール |
| --- | --- | --- | --- |
| **トークン効率** | | | |
| **起動** | 自動デリゲーション | 手動デリゲーション | 手動デリゲーション |
| **共有システムプロンプト** | いいえ | はい | はい |
| **ポータビリティ** | 高度にポータブル（単一の.mdファイル） | 非実用的 | 非実用的 |
| **設定** | YAMLフロントマター + システムプロンプト | タスク記述のみ | タスク記述のみ |
| **システムプロンプト** | カスタムシステムプロンプトへのアクセス | システムプロンプトを継承 | システムプロンプトを継承 |
| **カスタムツール選択** | はい | いいえ | いいえ |
| **Claude.mdの継承** | いいえ | はい | はい |
| **ユースケース** | 専門的な反復タスク | 多角的な分析 | 並列タスク実行 |

`カスタムエージェント`は、**自動起動**、**分離されたコンテキスト**、**的確なツール選択**を提供し、以前のアプローチで見られたトークンの肥大化や手動でのオーケストレーションを排除します。

---

## カスタムエージェントの設計

`カスタムエージェント`を設計する上で最も重要な側面の一つは、`カスタムエージェント`の初期化に必要なトークン数を慎重に設計することだと考えています。これを最適化することは、初期化速度の向上、コストの削減、[ピークパフォーマンス](https://claudelog.com/mechanics/context-window-depletion/)の維持、そして効率的な連鎖を可能にするなど、複数の目的を果たします。

各`カスタムエージェント`の呼び出しには、ツールの数と設定の複雑さに基づく**可変の初期化コスト**が伴います。設計の決定では、これを考慮に入れる必要があります。

**ツール数によるパフォーマンス分析（逸話的実験）:**

| ツール数 | トークン使用量 | 相対的な初期化時間 | Claude.mdが空 |
| --- | --- | --- | --- |
| 0 | 640 | 2.6s | true |
| 1 | 2.6k | 3.9s | false |
| 2 | 2.9k | 4.3s | false |
| 3 | 3.2k | 6.0s | false |
| 4 | 3.4k | 6.1s | false |
| 5 | 3.9k | 5.1s | false |
| 6 | 4.1k | 7.0s | false |
| 7 | 5.0k | 6.9s | false |
| 8 | 7.1k | 5.6s | false |
| 9 | 7.5k | 5.1s | false |
| 10 | 7.9k | 6.2s | false |
| 15+ | 13.9k - 25k | 6.4s | false |

*注: 0ツールの実験は、完全に空の`Claude.md`で実施されたため、最良のケースを反映しています。1〜15+ツールの実験は、空ではない`Claude.md`で実施されました。トークンコストと初期化時間は、追加された特定のツールの影響を受けました。*

**エージェントの重量分類:**

- **軽量エージェント**: 3kトークン未満 - 低い初期化コスト
- **中量級エージェント**: 10-15kトークン - 中程度の初期化コスト
- **重量級エージェント**: 25kトークン以上 - 高い初期化コスト

**サブスクリプションとモデルの最適化:**
軽量で高性能な`カスタムエージェント`は、サブスクリプションの制約があるため、重量級の`カスタムエージェント`よりも多く使用され、実験されるでしょう。これらは群を抜いて構成可能で、楽に使用できます。私たちは`カスタムエージェント`を可能な限り高性能で構成可能にするよう努めるべきです。`Claude 4 Opus`の高いトークン効率が`Claude 4 Opus`の5倍のコストを相殺するのに役立つため、軽量の`カスタムエージェント`と組み合わせるのは論理的でしょう。

**エージェントの連鎖可能性への影響:**
`カスタムエージェント`の複雑さは、起動時間とトークン使用量のため、その連鎖可能性に大きく影響します。重い`カスタムエージェント`（25k+トークン）はマルチエージェントのワークフローでボトルネックを生み出しますが、軽い`カスタムエージェント`（3kトークン未満）は流動的なオーケストレーションを可能にします。将来の**エージェントエンジニア**として、私たちは個々の`カスタムエージェント`のメトリクスとそれらの構成可能性の両方を最適化しなければなりません：

- **個別最適化**: 能力を維持しつつツール数を最小化する
- **構成戦略**: 専門的な高コストの`カスタムエージェント`と効率的なエージェントのバランスを取る（CPU設計における[big.LITTLE](https://en.wikipedia.org/wiki/ARM_big.LITTLE)のコンセプトに類似）
- **ワークフロー設計**: 複数の`カスタムエージェント`を連鎖させる際の累積トークンコストを考慮する
- **パフォーマンス監視**: さまざまなユースケースにわたる`カスタムエージェント`の効率メトリクスを追跡する

---

## カスタムエージェントを使用する場面

`カスタムエージェント`は、[分割役割サブエージェント](https://claudelog.com/mechanics/split-role-sub-agents/)と同じシナリオで優れていますが、移植性と自動起動が強化されています。

### 専門的なドメインタスク

- **コードレビュー** - セキュリティ、パフォーマンス、保守性の分析
- **リサーチタスク** - APIドキュメンテーション、ライブラリ比較、ベストプラクティス
- **品質保証** - テスト戦略、エッジケースの特定
- **ドキュメンテーション** - テクニカルライティング、SEO最適化、アクセシビリティ
- **デザイン分析** - UXレビュー、レイアウト評価、デザインの一貫性
- **コンテンツ品質** - 可読性の専門家、文法の専門家、ブランドボイスの専門家

### ポータブルなワークフロー

特定のプロジェクトに縛られる`サブエージェント`とは異なり、`カスタムエージェント`は一度改良すれば複数のプロジェクトで利用できるため、以下のような場合に理想的です：

- プロジェクト横断的な標準の強制
- チームのワークフローの標準化
- 個人の専門知識の増幅
- コミュニティの知識共有

---

## 主要な特徴

### CLAUDE.mdの継承なし

**大きな利点**: 従来のサブエージェントとは異なり、カスタムエージェントはプロジェクトの`CLAUDE.md`設定を自動的に継承しないように設計されています。これにより、コンテキストの汚染を防ぎ、プロジェクト間で一貫した動作を保証します。これは[サニティチェック](https://claudelog.com/mechanics/sanity-check/)で確認できます。

### カスタムエージェントのカラーリング

カスタムエージェントは、インジケータのターミナルカラーフォーマットを通じて視覚的に区別でき、複雑なワークフロー中にどのエージェントが応答しているかを追跡しやすくします。これは、複数のエージェントがアクティブな場合や、会話履歴を確認する際に明確さを保つのに役立ちます。

### 効率化のためのエージェントニックネーム

頻繁に使用するエージェントに短いニックネームを設定します：

- **UXエージェント (`A1`)** - 迅速なUX分析
- **セキュリティエージェント (`S1`)** - 迅速なセキュリティレビュー
- **パフォーマンスエージェント (`P1`)** - パフォーマンス最適化

ニックネーム付きの設定例：

```yaml
---
name: UX Agent (A1)
description: ユーザーエクスペリエンス分析のためのUXスペシャリスト。インターフェースとユーザーワークフローを評価する際にこのエージェントを使用してください。
tools: Read, Grep, Glob
---

あなたはユーザーエクスペリエンス分析とインターフェース評価に特化したUXスペシャリストです。

呼び出されたとき：
1. ユーザーインターフェースの要素とワークフローを分析する
2. ユーザビリティの問題と改善の機会を特定する
3. 実用的なUXの推奨事項を提供する
4. アクセシビリティとユーザージャーニーの最適化を考慮する
```

**ニックネームでエージェントを呼び出す:**

または：

### 高度なニックネームワークフロー

`カスタムエージェント`にニックネームを付ける機能は、手動での呼び出しを改善し、`A1, P2, C1`のようなニックネームで`カスタムエージェント`を呼び出すといった可能性を開きます。

```markdown
ask A1, P2, C1 to review the changes
```

### 自動デリゲーションの設定

`カスタムエージェント`は、プロンプト内のタスク説明、`カスタムエージェント`設定のdescriptionフィールド、現在のコンテキスト、および利用可能なツールに基づいて、`デリゲートエージェント`によって自動的に利用されます。

`カスタムエージェント`を作成する際には、Claudeがあなたの`カスタムエージェント`を呼び出す信頼性を評価する必要があります。信頼性を向上させる必要がある場合は、エージェントの名前、説明、またはシステムプロンプトを更新することを検討してください。`カスタムエージェント`がClaudeによって迅速に利用されるように設定することは、一種の`ツールSEO`です。

Anthropicは、積極的な`カスタムエージェント`の使用を促すために、`カスタムエージェント`の`description`フィールドに`use PROACTIVELY`や`MUST BE USED`といった用語を含めるべきだと述べています。これは、`Claude.md`を正しくフォーマットすることでClaudeから良好な遵守を得るためにこれらの用語を使用する方法と機能的に似ています。

---

## 設計上の考慮事項

### 開始戦略

**トークンファースト設計:**

- 最初は焦点を絞った単一目的のエージェントを作成する
- 最大限の構成可能性のために、軽量エージェント（ツールが最小限またはまったくない）から始める
- カスタムエージェントが初期化に必要とするトークン数を慎重に設計する
- 頻繁に使用するエージェントについては、能力よりも効率を優先する

**設定のベストプラクティス:**

- 信頼性の高い自動起動のために、明確で具体的な説明を使用する
- 最初は必要なツールのみを付与し、必要に応じて拡張する
- 拡張する前にエージェントの信頼性をテストする
- パターン認識を向上させるために、システムプロンプトに例を含める
- ワークフローに展開する前に、エージェントを単独でテストする
- 連鎖可能性とマルチエージェントパイピングを考慮して設計する
- 頻繁にエージェントをテストし、有効性を検証するために他の人と共有する

---

**関連項目**: [Custom Agents](https://claudelog.com/mechanics/custom-agents/) | [Task Agent Tools](https://claudelog.com/mechanics/task-agent-tools/)

**著者**:[InventorBlack](https://www.linkedin.com/in/wilfredkasekende/) | CTO at [Command Stick](https://commandstick.com/) | Mod at [r/ClaudeAi](https://reddit.com/r/ClaudeAI)
